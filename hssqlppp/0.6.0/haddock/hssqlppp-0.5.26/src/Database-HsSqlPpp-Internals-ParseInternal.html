<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Database/HsSqlPpp/Internals/ParseInternal.lhs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>

The main file for parsing sql, uses parsec. Not sure if parsec is the
right choice, but it seems to do the job pretty well at the moment.

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>{-# LANGUAGE FlexibleContexts,ExplicitForAll,TupleSections,
<a name="line-2"></a>&gt;              NoMonomorphismRestriction,OverloadedStrings #-}</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>-- | Functions to parse SQL.</span>
<a name="line-4"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>module</span> <span class='hs-conid'>Database</span><span class='hs-varop'>.</span><span class='hs-conid'>HsSqlPpp</span><span class='hs-varop'>.</span><span class='hs-conid'>Internals</span><span class='hs-varop'>.</span><span class='hs-conid'>ParseInternal</span>
<a name="line-5"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>(</span><span class='hs-comment'>-- * Main</span>
<a name="line-6"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>parseStatements</span>
<a name="line-7"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>parseQueryExpr</span>
<a name="line-8"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>parseScalarExpr</span>
<a name="line-9"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>parseProcSQL</span>
<a name="line-10"></a><span class='hs-varop'>&gt;</span>      <span class='hs-comment'>-- * parsing flags</span>
<a name="line-11"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-conid'>ParseFlags</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-12"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varop'>--,Dialect(..)</span>
<a name="line-13"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varop'>--,ansiDialect</span>
<a name="line-14"></a><span class='hs-varop'>&gt;</span>      <span class='hs-comment'>-- * errors</span>
<a name="line-15"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varop'>--,ParseErrorExtra(..)</span>
<a name="line-16"></a><span class='hs-varop'>&gt;</span>      <span class='hs-comment'>-- other helpers for internal use</span>
<a name="line-17"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>tableAttribute</span>
<a name="line-18"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>keyword</span>
<a name="line-19"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>parens</span>
<a name="line-20"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>symbol</span>
<a name="line-21"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>idString</span>
<a name="line-22"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>commaSep1</span>
<a name="line-23"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>commaSep</span>
<a name="line-24"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>parseName</span>
<a name="line-25"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>parseNameComponent</span>
<a name="line-26"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-27"></a><span class='hs-varop'>&gt;</span>
<a name="line-28"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>Parsec</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>label</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- many, optional, (&lt;|&gt;), string,</span>
<a name="line-29"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>Parsec</span><span class='hs-varop'>.</span><span class='hs-conid'>Expr</span>
<a name="line-30"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>Parsec</span><span class='hs-varop'>.</span><span class='hs-conid'>String</span>
<a name="line-31"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>Parsec</span><span class='hs-varop'>.</span><span class='hs-conid'>Perm</span>
<a name="line-32"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>Parsec</span><span class='hs-varop'>.</span><span class='hs-conid'>Pos</span>
<a name="line-33"></a><span class='hs-varop'>&gt;</span>
<a name="line-34"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Applicative</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>many</span><span class='hs-layout'>,</span><span class='hs-varid'>optional</span><span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-varop'>&lt;|&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-35"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span><span class='hs-varop'>.</span><span class='hs-conid'>Identity</span>
<a name="line-36"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>--import Control.Monad</span>
<a name="line-37"></a><span class='hs-varop'>&gt;</span>
<a name="line-38"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Maybe</span>
<a name="line-39"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Char</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-conid'>Format</span><span class='hs-layout'>)</span>
<a name="line-40"></a><span class='hs-varop'>&gt;</span>
<a name="line-41"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Generics</span><span class='hs-varop'>.</span><span class='hs-conid'>Uniplate</span><span class='hs-varop'>.</span><span class='hs-conid'>Data</span>
<a name="line-42"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Data</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-conid'>Prefix</span><span class='hs-layout'>,</span><span class='hs-conid'>Infix</span><span class='hs-layout'>)</span>
<a name="line-43"></a><span class='hs-varop'>&gt;</span>
<a name="line-44"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Database</span><span class='hs-varop'>.</span><span class='hs-conid'>HsSqlPpp</span><span class='hs-varop'>.</span><span class='hs-conid'>Internals</span><span class='hs-varop'>.</span><span class='hs-conid'>LexInternal</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Lex</span>
<a name="line-45"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Database</span><span class='hs-varop'>.</span><span class='hs-conid'>HsSqlPpp</span><span class='hs-varop'>.</span><span class='hs-conid'>Internals</span><span class='hs-varop'>.</span><span class='hs-conid'>ParseErrors</span>
<a name="line-46"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Database</span><span class='hs-varop'>.</span><span class='hs-conid'>HsSqlPpp</span><span class='hs-varop'>.</span><span class='hs-conid'>Internals</span><span class='hs-varop'>.</span><span class='hs-conid'>AstInternal</span>
<a name="line-47"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>--import Database.HsSqlPpp.Annotation as A</span>
<a name="line-48"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Database</span><span class='hs-varop'>.</span><span class='hs-conid'>HsSqlPpp</span><span class='hs-varop'>.</span><span class='hs-conid'>Internals</span><span class='hs-varop'>.</span><span class='hs-conid'>Utils</span>
<a name="line-49"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Database</span><span class='hs-varop'>.</span><span class='hs-conid'>HsSqlPpp</span><span class='hs-varop'>.</span><span class='hs-conid'>Internals</span><span class='hs-varop'>.</span><span class='hs-conid'>Dialect</span>
<a name="line-50"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span> <span class='hs-layout'>(</span><span class='hs-conid'>Text</span><span class='hs-layout'>)</span>
<a name="line-51"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>T</span>
<a name="line-52"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>--import qualified Data.Text.Lazy as LT</span>
<a name="line-53"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>Parsec</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span> <span class='hs-conid'>()</span>
<a name="line-54"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>--import Database.HsSqlPpp.Catalog</span>
</pre>
<pre><a name="line-55"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>Lazy</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>L</span>
<a name="line-56"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>--import Database.HsSqlPpp.Internals.StringLike</span>
</pre>
  import Debug.Trace

--------------------------------------------------------------------------------

Top level parsing functions
===========================

<pre><a name="line-57"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>-- | Parse a list of statements</span>
<a name="line-58"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parseStatements</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ParseFlags</span> <span class='hs-comment'>-- ^ parse options</span>
<a name="line-59"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span> <span class='hs-comment'>-- ^ filename to use in errors</span>
<a name="line-60"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ set the line number and column number</span>
<a name="line-61"></a><span class='hs-varop'>&gt;</span>                                    <span class='hs-comment'>-- of the first char in the source (used in annotation)</span>
<a name="line-62"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>L</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span> <span class='hs-comment'>-- ^ a string containing the sql to parse</span>
<a name="line-63"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>ParseErrorExtra</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Statement</span><span class='hs-keyglyph'>]</span>
<a name="line-64"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parseStatements</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parseIt'</span> <span class='hs-varid'>sqlStatements</span>
</pre>
<pre><a name="line-65"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>-- | Parse a single query expr</span>
<a name="line-66"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parseQueryExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ParseFlags</span> <span class='hs-comment'>-- ^ parse options</span>
<a name="line-67"></a><span class='hs-varop'>&gt;</span>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span> <span class='hs-comment'>-- ^ filename to use in errors</span>
<a name="line-68"></a><span class='hs-varop'>&gt;</span>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ set the line number and column number</span>
<a name="line-69"></a><span class='hs-varop'>&gt;</span>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>L</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span> <span class='hs-comment'>-- ^ a string containing the sql to parse</span>
<a name="line-70"></a><span class='hs-varop'>&gt;</span>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>ParseErrorExtra</span> <span class='hs-conid'>QueryExpr</span>
<a name="line-71"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parseQueryExpr</span> <span class='hs-keyglyph'>=</span>
<a name="line-72"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>parseIt'</span> <span class='hs-varop'>$</span> <span class='hs-varid'>pQueryExpr</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>";"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>eof</span>
</pre>
<pre><a name="line-73"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>-- | Parse a single scalar expr</span>
<a name="line-74"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parseScalarExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ParseFlags</span> <span class='hs-comment'>-- ^ parse options</span>
<a name="line-75"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span> <span class='hs-comment'>-- ^ filename to use in errors</span>
<a name="line-76"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ set the line number and column number</span>
<a name="line-77"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>L</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span> <span class='hs-comment'>-- ^ a string containing the sql to parse</span>
<a name="line-78"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>ParseErrorExtra</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-79"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parseScalarExpr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parseIt'</span> <span class='hs-varop'>$</span> <span class='hs-varid'>expr</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>eof</span>
</pre>
<pre><a name="line-80"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>-- | Parse a list of procedural sql statements</span>
<a name="line-81"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parseProcSQL</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ParseFlags</span> <span class='hs-comment'>-- ^ parse options</span>
<a name="line-82"></a><span class='hs-varop'>&gt;</span>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span> <span class='hs-comment'>-- ^ filename to use in errors</span>
<a name="line-83"></a><span class='hs-varop'>&gt;</span>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ set the line number and column number</span>
<a name="line-84"></a><span class='hs-varop'>&gt;</span>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>L</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span> <span class='hs-comment'>-- ^ a string containing the sql to parse</span>
<a name="line-85"></a><span class='hs-varop'>&gt;</span>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>ParseErrorExtra</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Statement</span><span class='hs-keyglyph'>]</span>
<a name="line-86"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parseProcSQL</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parseIt'</span> <span class='hs-varop'>$</span> <span class='hs-varid'>many</span> <span class='hs-varid'>plPgsqlStatement</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>eof</span>
</pre>
<pre><a name="line-87"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parseIt'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Data</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span>
<a name="line-88"></a><span class='hs-varop'>&gt;</span>             <span class='hs-conid'>SParser</span> <span class='hs-varid'>a</span>
<a name="line-89"></a><span class='hs-varop'>&gt;</span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ParseFlags</span>
<a name="line-90"></a><span class='hs-varop'>&gt;</span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span>
<a name="line-91"></a><span class='hs-varop'>&gt;</span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-92"></a><span class='hs-varop'>&gt;</span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>L</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span>
<a name="line-93"></a><span class='hs-varop'>&gt;</span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>ParseErrorExtra</span> <span class='hs-varid'>a</span>
<a name="line-94"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parseIt'</span> <span class='hs-varid'>ps</span> <span class='hs-varid'>flg</span> <span class='hs-varid'>fn</span> <span class='hs-varid'>sp</span> <span class='hs-varid'>src</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-95"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>lxd</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexem</span> <span class='hs-layout'>(</span><span class='hs-varid'>pfDialect</span> <span class='hs-varid'>flg</span><span class='hs-layout'>)</span> <span class='hs-varid'>fn</span> <span class='hs-varid'>sp</span> <span class='hs-varid'>src</span>
<a name="line-96"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>psd</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>either</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Left</span> <span class='hs-varop'>$</span> <span class='hs-conid'>ParseErrorExtra</span> <span class='hs-varid'>e</span> <span class='hs-varid'>sp</span> <span class='hs-varid'>src</span><span class='hs-layout'>)</span> <span class='hs-conid'>Right</span>
<a name="line-97"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>$</span> <span class='hs-varid'>runParser</span> <span class='hs-varid'>ps</span> <span class='hs-varid'>flg</span> <span class='hs-varid'>fn</span> <span class='hs-varid'>lxd</span>
<a name="line-98"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fixupTree</span> <span class='hs-varid'>psd</span>
</pre>
<pre><a name="line-99"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>lexem</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span>
<a name="line-100"></a><span class='hs-varop'>&gt;</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span>
<a name="line-101"></a><span class='hs-varop'>&gt;</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-102"></a><span class='hs-varop'>&gt;</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>L</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span>
<a name="line-103"></a><span class='hs-varop'>&gt;</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>ParseErrorExtra</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Token</span><span class='hs-keyglyph'>]</span>
<a name="line-104"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>lexem</span> <span class='hs-varid'>d</span> <span class='hs-varid'>fn</span> <span class='hs-varid'>sp</span> <span class='hs-varid'>src</span> <span class='hs-keyglyph'>=</span>
<a name="line-105"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>let</span> <span class='hs-varid'>ts</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>ParseErrorExtra</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Token</span><span class='hs-keyglyph'>]</span>
<a name="line-106"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>ts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>either</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Left</span> <span class='hs-varop'>$</span> <span class='hs-conid'>ParseErrorExtra</span> <span class='hs-varid'>e</span> <span class='hs-varid'>sp</span> <span class='hs-varid'>src</span><span class='hs-layout'>)</span> <span class='hs-conid'>Right</span>
<a name="line-107"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varop'>$</span> <span class='hs-conid'>Lex</span><span class='hs-varop'>.</span><span class='hs-varid'>lexTokens</span> <span class='hs-varid'>d</span> <span class='hs-varid'>fn</span> <span class='hs-varid'>sp</span> <span class='hs-varid'>src</span>
<a name="line-108"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>in</span> <span class='hs-comment'>--trace ((\(Right r) -&gt; intercalate "\n" $ map show r) ts) $</span>
<a name="line-109"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>filter</span> <span class='hs-varid'>keep</span> <span class='hs-varop'>`fmap`</span> <span class='hs-varid'>ts</span>
<a name="line-110"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-111"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>keep</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-conid'>Lex</span><span class='hs-varop'>.</span><span class='hs-conid'>Whitespace</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-112"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>keep</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-conid'>Lex</span><span class='hs-varop'>.</span><span class='hs-conid'>LineComment</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-113"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>keep</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-conid'>Lex</span><span class='hs-varop'>.</span><span class='hs-conid'>BlockComment</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-114"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>keep</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
</pre>
Parse state used for parse flags. Might be better to use a readerT
somehow, but I'm not smart enough to work out how to do this. This
state is never updated during parsing

<pre><a name="line-115"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>-- | Settings to influence the parsing</span>
<a name="line-116"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>data</span> <span class='hs-conid'>ParseFlags</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ParseFlags</span>
<a name="line-117"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>{</span><span class='hs-varid'>pfDialect</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span>
<a name="line-118"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>}</span>
<a name="line-119"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Show</span><span class='hs-layout'>,</span><span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-120"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>ParseState</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ParseFlags</span>
</pre>
<pre><a name="line-121"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>isSqlServer</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Bool</span>
<a name="line-122"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>isSqlServer</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-123"></a><span class='hs-varop'>&gt;</span>   <span class='hs-conid'>ParseFlags</span> <span class='hs-layout'>{</span><span class='hs-varid'>pfDialect</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>d</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getState</span>
<a name="line-124"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>diSyntaxFlavour</span> <span class='hs-varid'>d</span> <span class='hs-varop'>==</span> <span class='hs-conid'>SqlServer</span>
</pre>
<pre><a name="line-125"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>isOracle</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Bool</span>
<a name="line-126"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>isOracle</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-127"></a><span class='hs-varop'>&gt;</span>   <span class='hs-conid'>ParseFlags</span> <span class='hs-layout'>{</span><span class='hs-varid'>pfDialect</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>d</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getState</span>
<a name="line-128"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>diSyntaxFlavour</span> <span class='hs-varid'>d</span> <span class='hs-varop'>==</span> <span class='hs-conid'>Oracle</span>
</pre>
couple of wrapper functions for the quoting

<pre><a name="line-129"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parseName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ParseFlags</span>
<a name="line-130"></a><span class='hs-varop'>&gt;</span>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span>
<a name="line-131"></a><span class='hs-varop'>&gt;</span>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-132"></a><span class='hs-varop'>&gt;</span>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>L</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span>
<a name="line-133"></a><span class='hs-varop'>&gt;</span>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>ParseErrorExtra</span> <span class='hs-conid'>Name</span>
<a name="line-134"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parseName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parseIt'</span> <span class='hs-varop'>$</span> <span class='hs-varid'>name</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>eof</span>
</pre>
<pre><a name="line-135"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parseNameComponent</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ParseFlags</span>
<a name="line-136"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span>
<a name="line-137"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-138"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>L</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span>
<a name="line-139"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>ParseErrorExtra</span> <span class='hs-conid'>NameComponent</span>
<a name="line-140"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parseNameComponent</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parseIt'</span> <span class='hs-varop'>$</span> <span class='hs-varid'>nameComponent</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>eof</span>
</pre>

--------------------------------------------------------------------------------


<pre><a name="line-141"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>Token</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>FilePath</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span><span class='hs-conid'>Lex</span><span class='hs-varop'>.</span><span class='hs-conid'>Token</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-142"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>SParser</span> <span class='hs-keyglyph'>=</span>  <span class='hs-conid'>GenParser</span> <span class='hs-conid'>Token</span> <span class='hs-conid'>ParseState</span>
</pre>
Parsing top level statements
============================

<pre><a name="line-143"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>sqlStatements</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Statement</span><span class='hs-keyglyph'>]</span>
<a name="line-144"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>sqlStatements</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>many</span> <span class='hs-layout'>(</span><span class='hs-varid'>sqlStatement</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>eof</span>
<a name="line-145"></a><span class='hs-varop'>&gt;</span>
<a name="line-146"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>sqlStatement</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-147"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>sqlStatement</span> <span class='hs-varid'>reqSemi</span> <span class='hs-keyglyph'>=</span>
<a name="line-148"></a><span class='hs-varop'>&gt;</span>    <span class='hs-layout'>(</span><span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-149"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>antiStatement</span>
<a name="line-150"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>queryStatement</span>
<a name="line-151"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>insert</span>
<a name="line-152"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>update</span>
<a name="line-153"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>delete</span>
<a name="line-154"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>truncateSt</span>
<a name="line-155"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>copy</span>
<a name="line-156"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varop'>--do</span>
<a name="line-157"></a><span class='hs-varop'>&gt;</span>      <span class='hs-comment'>--not &lt;$&gt; isSqlServer &gt;&gt;= guard</span>
<a name="line-158"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>set</span>
<a name="line-159"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>notify</span>
<a name="line-160"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"create"</span> <span class='hs-varop'>*&gt;</span>
<a name="line-161"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-162"></a><span class='hs-varop'>&gt;</span>                <span class='hs-comment'>-- todo: this is bad</span>
<a name="line-163"></a><span class='hs-varop'>&gt;</span>                <span class='hs-comment'>-- why do we have create outside</span>
<a name="line-164"></a><span class='hs-varop'>&gt;</span>                <span class='hs-comment'>-- but then have 'or replace' inside the</span>
<a name="line-165"></a><span class='hs-varop'>&gt;</span>                <span class='hs-comment'>-- invididual parsers, making it impossible</span>
<a name="line-166"></a><span class='hs-varop'>&gt;</span>                <span class='hs-comment'>-- to get rid of the try here?</span>
<a name="line-167"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varid'>try</span> <span class='hs-varid'>createTable</span>
<a name="line-168"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>createSequence</span>
<a name="line-169"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>createType</span>
<a name="line-170"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>createFunction</span>
<a name="line-171"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>createView</span>
<a name="line-172"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>createDomain</span>
<a name="line-173"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>createDatabase</span>
<a name="line-174"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>createLanguage</span>
<a name="line-175"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>createTrigger</span>
<a name="line-176"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>createIndex</span>
<a name="line-177"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>createLogin</span>
<a name="line-178"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>createUser</span>
<a name="line-179"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>createSchema</span><span class='hs-keyglyph'>]</span>
<a name="line-180"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"alter"</span> <span class='hs-varop'>*&gt;</span>
<a name="line-181"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-182"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varid'>alterSequence</span>
<a name="line-183"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>alterTable</span>
<a name="line-184"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>alterDatabase</span>
<a name="line-185"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>alterLogin</span>
<a name="line-186"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>alterUser</span>
<a name="line-187"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>alterView</span>
<a name="line-188"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>alterSchema</span><span class='hs-keyglyph'>]</span>
<a name="line-189"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"drop"</span> <span class='hs-varop'>*&gt;</span>
<a name="line-190"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-191"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varid'>dropSomething</span>
<a name="line-192"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>dropFunction</span>
<a name="line-193"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>dropTrigger</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
<a name="line-194"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>stmtEnd</span> <span class='hs-layout'>(</span><span class='hs-varid'>not</span> <span class='hs-varid'>reqSemi</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-195"></a><span class='hs-varop'>&gt;</span>    <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>copyData</span>
</pre>
--------------------------------------------------------------------------------

statement flavour parsers
=========================

top level/sql statements first

query expr

<pre><a name="line-196"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>queryStatement</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-197"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>queryStatement</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>QueryStatement</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>pQueryExpr</span>
</pre>
this is the plpgsql into

<pre><a name="line-198"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>into</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-layout'>(</span><span class='hs-conid'>Statement</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Statement</span><span class='hs-layout'>)</span>
<a name="line-199"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>into</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-200"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"into"</span>
<a name="line-201"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>st</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>option</span> <span class='hs-conid'>False</span> <span class='hs-layout'>(</span><span class='hs-conid'>True</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"strict"</span><span class='hs-layout'>)</span>
<a name="line-202"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>is</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>name</span>
<a name="line-203"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Into</span> <span class='hs-varid'>p</span> <span class='hs-varid'>st</span> <span class='hs-varid'>is</span> <span class='hs-varid'>s</span>
</pre>
<pre><a name="line-204"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>intoQueryStatement</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-205"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>intoQueryStatement</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-206"></a><span class='hs-varop'>&gt;</span>   <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pQueryExprX</span> <span class='hs-conid'>True</span>
<a name="line-207"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>case</span> <span class='hs-varid'>i</span> <span class='hs-keyword'>of</span>
<a name="line-208"></a><span class='hs-varop'>&gt;</span>     <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fail</span> <span class='hs-str'>"not into"</span>
<a name="line-209"></a><span class='hs-varop'>&gt;</span>     <span class='hs-conid'>Just</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-varid'>s</span>
</pre>
<pre><a name="line-210"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>pQueryExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>QueryExpr</span>
<a name="line-211"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>pQueryExpr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>snd</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pQueryExprX</span> <span class='hs-conid'>False</span>
</pre>
bit convoluted to parse the into part
TODO: used to parse the into in the select list parser,
maybe it should still do this since it would probably be a lot clearer


<pre><a name="line-212"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>pQueryExprX</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Statement</span><span class='hs-layout'>,</span> <span class='hs-conid'>QueryExpr</span><span class='hs-layout'>)</span>
<a name="line-213"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>pQueryExprX</span> <span class='hs-varid'>allowInto</span> <span class='hs-keyglyph'>=</span>
<a name="line-214"></a><span class='hs-varop'>&gt;</span>   <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>with</span><span class='hs-layout'>)</span>
<a name="line-215"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varop'>&lt;|&gt;</span>  <span class='hs-varid'>buildExpressionParser</span> <span class='hs-varid'>combTable</span> <span class='hs-varid'>selFactor</span>
<a name="line-216"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-217"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>selFactor</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-varid'>pQueryExpr</span><span class='hs-layout'>)</span>
<a name="line-218"></a><span class='hs-varop'>&gt;</span>                            <span class='hs-layout'>,</span><span class='hs-varid'>selQuerySpec</span>
<a name="line-219"></a><span class='hs-varop'>&gt;</span>                            <span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>values</span><span class='hs-keyglyph'>]</span>
<a name="line-220"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>with</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>WithQueryExpr</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"with"</span><span class='hs-layout'>)</span>
<a name="line-221"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>withQuery</span>
<a name="line-222"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>pQueryExpr</span>
<a name="line-223"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>withQuery</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>WithQuery</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-224"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>nameComponent</span>
<a name="line-225"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>tryOptionMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>parens</span> <span class='hs-varop'>$</span> <span class='hs-varid'>commaSep</span> <span class='hs-varid'>nameComponent</span><span class='hs-layout'>)</span>
<a name="line-226"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"as"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-varid'>pQueryExpr</span><span class='hs-layout'>)</span>
<a name="line-227"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>combTable</span> <span class='hs-keyglyph'>=</span>
<a name="line-228"></a><span class='hs-varop'>&gt;</span>            <span class='hs-keyglyph'>[</span><span class='hs-varid'>map</span> <span class='hs-varid'>makeOp</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Except</span><span class='hs-layout'>,</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"except"</span><span class='hs-layout'>)</span>
<a name="line-229"></a><span class='hs-varop'>&gt;</span>                        <span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-conid'>Intersect</span><span class='hs-layout'>,</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"intersect"</span><span class='hs-layout'>)</span>
<a name="line-230"></a><span class='hs-varop'>&gt;</span>                        <span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-conid'>UnionAll</span><span class='hs-layout'>,</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"union"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"all"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-231"></a><span class='hs-varop'>&gt;</span>                        <span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-conid'>Union</span><span class='hs-layout'>,</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"union"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
<a name="line-232"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>makeOp</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-233"></a><span class='hs-varop'>&gt;</span>            <span class='hs-conid'>Infix</span> <span class='hs-layout'>(</span><span class='hs-keyword'>do</span>
<a name="line-234"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-varid'>cmb</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-conid'>CombineQueryExpr</span>
<a name="line-235"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-236"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-237"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s0</span> <span class='hs-varid'>s1</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span> <span class='hs-varid'>cmb</span> <span class='hs-layout'>(</span><span class='hs-varid'>snd</span> <span class='hs-varid'>s0</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>snd</span> <span class='hs-varid'>s1</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-238"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-layout'>)</span> <span class='hs-conid'>AssocLeft</span>
<a name="line-239"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>selQuerySpec</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-240"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"select"</span>
<a name="line-241"></a><span class='hs-varop'>&gt;</span>           <span class='hs-comment'>-- todo: support explicit all</span>
<a name="line-242"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>d</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>option</span> <span class='hs-conid'>All</span> <span class='hs-layout'>(</span><span class='hs-conid'>Distinct</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>distinctKeyword</span><span class='hs-layout'>)</span>
<a name="line-243"></a><span class='hs-varop'>&gt;</span>           <span class='hs-comment'>-- hacky parsing of sql server 'top n' style select</span>
<a name="line-244"></a><span class='hs-varop'>&gt;</span>           <span class='hs-comment'>-- quiz: what happens when you use top n and limit at the same time?</span>
<a name="line-245"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>tp</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>choice</span>
<a name="line-246"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-keyglyph'>[</span><span class='hs-keyword'>do</span>
<a name="line-247"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varid'>isSqlServer</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>guard</span>
<a name="line-248"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varid'>optionMaybe</span> <span class='hs-varop'>$</span> <span class='hs-varid'>try</span>
<a name="line-249"></a><span class='hs-varop'>&gt;</span>                      <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"top"</span> <span class='hs-varop'>*&gt;</span>
<a name="line-250"></a><span class='hs-varop'>&gt;</span>                       <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>parens</span> <span class='hs-varid'>expr</span>
<a name="line-251"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-comment'>-- not sure why you can't write expr without parens</span>
<a name="line-252"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-comment'>-- but it doesn't work TODO: fix this</span>
<a name="line-253"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-comment'>-- the current hack only allows a single number</span>
<a name="line-254"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-comment'>-- if you don't also use parens</span>
<a name="line-255"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-layout'>,</span><span class='hs-conid'>NumberLit</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>show</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>integer</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-256"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-layout'>,</span><span class='hs-varid'>return</span> <span class='hs-conid'>Nothing</span><span class='hs-keyglyph'>]</span>
<a name="line-257"></a><span class='hs-varop'>&gt;</span>           <span class='hs-comment'>-- todo: work out how to make this work properly - need to return</span>
<a name="line-258"></a><span class='hs-varop'>&gt;</span>           <span class='hs-comment'>-- the into</span>
<a name="line-259"></a><span class='hs-varop'>&gt;</span>           <span class='hs-layout'>(</span><span class='hs-varid'>sl</span><span class='hs-layout'>,</span><span class='hs-varid'>intoBit</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>allowInto</span>
<a name="line-260"></a><span class='hs-varop'>&gt;</span>                           <span class='hs-keyword'>then</span> <span class='hs-varid'>permute</span> <span class='hs-layout'>(</span><span class='hs-conid'>(,)</span>
<a name="line-261"></a><span class='hs-varop'>&gt;</span>                                         <span class='hs-varop'>&lt;$$&gt;</span> <span class='hs-varid'>try</span> <span class='hs-varid'>selectList</span>
<a name="line-262"></a><span class='hs-varop'>&gt;</span>                                         <span class='hs-varop'>&lt;|?&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>into</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-263"></a><span class='hs-varop'>&gt;</span>                           <span class='hs-keyword'>else</span> <span class='hs-layout'>(</span><span class='hs-layout'>,</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>selectList</span>
<a name="line-264"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>s</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-conid'>Select</span> <span class='hs-varid'>p</span> <span class='hs-varid'>d</span> <span class='hs-varid'>sl</span>
<a name="line-265"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>from</span>
<a name="line-266"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>optionMaybe</span> <span class='hs-varid'>whereClause</span>
<a name="line-267"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>groupBy</span>
<a name="line-268"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>optionMaybe</span> <span class='hs-varid'>having</span>
<a name="line-269"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>orderBy</span>
<a name="line-270"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-varid'>tp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>limit</span><span class='hs-layout'>)</span>
<a name="line-271"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>optionMaybe</span> <span class='hs-varid'>offset</span>
<a name="line-272"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>hints</span>
<a name="line-273"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-keyword'>case</span> <span class='hs-varid'>intoBit</span> <span class='hs-keyword'>of</span>
<a name="line-274"></a><span class='hs-varop'>&gt;</span>                       <span class='hs-conid'>Just</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>f</span> <span class='hs-varop'>$</span> <span class='hs-conid'>QueryStatement</span> <span class='hs-varid'>p</span> <span class='hs-varid'>s</span>
<a name="line-275"></a><span class='hs-varop'>&gt;</span>                       <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<a name="line-276"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-layout'>,</span><span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-277"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>from</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"from"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>tableRef</span>
<a name="line-278"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>groupBy</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"group"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"by"</span>
<a name="line-279"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>expr</span>
<a name="line-280"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>having</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"having"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>expr</span>
<a name="line-281"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>limit</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"limit"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>expr</span>
<a name="line-282"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>offset</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"offset"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>expr</span>
<a name="line-283"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>values</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Values</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"values"</span><span class='hs-layout'>)</span>
<a name="line-284"></a><span class='hs-varop'>&gt;</span>                         <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>commaSep1</span> <span class='hs-layout'>(</span><span class='hs-varid'>parens</span> <span class='hs-varop'>$</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-285"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>hints</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"option"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>parens</span> <span class='hs-varop'>$</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>queryHint</span><span class='hs-layout'>)</span>
</pre>

<pre><a name="line-286"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>distinctKeyword</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>()</span>
<a name="line-287"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>distinctKeyword</span> <span class='hs-keyglyph'>=</span>
<a name="line-288"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>choice</span>
<a name="line-289"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyglyph'>[</span><span class='hs-keyword'>do</span>
<a name="line-290"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>isOracle</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>guard</span>
<a name="line-291"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>keyword</span> <span class='hs-str'>"unique"</span>
<a name="line-292"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-293"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"distinct"</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-294"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>queryHint</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>QueryHint</span>
<a name="line-295"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>queryHint</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span>
<a name="line-296"></a><span class='hs-varop'>&gt;</span>             <span class='hs-keyglyph'>[</span><span class='hs-conid'>QueryHintPartitionGroup</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"partition"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"group"</span>
<a name="line-297"></a><span class='hs-varop'>&gt;</span>             <span class='hs-layout'>,</span><span class='hs-conid'>QueryHintColumnarHostGroup</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"columnar"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"host"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"group"</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-298"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>orderBy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>ScalarExpr</span><span class='hs-layout'>,</span><span class='hs-conid'>Direction</span><span class='hs-layout'>,</span> <span class='hs-conid'>NullsOrder</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-299"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>orderBy</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span>
<a name="line-300"></a><span class='hs-varop'>&gt;</span>             <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"order"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"by"</span>
<a name="line-301"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>oneOrder</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-302"></a><span class='hs-varop'>&gt;</span>           <span class='hs-keyword'>where</span>
<a name="line-303"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>oneOrder</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>(,,)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>expr</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>direction</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>nullsOrder</span>
<a name="line-304"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>direction</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>option</span> <span class='hs-conid'>Asc</span> <span class='hs-layout'>(</span><span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-305"></a><span class='hs-varop'>&gt;</span>                                        <span class='hs-conid'>Asc</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"asc"</span>
<a name="line-306"></a><span class='hs-varop'>&gt;</span>                                       <span class='hs-layout'>,</span><span class='hs-conid'>Desc</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"desc"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-307"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>nullsOrder</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>option</span> <span class='hs-conid'>NullsDefault</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"nulls"</span> <span class='hs-varop'>&gt;&gt;</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-308"></a><span class='hs-varop'>&gt;</span>                                         <span class='hs-conid'>NullsFirst</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"first"</span>
<a name="line-309"></a><span class='hs-varop'>&gt;</span>                                        <span class='hs-layout'>,</span><span class='hs-conid'>NullsLast</span>  <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"last"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
</pre>
table refs

only way of combining them is joins which parse left associative which
makes it easy

<pre><a name="line-310"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>tableRef</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>TableRef</span>
<a name="line-311"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>tableRef</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nonJoin</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>optionalJoinSuffix</span>
<a name="line-312"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-313"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>nonJoin</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-314"></a><span class='hs-varop'>&gt;</span>               <span class='hs-comment'>-- read parens and a subquery or tableref</span>
<a name="line-315"></a><span class='hs-varop'>&gt;</span>               <span class='hs-comment'>-- or a funtref or just a tref</span>
<a name="line-316"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varid'>t</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>choice</span>
<a name="line-317"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-keyglyph'>[</span><span class='hs-keyword'>do</span>
<a name="line-318"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-319"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-varid'>parens</span> <span class='hs-varop'>$</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-conid'>SubTref</span> <span class='hs-varid'>p</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pQueryExpr</span>
<a name="line-320"></a><span class='hs-varop'>&gt;</span>                                     <span class='hs-layout'>,</span><span class='hs-conid'>TableRefParens</span> <span class='hs-varid'>p</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>tableRef</span><span class='hs-keyglyph'>]</span>
<a name="line-321"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-comment'>-- should combine the funtref and tref parsing</span>
<a name="line-322"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-layout'>,</span><span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-conid'>FunTref</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-323"></a><span class='hs-varop'>&gt;</span>                                   <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>identifier</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>functionCallSuffix</span><span class='hs-layout'>)</span>
<a name="line-324"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-layout'>,</span><span class='hs-conid'>OdbcTableRef</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>"{"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"oj"</span><span class='hs-layout'>)</span>
<a name="line-325"></a><span class='hs-varop'>&gt;</span>                                  <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>tableRef</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>"}"</span><span class='hs-layout'>)</span>
<a name="line-326"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-layout'>,</span><span class='hs-conid'>Tref</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span><span class='hs-keyglyph'>]</span>
<a name="line-327"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varid'>optionalAlias</span> <span class='hs-varid'>t</span>
<a name="line-328"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>optionalAlias</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-329"></a><span class='hs-varop'>&gt;</span>               <span class='hs-comment'>-- try and read an alias</span>
<a name="line-330"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varid'>a</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>optionMaybe</span> <span class='hs-varop'>$</span> <span class='hs-varid'>try</span> <span class='hs-varid'>alias</span>
<a name="line-331"></a><span class='hs-varop'>&gt;</span>               <span class='hs-comment'>-- ignore an optional hint if this is sql server</span>
<a name="line-332"></a><span class='hs-varop'>&gt;</span>               <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-keyword'>do</span> <span class='hs-varid'>isSqlServer</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>guard</span>
<a name="line-333"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-varid'>optional</span> <span class='hs-varid'>tableHint</span>
<a name="line-334"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-335"></a><span class='hs-varop'>&gt;</span>                           <span class='hs-layout'>,</span><span class='hs-varid'>return</span> <span class='hs-conid'>()</span><span class='hs-keyglyph'>]</span>
<a name="line-336"></a><span class='hs-varop'>&gt;</span>               <span class='hs-comment'>-- wrap the tref from before with the alias</span>
<a name="line-337"></a><span class='hs-varop'>&gt;</span>               <span class='hs-comment'>-- if got one</span>
<a name="line-338"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>maybe</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span>
</pre>
<pre><a name="line-339"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>alias</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-layout'>(</span><span class='hs-conid'>TableRef</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TableRef</span><span class='hs-layout'>)</span>
<a name="line-340"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>alias</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-341"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-342"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>optionalSuffix</span>
<a name="line-343"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-layout'>(</span><span class='hs-conid'>TableAlias</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"as"</span><span class='hs-layout'>)</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>nameComponent</span><span class='hs-layout'>)</span>
<a name="line-344"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-layout'>(</span><span class='hs-conid'>FullAlias</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>parens</span> <span class='hs-varop'>$</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>nameComponent</span><span class='hs-layout'>)</span>
<a name="line-345"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>optionalJoinSuffix</span> <span class='hs-varid'>tr</span> <span class='hs-keyglyph'>=</span>
<a name="line-346"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>joinSuffix</span> <span class='hs-varid'>tr</span><span class='hs-layout'>)</span>
<a name="line-347"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>optionalAlias</span>
<a name="line-348"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>optionalJoinSuffix</span>
<a name="line-349"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-varid'>return</span> <span class='hs-varid'>tr</span><span class='hs-keyglyph'>]</span>
<a name="line-350"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>joinSuffix</span> <span class='hs-varid'>tr</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-351"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyword'>let</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getAnnotation</span> <span class='hs-varid'>tr</span>
<a name="line-352"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>(</span><span class='hs-varid'>nat</span><span class='hs-layout'>,</span><span class='hs-varid'>hint</span><span class='hs-layout'>,</span><span class='hs-varid'>jt</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>joinKw</span>
<a name="line-353"></a><span class='hs-varop'>&gt;</span>       <span class='hs-conid'>JoinTref</span> <span class='hs-varid'>p</span> <span class='hs-varid'>tr</span> <span class='hs-varid'>nat</span> <span class='hs-varid'>jt</span> <span class='hs-varid'>hint</span>
<a name="line-354"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>nonJoin</span>
<a name="line-355"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>onExpr</span>
<a name="line-356"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>joinKw</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-357"></a><span class='hs-varop'>&gt;</span>              <span class='hs-comment'>--look for the join flavour first</span>
<a name="line-358"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varid'>n</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>option</span> <span class='hs-conid'>Unnatural</span> <span class='hs-layout'>(</span><span class='hs-conid'>Natural</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"natural"</span><span class='hs-layout'>)</span>
<a name="line-359"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varid'>jt</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-360"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-conid'>LeftOuter</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"left"</span>
<a name="line-361"></a><span class='hs-varop'>&gt;</span>                                       <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"outer"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-362"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-layout'>,</span><span class='hs-conid'>RightOuter</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"right"</span>
<a name="line-363"></a><span class='hs-varop'>&gt;</span>                                        <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"outer"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-364"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-layout'>,</span><span class='hs-conid'>FullOuter</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"full"</span>
<a name="line-365"></a><span class='hs-varop'>&gt;</span>                                       <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"outer"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-366"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-layout'>,</span><span class='hs-conid'>Cross</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"cross"</span>
<a name="line-367"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-layout'>,</span><span class='hs-conid'>Inner</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"inner"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-368"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varid'>hint</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>option</span> <span class='hs-conid'>Nothing</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Merge</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"merge"</span>
<a name="line-369"></a><span class='hs-varop'>&gt;</span>                                                      <span class='hs-layout'>,</span><span class='hs-conid'>Loop</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"loop"</span>
<a name="line-370"></a><span class='hs-varop'>&gt;</span>                                                      <span class='hs-layout'>,</span><span class='hs-conid'>Hash</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"hash"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-371"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varid'>keyword</span> <span class='hs-str'>"join"</span>
<a name="line-372"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span><span class='hs-layout'>,</span><span class='hs-varid'>hint</span><span class='hs-layout'>,</span><span class='hs-varid'>jt</span><span class='hs-layout'>)</span>
<a name="line-373"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>onExpr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span>
<a name="line-374"></a><span class='hs-varop'>&gt;</span>              <span class='hs-keyglyph'>[</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>JoinOn</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"on"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-375"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>JoinUsing</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-376"></a><span class='hs-varop'>&gt;</span>                                   <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"using"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>columnNameList</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-377"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-varid'>return</span> <span class='hs-conid'>Nothing</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-378"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>tableHint</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
</pre>
just acts as an incomplete recogniser for table hints:
it doesn't accept all valid table hints
and doesn't reject all invalid table hints
and it doesn't return anything in the ast
but allows you to parse some queries containing with hints and get
everything else

<pre><a name="line-379"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"with"</span>
<a name="line-380"></a><span class='hs-varop'>&gt;</span>           <span class='hs-comment'>-- just allows any list of identifiers</span>
<a name="line-381"></a><span class='hs-varop'>&gt;</span>           <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>parens</span> <span class='hs-varop'>$</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>idString</span>
<a name="line-382"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-383"></a><span class='hs-varop'>&gt;</span>
<a name="line-384"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>optParens</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-varid'>a</span>
<a name="line-385"></a><span class='hs-varop'>&gt;</span>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-varid'>a</span>
<a name="line-386"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>optParens</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>parens</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>p</span>
</pre>

insert, update and delete
-------------------------

insert statement: supports option column name list,
multiple rows to insert and insert from select statements

<pre><a name="line-387"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>insert</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-388"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>insert</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Insert</span>
<a name="line-389"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"insert"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"into"</span>
<a name="line-390"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
<a name="line-391"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>(</span><span class='hs-varid'>try</span> <span class='hs-varid'>columnNameList</span><span class='hs-layout'>)</span>
<a name="line-392"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>pQueryExpr</span>
<a name="line-393"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>tryOptionMaybe</span> <span class='hs-varid'>returning</span>
<a name="line-394"></a><span class='hs-varop'>&gt;</span>
<a name="line-395"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>update</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-396"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>update</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Update</span>
<a name="line-397"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"update"</span>
<a name="line-398"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
<a name="line-399"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"set"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>setClause</span><span class='hs-layout'>)</span>
<a name="line-400"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"from"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>tableRef</span><span class='hs-layout'>)</span>
<a name="line-401"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>tryOptionMaybe</span> <span class='hs-varid'>whereClause</span>
<a name="line-402"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>tryOptionMaybe</span> <span class='hs-varid'>returning</span>
<a name="line-403"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>where</span>
<a name="line-404"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>setClause</span> <span class='hs-keyglyph'>=</span>
<a name="line-405"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-keyword'>do</span>
<a name="line-406"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-407"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>l</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>commaSep1</span> <span class='hs-varid'>nameComponent</span><span class='hs-layout'>)</span>
<a name="line-408"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>symbol</span> <span class='hs-str'>"="</span>
<a name="line-409"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>r</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>commaSep1</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-410"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>MultiSetClause</span> <span class='hs-varid'>p</span> <span class='hs-varid'>l</span> <span class='hs-varop'>$</span> <span class='hs-conid'>SpecialOp</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-varid'>nm</span> <span class='hs-varid'>p</span> <span class='hs-str'>"rowctor"</span><span class='hs-layout'>)</span> <span class='hs-varid'>r</span>
<a name="line-411"></a><span class='hs-varop'>&gt;</span>         <span class='hs-layout'>,</span><span class='hs-keyword'>do</span>
<a name="line-412"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-413"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>l</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nameComponent</span>
<a name="line-414"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>symbol</span> <span class='hs-str'>"="</span>
<a name="line-415"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>r</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>expr</span>
<a name="line-416"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>SetClause</span> <span class='hs-varid'>p</span> <span class='hs-varid'>l</span> <span class='hs-varid'>r</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-417"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>nm</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Annotation</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span>
<a name="line-418"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>nm</span> <span class='hs-varid'>a</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Name</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Nmc</span> <span class='hs-varop'>$</span> <span class='hs-conid'>T</span><span class='hs-varop'>.</span><span class='hs-varid'>unpack</span> <span class='hs-varid'>s</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-419"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>delete</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-420"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>delete</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Delete</span>
<a name="line-421"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"delete"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"from"</span>
<a name="line-422"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
<a name="line-423"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"using"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>tableRef</span><span class='hs-layout'>)</span>
<a name="line-424"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>tryOptionMaybe</span> <span class='hs-varid'>whereClause</span>
<a name="line-425"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>tryOptionMaybe</span> <span class='hs-varid'>returning</span>
<a name="line-426"></a><span class='hs-varop'>&gt;</span>
</pre>
other dml-type stuff
--------------------

<pre><a name="line-427"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>truncateSt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-428"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>truncateSt</span> <span class='hs-keyglyph'>=</span>
<a name="line-429"></a><span class='hs-varop'>&gt;</span>            <span class='hs-conid'>Truncate</span>
<a name="line-430"></a><span class='hs-varop'>&gt;</span>            <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"truncate"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"table"</span><span class='hs-layout'>)</span>
<a name="line-431"></a><span class='hs-varop'>&gt;</span>            <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>name</span>
<a name="line-432"></a><span class='hs-varop'>&gt;</span>            <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-conid'>ContinueIdentity</span> <span class='hs-layout'>(</span><span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-433"></a><span class='hs-varop'>&gt;</span>                                 <span class='hs-conid'>ContinueIdentity</span> <span class='hs-varop'>&lt;$</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"continue"</span>
<a name="line-434"></a><span class='hs-varop'>&gt;</span>                                                      <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"identity"</span><span class='hs-layout'>)</span>
<a name="line-435"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-layout'>,</span><span class='hs-conid'>RestartIdentity</span> <span class='hs-varop'>&lt;$</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"restart"</span>
<a name="line-436"></a><span class='hs-varop'>&gt;</span>                                                     <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"identity"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-437"></a><span class='hs-varop'>&gt;</span>            <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>cascade</span>
<a name="line-438"></a><span class='hs-varop'>&gt;</span>
<a name="line-439"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>copy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-440"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>copy</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-441"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-442"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>keyword</span> <span class='hs-str'>"copy"</span>
<a name="line-443"></a><span class='hs-varop'>&gt;</span>        <span class='hs-comment'>-- todo: factor this a bit better</span>
</pre>
<pre><a name="line-444"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>choice</span> <span class='hs-comment'>-- left factoring to preserve error messages</span>
<a name="line-445"></a><span class='hs-varop'>&gt;</span>          <span class='hs-keyglyph'>[</span> <span class='hs-varid'>parens</span> <span class='hs-varid'>pQueryExpr</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>to</span> <span class='hs-varid'>p</span> <span class='hs-varop'>.</span> <span class='hs-conid'>CopyQuery</span>
<a name="line-446"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span> <span class='hs-keyword'>do</span> <span class='hs-layout'>(</span><span class='hs-varid'>tblName</span><span class='hs-layout'>,</span> <span class='hs-varid'>cols</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>liftA2</span> <span class='hs-conid'>(,)</span> <span class='hs-varid'>name</span> <span class='hs-layout'>(</span><span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>(</span><span class='hs-varid'>parens</span> <span class='hs-varop'>$</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>nameComponent</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-447"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varid'>choice</span>
<a name="line-448"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-keyglyph'>[</span> <span class='hs-varid'>from</span> <span class='hs-varid'>p</span> <span class='hs-varid'>tblName</span> <span class='hs-varid'>cols</span>
<a name="line-449"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-layout'>,</span> <span class='hs-varid'>to</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>CopyTable</span> <span class='hs-varid'>tblName</span> <span class='hs-varid'>cols</span><span class='hs-layout'>)</span>
<a name="line-450"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-keyglyph'>]</span>
<a name="line-451"></a><span class='hs-varop'>&gt;</span>          <span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-452"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-453"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>from</span> <span class='hs-varid'>p</span> <span class='hs-varid'>tableName</span> <span class='hs-varid'>cols</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-454"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>keyword</span> <span class='hs-str'>"from"</span>
<a name="line-455"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>src</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-456"></a><span class='hs-varop'>&gt;</span>                <span class='hs-conid'>CopyFilename</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>extrStr</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>stringLit</span>
<a name="line-457"></a><span class='hs-varop'>&gt;</span>               <span class='hs-layout'>,</span><span class='hs-conid'>Stdin</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"stdin"</span><span class='hs-keyglyph'>]</span>
<a name="line-458"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>opts</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-459"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varid'>keyword</span> <span class='hs-str'>"with"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>copyFromOptions</span>
<a name="line-460"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>CopyFrom</span> <span class='hs-varid'>p</span> <span class='hs-varid'>tableName</span> <span class='hs-varid'>cols</span> <span class='hs-varid'>src</span> <span class='hs-varid'>opts</span>
<a name="line-461"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>to</span> <span class='hs-varid'>p</span> <span class='hs-varid'>src</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-462"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>keyword</span> <span class='hs-str'>"to"</span>
<a name="line-463"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>fn</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>extrStr</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>stringLit</span>
<a name="line-464"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>opts</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-465"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varid'>keyword</span> <span class='hs-str'>"with"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>copyToOptions</span>
<a name="line-466"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>CopyTo</span> <span class='hs-varid'>p</span> <span class='hs-varid'>src</span> <span class='hs-varid'>fn</span> <span class='hs-varid'>opts</span>
</pre>
<pre><a name="line-467"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>copyToOptions</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-468"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>permute</span> <span class='hs-layout'>(</span><span class='hs-conid'>(,,,)</span>
<a name="line-469"></a><span class='hs-varop'>&gt;</span>                             <span class='hs-varop'>&lt;$?&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-conid'>CopyToFormat</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-470"></a><span class='hs-varop'>&gt;</span>                                              <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"format"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>idString</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-471"></a><span class='hs-varop'>&gt;</span>                             <span class='hs-varop'>&lt;|?&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-conid'>CopyToDelimiter</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-472"></a><span class='hs-varop'>&gt;</span>                                              <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"delimiter"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>stringN</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-473"></a><span class='hs-varop'>&gt;</span>                             <span class='hs-varop'>&lt;|?&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-conid'>CopyToErrorLog</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-474"></a><span class='hs-varop'>&gt;</span>                                              <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"error_log"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>stringN</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-475"></a><span class='hs-varop'>&gt;</span>                             <span class='hs-varop'>&lt;|?&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-conid'>CopyToErrorVerbosity</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-476"></a><span class='hs-varop'>&gt;</span>                                              <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"error_verbosity"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>integer</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-477"></a><span class='hs-varop'>&gt;</span>                            <span class='hs-layout'>)</span>
<a name="line-478"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>catMaybes</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>d</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-479"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>copyFromOptions</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-480"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>d</span><span class='hs-layout'>,</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>f</span><span class='hs-layout'>,</span><span class='hs-varid'>g</span><span class='hs-layout'>,</span><span class='hs-varid'>h</span><span class='hs-layout'>,</span><span class='hs-varid'>i</span><span class='hs-layout'>,</span><span class='hs-varid'>j</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>permute</span> <span class='hs-layout'>(</span><span class='hs-conid'>(,,,,,,,,,)</span>
<a name="line-481"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-varop'>&lt;$?&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-conid'>CopyFromFormat</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-482"></a><span class='hs-varop'>&gt;</span>                                           <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"format"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>idString</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-483"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-varop'>&lt;|?&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-conid'>CopyFromDelimiter</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-484"></a><span class='hs-varop'>&gt;</span>                                           <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"delimiter"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>stringN</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-485"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-varop'>&lt;|?&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-conid'>CopyFromErrorLog</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-486"></a><span class='hs-varop'>&gt;</span>                                           <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"error_log"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>stringN</span> <span class='hs-varop'>&lt;?&gt;</span> <span class='hs-str'>"path wrapped in apostrophes. for example: 'file.csv'."</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-487"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-varop'>&lt;|?&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-conid'>CopyFromErrorVerbosity</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-488"></a><span class='hs-varop'>&gt;</span>                                           <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"error_verbosity"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>integer</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-489"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-varop'>&lt;|?&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-conid'>CopyFromParsers</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-490"></a><span class='hs-varop'>&gt;</span>                                           <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"parsers"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>stringN</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;?&gt;</span> <span class='hs-str'>"list of parsers"</span><span class='hs-layout'>)</span>
<a name="line-491"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-varop'>&lt;|?&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>CopyFromDirectory</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"directory"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-492"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-varop'>&lt;|?&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-conid'>CopyFromOffset</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-493"></a><span class='hs-varop'>&gt;</span>                                           <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"offset"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>integer</span> <span class='hs-varop'>&lt;?&gt;</span> <span class='hs-str'>"positive integer"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;?&gt;</span> <span class='hs-str'>"offset with integer"</span><span class='hs-layout'>)</span>
<a name="line-494"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-varop'>&lt;|?&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-conid'>CopyFromLimit</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-495"></a><span class='hs-varop'>&gt;</span>                                           <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"limit"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>integer</span> <span class='hs-varop'>&lt;?&gt;</span> <span class='hs-str'>"positive integer"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;?&gt;</span> <span class='hs-str'>"limit with integer"</span><span class='hs-layout'>)</span>
<a name="line-496"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-varop'>&lt;|?&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-conid'>CopyFromErrorThreshold</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-497"></a><span class='hs-varop'>&gt;</span>                                           <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"stop"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"after"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>integer</span> <span class='hs-varop'>&lt;?&gt;</span> <span class='hs-str'>"positive integer"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"errors"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-498"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-varop'>&lt;|?&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-conid'>CopyFromNewlineFormat</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-499"></a><span class='hs-varop'>&gt;</span>                                           <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"record"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"delimiter"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>stringN</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-500"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-layout'>)</span>
<a name="line-501"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>catMaybes</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span><span class='hs-varid'>d</span><span class='hs-layout'>,</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>f</span><span class='hs-layout'>,</span><span class='hs-varid'>g</span><span class='hs-layout'>,</span><span class='hs-varid'>h</span><span class='hs-layout'>,</span><span class='hs-varid'>i</span><span class='hs-layout'>,</span><span class='hs-varid'>j</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-502"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>copyData</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-503"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>copyData</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CopyData</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>mytoken</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>tok</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-504"></a><span class='hs-varop'>&gt;</span>                                         <span class='hs-keyword'>case</span> <span class='hs-varid'>tok</span> <span class='hs-keyword'>of</span>
<a name="line-505"></a><span class='hs-varop'>&gt;</span>                                                  <span class='hs-conid'>Lex</span><span class='hs-varop'>.</span><span class='hs-conid'>CopyPayload</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>n</span>
<a name="line-506"></a><span class='hs-varop'>&gt;</span>                                                  <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-507"></a><span class='hs-varop'>&gt;</span>
</pre>
--------------------------------------------------------------------------------

misc
====

<pre><a name="line-508"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>set</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-509"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>set</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Set</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-510"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"set"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>idString</span><span class='hs-layout'>)</span>
<a name="line-511"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"to"</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>"="</span><span class='hs-layout'>)</span> <span class='hs-varop'>*&gt;</span>
<a name="line-512"></a><span class='hs-varop'>&gt;</span>            <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>sv</span><span class='hs-layout'>)</span>
<a name="line-513"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-514"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>sv</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-515"></a><span class='hs-varop'>&gt;</span>               <span class='hs-conid'>SetStr</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>stringN</span>
<a name="line-516"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>SetId</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>idString</span>
<a name="line-517"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>SetNum</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromInteger</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>integer</span><span class='hs-layout'>)</span>
<a name="line-518"></a><span class='hs-varop'>&gt;</span>                                   <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>read</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>numString</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-519"></a><span class='hs-varop'>&gt;</span>
<a name="line-520"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>notify</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-521"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>notify</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Notify</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-522"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"notify"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>idString</span><span class='hs-layout'>)</span>
</pre>
--------------------------------------------------------------------------------
 
ddl
===

<pre><a name="line-523"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createTable</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-524"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createTable</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-525"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-526"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>rep</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>NoReplace</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"table"</span>
<a name="line-527"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-layout'>,</span><span class='hs-conid'>Replace</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>mapM_</span> <span class='hs-varid'>keyword</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"or"</span><span class='hs-layout'>,</span> <span class='hs-str'>"replace"</span><span class='hs-layout'>,</span> <span class='hs-str'>"table"</span><span class='hs-keyglyph'>]</span>
<a name="line-528"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-keyglyph'>]</span> 
<a name="line-529"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>tname</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>name</span>
<a name="line-530"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-531"></a><span class='hs-varop'>&gt;</span>      <span class='hs-conid'>CreateTableAs</span> <span class='hs-varid'>p</span> <span class='hs-varid'>tname</span> <span class='hs-varid'>rep</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"as"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>pQueryExpr</span><span class='hs-layout'>)</span>
<a name="line-532"></a><span class='hs-varop'>&gt;</span>                            
<a name="line-533"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-keyword'>do</span>
<a name="line-534"></a><span class='hs-varop'>&gt;</span>      <span class='hs-layout'>(</span><span class='hs-varid'>atts</span><span class='hs-layout'>,</span><span class='hs-varid'>cons</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>readAttsAndCons</span>
<a name="line-535"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>pdata</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>readPartition</span>
<a name="line-536"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>CreateTable</span> <span class='hs-varid'>p</span> <span class='hs-varid'>tname</span> <span class='hs-varid'>atts</span> <span class='hs-varid'>cons</span> <span class='hs-varid'>pdata</span> <span class='hs-varid'>rep</span>
<a name="line-537"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyglyph'>]</span>
<a name="line-538"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-539"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>--parse the unordered list of attribute defs or constraints, for</span>
<a name="line-540"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>--each line want to try the constraint parser first, then the</span>
<a name="line-541"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>--attribute parser, so you need the swap to feed them in the</span>
<a name="line-542"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>--right order into createtable</span>
<a name="line-543"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>readAttsAndCons</span> <span class='hs-keyglyph'>=</span>
<a name="line-544"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>swap</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>multiPerm</span>
<a name="line-545"></a><span class='hs-varop'>&gt;</span>                                  <span class='hs-layout'>(</span><span class='hs-varid'>try</span> <span class='hs-varid'>tableConstraint</span><span class='hs-layout'>)</span>
<a name="line-546"></a><span class='hs-varop'>&gt;</span>                                  <span class='hs-varid'>tableAttribute</span>
<a name="line-547"></a><span class='hs-varop'>&gt;</span>                                  <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>","</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-548"></a><span class='hs-varop'>&gt;</span>               <span class='hs-keyword'>where</span> <span class='hs-varid'>swap</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-549"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>readPartition</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tryOptionMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>tablePartition</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-550"></a><span class='hs-varop'>&gt;</span>
<a name="line-551"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>tableAttribute</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>AttributeDef</span>
<a name="line-552"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>tableAttribute</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AttributeDef</span>
<a name="line-553"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-554"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>nameComponent</span>
<a name="line-555"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>typeName</span>
<a name="line-556"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>tryOptionMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"default"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-557"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>many</span> <span class='hs-varid'>rowConstraint</span>
<a name="line-558"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-559"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>rowConstraint</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-560"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-561"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>cn</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>option</span> <span class='hs-str'>""</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"constraint"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>idString</span><span class='hs-layout'>)</span>
<a name="line-562"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-563"></a><span class='hs-varop'>&gt;</span>           <span class='hs-conid'>RowUniqueConstraint</span> <span class='hs-varid'>p</span> <span class='hs-varid'>cn</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"unique"</span>
<a name="line-564"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-conid'>RowPrimaryKeyConstraint</span> <span class='hs-varid'>p</span> <span class='hs-varid'>cn</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"primary"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"key"</span>
<a name="line-565"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-conid'>RowCheckConstraint</span> <span class='hs-varid'>p</span> <span class='hs-varid'>cn</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"check"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-566"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-conid'>NullConstraint</span> <span class='hs-varid'>p</span> <span class='hs-varid'>cn</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"null"</span>
<a name="line-567"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-conid'>NotNullConstraint</span> <span class='hs-varid'>p</span> <span class='hs-varid'>cn</span> <span class='hs-varop'>&lt;$</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"not"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"null"</span><span class='hs-layout'>)</span>
<a name="line-568"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-conid'>IdentityConstraint</span> <span class='hs-varid'>p</span> <span class='hs-varid'>cn</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"identity"</span> <span class='hs-varop'>*&gt;</span>
<a name="line-569"></a><span class='hs-varop'>&gt;</span>                                        <span class='hs-varid'>tryOptionMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>parens</span> <span class='hs-varop'>$</span> <span class='hs-conid'>(,)</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-570"></a><span class='hs-varop'>&gt;</span>                                          <span class='hs-varid'>signedInteger</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>","</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>signedInteger</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-571"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-conid'>RowReferenceConstraint</span> <span class='hs-varid'>p</span> <span class='hs-varid'>cn</span>
<a name="line-572"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"references"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-573"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-conid'>Nothing</span> <span class='hs-layout'>(</span><span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-varid'>parens</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>nameComponent</span><span class='hs-layout'>)</span>
<a name="line-574"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>onDelete</span>
<a name="line-575"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>onUpdate</span>
<a name="line-576"></a><span class='hs-varop'>&gt;</span>          <span class='hs-keyglyph'>]</span>
<a name="line-577"></a><span class='hs-varop'>&gt;</span>
</pre>
<pre><a name="line-578"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>tablePartition</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>TablePartitionDef</span>
<a name="line-579"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>tablePartition</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-580"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-581"></a><span class='hs-varop'>&gt;</span>          <span class='hs-comment'>-- partition by range (&lt;col name&gt;) ( every 5 minutes )</span>
<a name="line-582"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>cn</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"partition"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"by"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"range"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>parens</span> <span class='hs-varid'>nameComponent</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-583"></a><span class='hs-varop'>&gt;</span>         <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>parens</span> <span class='hs-varop'>$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"every"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-conid'>(,)</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-584"></a><span class='hs-varop'>&gt;</span>                                         <span class='hs-layout'>(</span><span class='hs-varid'>option</span> <span class='hs-num'>1</span> <span class='hs-varid'>integer</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>timeframe</span><span class='hs-layout'>)</span>
<a name="line-585"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>TablePartitionDef</span> <span class='hs-varid'>p</span> <span class='hs-varid'>cn</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-586"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-587"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>timeframe</span> <span class='hs-keyglyph'>=</span>
<a name="line-588"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Year</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"years"</span>
<a name="line-589"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>Year</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"year"</span>
<a name="line-590"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>Month</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"months"</span>
<a name="line-591"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>Month</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"month"</span>
<a name="line-592"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>Day</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"days"</span>
<a name="line-593"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>Day</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"day"</span>
<a name="line-594"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>Hour</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"hours"</span>
<a name="line-595"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>Hour</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"hour"</span>
<a name="line-596"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>Minute</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"minutes"</span>
<a name="line-597"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>Minute</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"minute"</span>
<a name="line-598"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>Second</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"seconds"</span>
<a name="line-599"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>Second</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"second"</span>
<a name="line-600"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>Millisecond</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"milliseconds"</span>
<a name="line-601"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>Millisecond</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"millisecond"</span>
<a name="line-602"></a><span class='hs-varop'>&gt;</span>              <span class='hs-keyglyph'>]</span>
<a name="line-603"></a><span class='hs-varop'>&gt;</span>
<a name="line-604"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>onDelete</span><span class='hs-layout'>,</span><span class='hs-varid'>onUpdate</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Cascade</span>
<a name="line-605"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>onDelete</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>onSomething</span> <span class='hs-str'>"delete"</span>
<a name="line-606"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>onUpdate</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>onSomething</span> <span class='hs-str'>"update"</span>
<a name="line-607"></a><span class='hs-varop'>&gt;</span>
<a name="line-608"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>onSomething</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Cascade</span>
<a name="line-609"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>onSomething</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>option</span> <span class='hs-conid'>Restrict</span> <span class='hs-varop'>$</span> <span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"on"</span>
<a name="line-610"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-varid'>k</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>cascade</span>
<a name="line-611"></a><span class='hs-varop'>&gt;</span>
<a name="line-612"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>tableConstraint</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Constraint</span>
<a name="line-613"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>tableConstraint</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-614"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-615"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varid'>cn</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>option</span> <span class='hs-str'>""</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"constraint"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-str'>""</span> <span class='hs-varid'>conName</span><span class='hs-layout'>)</span>
<a name="line-616"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-617"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-conid'>UniqueConstraint</span> <span class='hs-varid'>p</span> <span class='hs-varid'>cn</span>
<a name="line-618"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"unique"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>optParens</span> <span class='hs-varid'>columnNameList</span><span class='hs-layout'>)</span>
<a name="line-619"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-layout'>,</span><span class='hs-conid'>PrimaryKeyConstraint</span> <span class='hs-varid'>p</span> <span class='hs-varid'>cn</span>
<a name="line-620"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"primary"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"key"</span>
<a name="line-621"></a><span class='hs-varop'>&gt;</span>                                     <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-622"></a><span class='hs-varop'>&gt;</span>                                             <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>nameComponent</span>
<a name="line-623"></a><span class='hs-varop'>&gt;</span>                                            <span class='hs-layout'>,</span><span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>commaSep1</span> <span class='hs-varid'>nameComponent</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-624"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-layout'>,</span><span class='hs-conid'>CheckConstraint</span> <span class='hs-varid'>p</span> <span class='hs-varid'>cn</span>
<a name="line-625"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;$&gt;</span><span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"check"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-626"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-layout'>,</span><span class='hs-conid'>ReferenceConstraint</span> <span class='hs-varid'>p</span> <span class='hs-varid'>cn</span>
<a name="line-627"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"foreign"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"key"</span>
<a name="line-628"></a><span class='hs-varop'>&gt;</span>                             <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>commaSep1</span> <span class='hs-varid'>nameComponent</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-629"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"references"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-630"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>(</span><span class='hs-varid'>parens</span> <span class='hs-varop'>$</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>nameComponent</span><span class='hs-layout'>)</span>
<a name="line-631"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>onUpdate</span>
<a name="line-632"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>onDelete</span><span class='hs-keyglyph'>]</span>
<a name="line-633"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-keyword'>where</span>
<a name="line-634"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-varid'>conName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-635"></a><span class='hs-varop'>&gt;</span>                             <span class='hs-varid'>x</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>idString</span>
<a name="line-636"></a><span class='hs-varop'>&gt;</span>                             <span class='hs-keyword'>if</span> <span class='hs-varid'>map</span> <span class='hs-varid'>toLower</span> <span class='hs-varid'>x</span> <span class='hs-varop'>`elem`</span> <span class='hs-keyglyph'>[</span>
<a name="line-637"></a><span class='hs-varop'>&gt;</span>                                     <span class='hs-str'>"unique"</span>
<a name="line-638"></a><span class='hs-varop'>&gt;</span>                                    <span class='hs-layout'>,</span><span class='hs-str'>"primary"</span>
<a name="line-639"></a><span class='hs-varop'>&gt;</span>                                    <span class='hs-layout'>,</span><span class='hs-str'>"check"</span>
<a name="line-640"></a><span class='hs-varop'>&gt;</span>                                    <span class='hs-layout'>,</span><span class='hs-str'>"foreign"</span>
<a name="line-641"></a><span class='hs-varop'>&gt;</span>                                    <span class='hs-layout'>,</span><span class='hs-str'>"references"</span><span class='hs-keyglyph'>]</span>
<a name="line-642"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-keyword'>then</span> <span class='hs-varid'>fail</span> <span class='hs-varop'>$</span> <span class='hs-str'>"not keyword (constraint name): "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>x</span>
<a name="line-643"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-keyword'>else</span> <span class='hs-varid'>return</span> <span class='hs-varid'>x</span>
<a name="line-644"></a><span class='hs-varop'>&gt;</span>
<a name="line-645"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>alterDatabase</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-646"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>alterDatabase</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlterDatabase</span>
<a name="line-647"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"database"</span><span class='hs-layout'>)</span>
<a name="line-648"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
<a name="line-649"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>operation</span>
<a name="line-650"></a><span class='hs-varop'>&gt;</span>  <span class='hs-keyword'>where</span>
<a name="line-651"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>operation</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>try</span> <span class='hs-varid'>renameDatabase</span>
<a name="line-652"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>renameDatabase</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RenameDatabase</span>
<a name="line-653"></a><span class='hs-varop'>&gt;</span>                      <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"rename"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"to"</span><span class='hs-layout'>)</span>
<a name="line-654"></a><span class='hs-varop'>&gt;</span>                      <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
<a name="line-655"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>alterTable</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-656"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>alterTable</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlterTable</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"table"</span>
<a name="line-657"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"only"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-658"></a><span class='hs-varop'>&gt;</span>                         <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
<a name="line-659"></a><span class='hs-varop'>&gt;</span>                         <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>operation</span>
<a name="line-660"></a><span class='hs-varop'>&gt;</span>              <span class='hs-keyword'>where</span>
<a name="line-661"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>operation</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>try</span> <span class='hs-varid'>renameTable</span><span class='hs-layout'>,</span><span class='hs-varid'>try</span> <span class='hs-varid'>renameColumn</span><span class='hs-layout'>,</span><span class='hs-varid'>actions</span><span class='hs-keyglyph'>]</span>
<a name="line-662"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>renameTable</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RenameTable</span>
<a name="line-663"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"rename"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"to"</span><span class='hs-layout'>)</span>
<a name="line-664"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
<a name="line-665"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>renameColumn</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>RenameColumn</span>
<a name="line-666"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"rename"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"column"</span><span class='hs-layout'>)</span>
<a name="line-667"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>nameComponent</span>
<a name="line-668"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"to"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>nameComponent</span><span class='hs-layout'>)</span>
<a name="line-669"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>actions</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlterTableActions</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>action</span>
<a name="line-670"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>action</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>try</span> <span class='hs-varid'>addColumn</span>
<a name="line-671"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-layout'>,</span><span class='hs-varid'>try</span> <span class='hs-varid'>dropColumn</span>
<a name="line-672"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-layout'>,</span><span class='hs-varid'>try</span> <span class='hs-varid'>alterColumn</span>
<a name="line-673"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-layout'>,</span><span class='hs-varid'>addConstraint</span><span class='hs-keyglyph'>]</span>
<a name="line-674"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>addColumn</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AddColumn</span>
<a name="line-675"></a><span class='hs-varop'>&gt;</span>                            <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-676"></a><span class='hs-varop'>&gt;</span>                            <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"add"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"column"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>tableAttribute</span><span class='hs-layout'>)</span>
<a name="line-677"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>dropColumn</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DropColumn</span>
<a name="line-678"></a><span class='hs-varop'>&gt;</span>                             <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-679"></a><span class='hs-varop'>&gt;</span>                             <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"drop"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"column"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>nameComponent</span><span class='hs-layout'>)</span>
<a name="line-680"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>alterColumn</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlterColumn</span>
<a name="line-681"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"alter"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"column"</span><span class='hs-layout'>)</span>
<a name="line-682"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>nameComponent</span>
<a name="line-683"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>alterColumnAction</span>
<a name="line-684"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>alterColumnAction</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>try</span> <span class='hs-varid'>alterType</span>
<a name="line-685"></a><span class='hs-varop'>&gt;</span>                                           <span class='hs-layout'>,</span><span class='hs-varid'>try</span> <span class='hs-varid'>setNotNull</span>
<a name="line-686"></a><span class='hs-varop'>&gt;</span>                                           <span class='hs-layout'>,</span><span class='hs-varid'>try</span> <span class='hs-varid'>dropNotNull</span>
<a name="line-687"></a><span class='hs-varop'>&gt;</span>                                           <span class='hs-layout'>,</span><span class='hs-varid'>try</span> <span class='hs-varid'>setDefault</span>
<a name="line-688"></a><span class='hs-varop'>&gt;</span>                                           <span class='hs-layout'>,</span><span class='hs-varid'>dropDefault</span><span class='hs-keyglyph'>]</span>
<a name="line-689"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>alterType</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SetDataType</span>
<a name="line-690"></a><span class='hs-varop'>&gt;</span>                            <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-691"></a><span class='hs-varop'>&gt;</span>                            <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"set"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"data"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"type"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>typeName</span><span class='hs-layout'>)</span>
<a name="line-692"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>setNotNull</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SetNotNull</span>
<a name="line-693"></a><span class='hs-varop'>&gt;</span>                             <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"set"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"not"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"null"</span><span class='hs-layout'>)</span>
<a name="line-694"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>dropNotNull</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DropNotNull</span>
<a name="line-695"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"drop"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"not"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"null"</span><span class='hs-layout'>)</span>
<a name="line-696"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>setDefault</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SetDefault</span>
<a name="line-697"></a><span class='hs-varop'>&gt;</span>                             <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-698"></a><span class='hs-varop'>&gt;</span>                             <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"set"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"default"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-699"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>dropDefault</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DropDefault</span>
<a name="line-700"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"drop"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"default"</span><span class='hs-layout'>)</span>
<a name="line-701"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>addConstraint</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AddConstraint</span>
<a name="line-702"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"add"</span><span class='hs-layout'>)</span>
<a name="line-703"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>tableConstraint</span>
<a name="line-704"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-705"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createType</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CreateType</span>
<a name="line-706"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"type"</span>
<a name="line-707"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
<a name="line-708"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"as"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>commaSep1</span> <span class='hs-varid'>typeAtt</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-709"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-710"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>typeAtt</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TypeAttDef</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>nameComponent</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>typeName</span>
<a name="line-711"></a><span class='hs-varop'>&gt;</span>
<a name="line-712"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createSequence</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-713"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createSequence</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-714"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-715"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>keyword</span> <span class='hs-str'>"sequence"</span>
<a name="line-716"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>snm</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>name</span>
<a name="line-717"></a><span class='hs-varop'>&gt;</span>   <span class='hs-layout'>(</span><span class='hs-varid'>stw</span><span class='hs-layout'>,</span> <span class='hs-varid'>incr</span><span class='hs-layout'>,</span> <span class='hs-varid'>mn</span><span class='hs-layout'>,</span> <span class='hs-varid'>mx</span><span class='hs-layout'>,</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span>
<a name="line-718"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>permute</span> <span class='hs-layout'>(</span><span class='hs-conid'>(,,,,)</span> <span class='hs-varop'>&lt;$?&gt;</span> <span class='hs-layout'>(</span><span class='hs-num'>1</span><span class='hs-layout'>,</span><span class='hs-varid'>startWith</span><span class='hs-layout'>)</span>
<a name="line-719"></a><span class='hs-varop'>&gt;</span>                      <span class='hs-varop'>&lt;|?&gt;</span> <span class='hs-layout'>(</span><span class='hs-num'>1</span><span class='hs-layout'>,</span><span class='hs-varid'>increment</span><span class='hs-layout'>)</span>
<a name="line-720"></a><span class='hs-varop'>&gt;</span>                      <span class='hs-varop'>&lt;|?&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span> <span class='hs-varid'>sequenceMinValue</span><span class='hs-layout'>)</span>
<a name="line-721"></a><span class='hs-varop'>&gt;</span>                      <span class='hs-varop'>&lt;|?&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span> <span class='hs-varid'>sequenceMaxValue</span><span class='hs-layout'>)</span>
<a name="line-722"></a><span class='hs-varop'>&gt;</span>                      <span class='hs-varop'>&lt;|?&gt;</span> <span class='hs-layout'>(</span><span class='hs-num'>1</span><span class='hs-layout'>,</span> <span class='hs-varid'>cache</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-723"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>CreateSequence</span> <span class='hs-varid'>p</span> <span class='hs-varid'>snm</span> <span class='hs-varid'>incr</span> <span class='hs-varid'>mn</span> <span class='hs-varid'>mx</span> <span class='hs-varid'>stw</span> <span class='hs-varid'>c</span>
<a name="line-724"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-725"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>startWith</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"start"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"with"</span><span class='hs-layout'>)</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>integer</span>
<a name="line-726"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>increment</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"increment"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"by"</span><span class='hs-layout'>)</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>integer</span>
<a name="line-727"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>cache</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"cache"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>integer</span>
<a name="line-728"></a><span class='hs-varop'>&gt;</span>
<a name="line-729"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>alterSequence</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-730"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>alterSequence</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlterSequence</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-731"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"sequence"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-732"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>operation</span>
<a name="line-733"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-734"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>operation</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>try</span> <span class='hs-varid'>renameSequence</span><span class='hs-layout'>,</span><span class='hs-varid'>try</span> <span class='hs-varid'>changeOwner</span><span class='hs-layout'>,</span><span class='hs-varid'>actions</span><span class='hs-keyglyph'>]</span>
<a name="line-735"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>renameSequence</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlterSequenceRename</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"rename"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"to"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
<a name="line-736"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>changeOwner</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlterSequenceOwned</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"owned"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"by"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
<a name="line-737"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>actions</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlterSequenceActions</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>many1</span> <span class='hs-varid'>action</span>
<a name="line-738"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>action</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>try</span> <span class='hs-varid'>alterIncrement</span>
<a name="line-739"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-layout'>,</span><span class='hs-varid'>try</span> <span class='hs-varid'>alterMin</span>
<a name="line-740"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-layout'>,</span><span class='hs-varid'>try</span> <span class='hs-varid'>alterMax</span>
<a name="line-741"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-layout'>,</span><span class='hs-varid'>try</span> <span class='hs-varid'>alterStart</span>
<a name="line-742"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-layout'>,</span><span class='hs-varid'>try</span> <span class='hs-varid'>alterRestart</span>
<a name="line-743"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-layout'>,</span><span class='hs-varid'>alterCache</span><span class='hs-keyglyph'>]</span>
<a name="line-744"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>alterIncrement</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlterSequenceIncrement</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"increment"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"by"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>integer</span>
<a name="line-745"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>alterMin</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlterSequenceMin</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>sequenceMinValue</span>
<a name="line-746"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>alterMax</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlterSequenceMax</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>sequenceMaxValue</span>
<a name="line-747"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>alterStart</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlterSequenceStart</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"start"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"with"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>integer</span>
<a name="line-748"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>alterRestart</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlterSequenceRestart</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"restart"</span><span class='hs-layout'>)</span>
<a name="line-749"></a><span class='hs-varop'>&gt;</span>                                         <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>optionMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"with"</span><span class='hs-layout'>)</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>integer</span><span class='hs-layout'>)</span>
<a name="line-750"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>alterCache</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlterSequenceCache</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"cache"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>integer</span>
</pre>
<pre><a name="line-751"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>sequenceMinValue</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Integer</span><span class='hs-layout'>)</span>
<a name="line-752"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>sequenceMinValue</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"no"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"minvalue"</span><span class='hs-layout'>)</span>
<a name="line-753"></a><span class='hs-varop'>&gt;</span>                           <span class='hs-layout'>,</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"minvalue"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>integer</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-754"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>sequenceMaxValue</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Integer</span><span class='hs-layout'>)</span>
<a name="line-755"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>sequenceMaxValue</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"no"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"maxvalue"</span><span class='hs-layout'>)</span>
<a name="line-756"></a><span class='hs-varop'>&gt;</span>                           <span class='hs-layout'>,</span><span class='hs-conid'>Just</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"maxvalue"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>integer</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
</pre>



create function, support sql functions and plpgsql functions. Parses
the body in both cases and provides a statement list for the body
rather than just a string. TODO: maybe support other languages by
returning the function body just as a string instead of attempting to
parse it

<pre><a name="line-757"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createFunction</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-758"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createFunction</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-759"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-760"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>rep</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>NoReplace</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"function"</span>
<a name="line-761"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-layout'>,</span><span class='hs-conid'>Replace</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>mapM_</span> <span class='hs-varid'>keyword</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"or"</span><span class='hs-layout'>,</span> <span class='hs-str'>"replace"</span><span class='hs-layout'>,</span> <span class='hs-str'>"function"</span><span class='hs-keyglyph'>]</span>
<a name="line-762"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-keyglyph'>]</span>
<a name="line-763"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>fnName</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>name</span>
<a name="line-764"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>params</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>parens</span> <span class='hs-varop'>$</span> <span class='hs-varid'>commaSep</span> <span class='hs-varid'>param</span>
<a name="line-765"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>retType</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"returns"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>typeName</span>
<a name="line-766"></a><span class='hs-varop'>&gt;</span>   <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>bodypos</span><span class='hs-layout'>,</span><span class='hs-varid'>body</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>lang</span><span class='hs-layout'>,</span><span class='hs-varid'>vol</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span>
<a name="line-767"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>permute</span> <span class='hs-layout'>(</span><span class='hs-conid'>(,,)</span> <span class='hs-varop'>&lt;$$&gt;</span> <span class='hs-varid'>parseAs</span>
<a name="line-768"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-varop'>&lt;||&gt;</span> <span class='hs-varid'>readLang</span>
<a name="line-769"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-varop'>&lt;|?&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Volatile</span><span class='hs-layout'>,</span><span class='hs-varid'>pVol</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-770"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>flg</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getState</span>
<a name="line-771"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>case</span> <span class='hs-varid'>parseBody</span> <span class='hs-varid'>flg</span> <span class='hs-varid'>lang</span> <span class='hs-varid'>body</span> <span class='hs-varid'>bodypos</span> <span class='hs-keyword'>of</span>
<a name="line-772"></a><span class='hs-varop'>&gt;</span>        <span class='hs-conid'>Left</span> <span class='hs-varid'>er</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fail</span> <span class='hs-varid'>er</span>
<a name="line-773"></a><span class='hs-varop'>&gt;</span>        <span class='hs-conid'>Right</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-774"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>CreateFunction</span> <span class='hs-varid'>p</span> <span class='hs-varid'>fnName</span> <span class='hs-varid'>params</span> <span class='hs-varid'>retType</span> <span class='hs-varid'>rep</span> <span class='hs-varid'>lang</span> <span class='hs-varid'>b</span> <span class='hs-varid'>vol</span>
<a name="line-775"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>where</span>
<a name="line-776"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>parseAs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-777"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varid'>keyword</span> <span class='hs-str'>"as"</span>
<a name="line-778"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varid'>bodypos</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>toMySp</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>getPosition</span>
<a name="line-779"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varid'>body</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>stringLit</span>
<a name="line-780"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>bodypos</span><span class='hs-layout'>,</span><span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-781"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>pVol</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>matchAKeyword</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-str'>"volatile"</span><span class='hs-layout'>,</span> <span class='hs-conid'>Volatile</span><span class='hs-layout'>)</span>
<a name="line-782"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-str'>"stable"</span><span class='hs-layout'>,</span> <span class='hs-conid'>Stable</span><span class='hs-layout'>)</span>
<a name="line-783"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-str'>"immutable"</span><span class='hs-layout'>,</span> <span class='hs-conid'>Immutable</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-784"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>readLang</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"language"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>matchAKeyword</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-str'>"plpgsql"</span><span class='hs-layout'>,</span> <span class='hs-conid'>Plpgsql</span><span class='hs-layout'>)</span>
<a name="line-785"></a><span class='hs-varop'>&gt;</span>                                                        <span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-str'>"sql"</span><span class='hs-layout'>,</span><span class='hs-conid'>Sql</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-786"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>parseBody</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ParseFlags</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Language</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ScalarExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>MySourcePos</span>
<a name="line-787"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>String</span> <span class='hs-conid'>FnBody</span>
<a name="line-788"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>parseBody</span> <span class='hs-varid'>flg</span> <span class='hs-varid'>lang</span> <span class='hs-varid'>body</span> <span class='hs-layout'>(</span><span class='hs-varid'>fileName</span><span class='hs-layout'>,</span><span class='hs-varid'>line</span><span class='hs-layout'>,</span><span class='hs-varid'>col</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-789"></a><span class='hs-varop'>&gt;</span>             <span class='hs-keyword'>case</span> <span class='hs-varid'>parseIt'</span>
<a name="line-790"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-layout'>(</span><span class='hs-varid'>functionBody</span> <span class='hs-varid'>lang</span><span class='hs-layout'>)</span>
<a name="line-791"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-varid'>flg</span>
<a name="line-792"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-varid'>fileName</span>
<a name="line-793"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>line</span><span class='hs-layout'>,</span><span class='hs-varid'>col</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-794"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-layout'>(</span><span class='hs-conid'>L</span><span class='hs-varop'>.</span><span class='hs-varid'>fromChunks</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>T</span><span class='hs-varop'>.</span><span class='hs-varid'>pack</span> <span class='hs-varop'>$</span> <span class='hs-varid'>extrStr</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-795"></a><span class='hs-varop'>&gt;</span>                      <span class='hs-conid'>Left</span> <span class='hs-varid'>er</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>ParseErrorExtra</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Left</span> <span class='hs-varop'>$</span> <span class='hs-varid'>show</span> <span class='hs-varid'>er</span>
<a name="line-796"></a><span class='hs-varop'>&gt;</span>                      <span class='hs-conid'>Right</span> <span class='hs-varid'>body'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Right</span> <span class='hs-varid'>body'</span>
<a name="line-797"></a><span class='hs-varop'>&gt;</span>         <span class='hs-comment'>-- sql function is just a list of statements, the last one</span>
<a name="line-798"></a><span class='hs-varop'>&gt;</span>         <span class='hs-comment'>-- has the trailing semicolon optional</span>
<a name="line-799"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>functionBody</span> <span class='hs-conid'>Sql</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-800"></a><span class='hs-varop'>&gt;</span>            <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-801"></a><span class='hs-varop'>&gt;</span>            <span class='hs-varid'>a</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>many</span> <span class='hs-layout'>(</span><span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-varid'>sqlStatement</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span>
<a name="line-802"></a><span class='hs-varop'>&gt;</span>            <span class='hs-comment'>-- this makes my head hurt, should probably write out</span>
<a name="line-803"></a><span class='hs-varop'>&gt;</span>            <span class='hs-comment'>-- more longhand</span>
<a name="line-804"></a><span class='hs-varop'>&gt;</span>            <span class='hs-conid'>SqlFnBody</span> <span class='hs-varid'>p</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>option</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-varop'>++</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>sqlStatement</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span>
<a name="line-805"></a><span class='hs-varop'>&gt;</span>         <span class='hs-comment'>-- plpgsql function has an optional declare section, plus</span>
<a name="line-806"></a><span class='hs-varop'>&gt;</span>         <span class='hs-comment'>-- the statements are enclosed in begin ... end; (semi colon</span>
<a name="line-807"></a><span class='hs-varop'>&gt;</span>         <span class='hs-comment'>-- after end is optional)</span>
<a name="line-808"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>functionBody</span> <span class='hs-conid'>Plpgsql</span> <span class='hs-keyglyph'>=</span>
<a name="line-809"></a><span class='hs-varop'>&gt;</span>             <span class='hs-conid'>PlpgsqlFnBody</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-810"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-811"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varid'>l</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>label</span>
<a name="line-812"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varid'>block</span> <span class='hs-varid'>p</span> <span class='hs-varid'>l</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>";"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>eof</span>
</pre>
params to a function

<pre><a name="line-813"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>param</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ParamDef</span>
<a name="line-814"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>param</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-815"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParamDef</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>nameComponent</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>typeName</span><span class='hs-layout'>)</span>
<a name="line-816"></a><span class='hs-varop'>&gt;</span>         <span class='hs-layout'>,</span><span class='hs-conid'>ParamDefTp</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>typeName</span><span class='hs-keyglyph'>]</span>
</pre>
variable declarations in a plpgsql function

<pre><a name="line-817"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>varDef</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>VarDef</span>
<a name="line-818"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>varDef</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-819"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-820"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>a</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nameComponent</span>
<a name="line-821"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-keyword'>do</span>
<a name="line-822"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>keyword</span> <span class='hs-str'>"alias"</span>
<a name="line-823"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>keyword</span> <span class='hs-str'>"for"</span>
<a name="line-824"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-825"></a><span class='hs-varop'>&gt;</span>             <span class='hs-conid'>VarAlias</span> <span class='hs-varid'>p</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>name</span>
<a name="line-826"></a><span class='hs-varop'>&gt;</span>            <span class='hs-layout'>,</span><span class='hs-conid'>ParamAlias</span> <span class='hs-varid'>p</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>liftPositionalArgTok</span><span class='hs-keyglyph'>]</span>
<a name="line-827"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-conid'>VarDef</span> <span class='hs-varid'>p</span> <span class='hs-varid'>a</span>
<a name="line-828"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>typeName</span>
<a name="line-829"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>tryOptionMaybe</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>":="</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>"="</span><span class='hs-layout'>)</span><span class='hs-varop'>*&gt;</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-830"></a><span class='hs-varop'>&gt;</span>           <span class='hs-keyglyph'>]</span>
<a name="line-831"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>";"</span>
<a name="line-832"></a><span class='hs-varop'>&gt;</span>
<a name="line-833"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createView</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-834"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createView</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CreateView</span>
<a name="line-835"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"view"</span>
<a name="line-836"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
<a name="line-837"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>tryOptionMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>parens</span> <span class='hs-varop'>$</span> <span class='hs-varid'>commaSep</span> <span class='hs-varid'>nameComponent</span><span class='hs-layout'>)</span>
<a name="line-838"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"as"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>pQueryExpr</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-839"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>alterView</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-840"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>alterView</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlterView</span>
<a name="line-841"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"view"</span>
<a name="line-842"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
<a name="line-843"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>tryOptionMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>parens</span> <span class='hs-varop'>$</span> <span class='hs-varid'>commaSep</span> <span class='hs-varid'>nameComponent</span><span class='hs-layout'>)</span>
<a name="line-844"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"as"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>pQueryExpr</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-845"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>alterSchema</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-846"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>alterSchema</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlterSchema</span>
<a name="line-847"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"schema"</span>
<a name="line-848"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>nameComponent</span>
<a name="line-849"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>operation</span>
<a name="line-850"></a><span class='hs-varop'>&gt;</span>             <span class='hs-keyword'>where</span>
<a name="line-851"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>operation</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>try</span> <span class='hs-varid'>changeOwner</span><span class='hs-layout'>,</span> <span class='hs-varid'>renameSchema</span><span class='hs-keyglyph'>]</span>
<a name="line-852"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>renameSchema</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlterSchemaName</span>
<a name="line-853"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"rename"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"to"</span><span class='hs-layout'>)</span>
<a name="line-854"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>nameComponent</span>
<a name="line-855"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>changeOwner</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AlterSchemaOwner</span>
<a name="line-856"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"owner"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"to"</span><span class='hs-layout'>)</span>
<a name="line-857"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
</pre>
<pre><a name="line-858"></a><span class='hs-varop'>&gt;</span>
<a name="line-859"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createDomain</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-860"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createDomain</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CreateDomain</span>
<a name="line-861"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"domain"</span>
<a name="line-862"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
<a name="line-863"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>tryOptionMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"as"</span><span class='hs-layout'>)</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>typeName</span><span class='hs-layout'>)</span>
<a name="line-864"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-str'>""</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"constraint"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>idString</span><span class='hs-layout'>)</span>
<a name="line-865"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>tryOptionMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"check"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-866"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createDatabase</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-867"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createDatabase</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CreateDatabase</span>
<a name="line-868"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"database"</span>
<a name="line-869"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
<a name="line-870"></a><span class='hs-varop'>&gt;</span>
</pre>
<pre><a name="line-871"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createSchema</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-872"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createSchema</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CreateSchema</span>
<a name="line-873"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"schema"</span>
<a name="line-874"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>nameComponent</span>
<a name="line-875"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>tryOptionMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"authorization"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-876"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>dropSomething</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-877"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>dropSomething</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-878"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-879"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>x</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-880"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-conid'>Domain</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"domain"</span>
<a name="line-881"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-layout'>,</span><span class='hs-conid'>Type</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"type"</span>
<a name="line-882"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-layout'>,</span><span class='hs-conid'>Table</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"table"</span>
<a name="line-883"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-layout'>,</span><span class='hs-conid'>View</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"view"</span>
<a name="line-884"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-layout'>,</span><span class='hs-conid'>Database</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"database"</span>
<a name="line-885"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-layout'>,</span><span class='hs-conid'>User</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"user"</span>
<a name="line-886"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-layout'>,</span><span class='hs-conid'>Login</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"login"</span>
<a name="line-887"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-layout'>,</span><span class='hs-conid'>Schema</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"schema"</span>
<a name="line-888"></a><span class='hs-varop'>&gt;</span>             <span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-889"></a><span class='hs-varop'>&gt;</span>   <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-layout'>,</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>parseDrop</span> <span class='hs-varid'>name</span>
<a name="line-890"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>DropSomething</span> <span class='hs-varid'>p</span> <span class='hs-varid'>x</span> <span class='hs-varid'>i</span> <span class='hs-varid'>e</span> <span class='hs-varid'>r</span>
<a name="line-891"></a><span class='hs-varop'>&gt;</span>
<a name="line-892"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>dropTrigger</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-893"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>dropTrigger</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-894"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-895"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"trigger"</span>
<a name="line-896"></a><span class='hs-varop'>&gt;</span>   <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-layout'>,</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>t</span><span class='hs-layout'>,</span><span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>parseDrop'</span> <span class='hs-varid'>nameComponent</span> <span class='hs-varid'>name</span>
<a name="line-897"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>DropTrigger</span> <span class='hs-varid'>p</span> <span class='hs-varid'>i</span> <span class='hs-varid'>e</span> <span class='hs-varid'>t</span> <span class='hs-varid'>r</span>
<a name="line-898"></a><span class='hs-varop'>&gt;</span>
<a name="line-899"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>dropFunction</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-900"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>dropFunction</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-901"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-902"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>keyword</span> <span class='hs-str'>"function"</span>
<a name="line-903"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-layout'>,</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span><span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>parseDrop</span> <span class='hs-varid'>pFun</span>
<a name="line-904"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>DropFunction</span> <span class='hs-varid'>p</span> <span class='hs-varid'>i</span> <span class='hs-varid'>e</span> <span class='hs-varid'>r</span>
<a name="line-905"></a><span class='hs-varop'>&gt;</span>                <span class='hs-keyword'>where</span>
<a name="line-906"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varid'>pFun</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>(,)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>name</span>
<a name="line-907"></a><span class='hs-varop'>&gt;</span>                             <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>commaSep</span> <span class='hs-varid'>typeName</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-908"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parseDrop</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-varid'>a</span>
<a name="line-909"></a><span class='hs-varop'>&gt;</span>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-layout'>(</span><span class='hs-conid'>IfExists</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-conid'>Cascade</span><span class='hs-layout'>)</span>
<a name="line-910"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parseDrop</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>(,,)</span>
<a name="line-911"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>ifExists</span>
<a name="line-912"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>p</span>
<a name="line-913"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>cascade</span>
<a name="line-914"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>where</span>
<a name="line-915"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>ifExists</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>option</span> <span class='hs-conid'>Require</span>
<a name="line-916"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-layout'>(</span><span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-conid'>IfExists</span> <span class='hs-varop'>&lt;$</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"if"</span>
<a name="line-917"></a><span class='hs-varop'>&gt;</span>                                      <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"exists"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-918"></a><span class='hs-varop'>&gt;</span>
<a name="line-919"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parseDrop'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-varid'>a</span>
<a name="line-920"></a><span class='hs-varop'>&gt;</span>            <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-varid'>b</span>
<a name="line-921"></a><span class='hs-varop'>&gt;</span>            <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-layout'>(</span><span class='hs-conid'>IfExists</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-conid'>Cascade</span><span class='hs-layout'>)</span>
<a name="line-922"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parseDrop'</span> <span class='hs-varid'>p</span> <span class='hs-varid'>q</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>(,,,)</span>
<a name="line-923"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>ifExists</span>
<a name="line-924"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>p</span>
<a name="line-925"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"on"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>q</span><span class='hs-layout'>)</span>
<a name="line-926"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>cascade</span>
<a name="line-927"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>where</span>
<a name="line-928"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>ifExists</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>option</span> <span class='hs-conid'>Require</span>
<a name="line-929"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-layout'>(</span><span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-conid'>IfExists</span> <span class='hs-varop'>&lt;$</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"if"</span>
<a name="line-930"></a><span class='hs-varop'>&gt;</span>                                      <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"exists"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-931"></a><span class='hs-varop'>&gt;</span>
<a name="line-932"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createLanguage</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-933"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createLanguage</span> <span class='hs-keyglyph'>=</span>
<a name="line-934"></a><span class='hs-varop'>&gt;</span>   <span class='hs-conid'>CreateLanguage</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-935"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"procedural"</span><span class='hs-layout'>)</span> <span class='hs-varop'>*&gt;</span>
<a name="line-936"></a><span class='hs-varop'>&gt;</span>                       <span class='hs-varid'>keyword</span> <span class='hs-str'>"language"</span> <span class='hs-varop'>*&gt;</span>
<a name="line-937"></a><span class='hs-varop'>&gt;</span>                       <span class='hs-varid'>idString</span><span class='hs-layout'>)</span>
<a name="line-938"></a><span class='hs-varop'>&gt;</span>
<a name="line-939"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createTrigger</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-940"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createTrigger</span> <span class='hs-keyglyph'>=</span>
<a name="line-941"></a><span class='hs-varop'>&gt;</span>   <span class='hs-conid'>CreateTrigger</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-942"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"trigger"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>nameComponent</span><span class='hs-layout'>)</span>
<a name="line-943"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>twhen</span>
<a name="line-944"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>tevents</span>
<a name="line-945"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"on"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-946"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>tfiring</span>
<a name="line-947"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"execute"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"procedure"</span>
<a name="line-948"></a><span class='hs-varop'>&gt;</span>                      <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-949"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>commaSep</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-950"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-951"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>twhen</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TriggerBefore</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"before"</span>
<a name="line-952"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-layout'>,</span><span class='hs-conid'>TriggerAfter</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"after"</span><span class='hs-keyglyph'>]</span>
<a name="line-953"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>tevents</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TriggerEvent</span><span class='hs-keyglyph'>]</span>
<a name="line-954"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>tevents</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sepBy1</span> <span class='hs-layout'>(</span><span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-955"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-conid'>AntiTriggerEvent</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>splice</span> <span class='hs-chr'>'t'</span>
<a name="line-956"></a><span class='hs-varop'>&gt;</span>                         <span class='hs-layout'>,</span><span class='hs-conid'>TInsert</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"insert"</span>
<a name="line-957"></a><span class='hs-varop'>&gt;</span>                         <span class='hs-layout'>,</span><span class='hs-conid'>TUpdate</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"update"</span>
<a name="line-958"></a><span class='hs-varop'>&gt;</span>                         <span class='hs-layout'>,</span><span class='hs-conid'>TDelete</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"delete"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"or"</span><span class='hs-layout'>)</span>
<a name="line-959"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>tfiring</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>option</span> <span class='hs-conid'>EachStatement</span>
<a name="line-960"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"for"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"each"</span><span class='hs-layout'>)</span> <span class='hs-varop'>*&gt;</span>
<a name="line-961"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-962"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-conid'>EachRow</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"row"</span>
<a name="line-963"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-layout'>,</span><span class='hs-conid'>EachStatement</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"statement"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-964"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createAlterLoginUser</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Annotation</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Statement</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-965"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createAlterLoginUser</span> <span class='hs-varid'>ctor</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ctor</span>
<a name="line-966"></a><span class='hs-varop'>&gt;</span>                             <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-varid'>k</span>
<a name="line-967"></a><span class='hs-varop'>&gt;</span>                             <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
<a name="line-968"></a><span class='hs-varop'>&gt;</span>                             <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"with"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"password"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>"="</span> <span class='hs-varop'>*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>extrStr</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>stringLit</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-969"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createLogin</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-970"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createLogin</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>createAlterLoginUser</span> <span class='hs-conid'>CreateLogin</span> <span class='hs-str'>"login"</span>
<a name="line-971"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createUser</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-972"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createUser</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>createAlterLoginUser</span> <span class='hs-conid'>CreateUser</span> <span class='hs-str'>"user"</span>
<a name="line-973"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>alterLogin</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-974"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>alterLogin</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>createAlterLoginUser</span> <span class='hs-conid'>AlterLogin</span> <span class='hs-str'>"login"</span>
<a name="line-975"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>alterUser</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-976"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>alterUser</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>createAlterLoginUser</span> <span class='hs-conid'>AlterUser</span> <span class='hs-str'>"user"</span>
</pre>

anti statement
--------------

<pre><a name="line-977"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>antiStatement</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-978"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>antiStatement</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AntiStatement</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>splice</span> <span class='hs-chr'>'s'</span>
</pre>
--------------------------------------------------------------------------------

component parsers for sql statements
====================================

<pre><a name="line-979"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>whereClause</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-980"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>whereClause</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"where"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>expr</span>
</pre>
selectlist and selectitem: the bit between select and from
check for into either before the whole list of select columns
or after the whole list

<pre><a name="line-981"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>selectList</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>SelectList</span>
<a name="line-982"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>selectList</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SelectList</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-983"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>itemList</span>
<a name="line-984"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-985"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>itemList</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>selectItem</span>
<a name="line-986"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>selectItem</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-987"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varid'>optionalSuffix</span>
<a name="line-988"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-layout'>(</span><span class='hs-conid'>SelExp</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>starExpr</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-989"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-layout'>(</span><span class='hs-conid'>SelectItem</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"as"</span><span class='hs-layout'>)</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>asAlias</span><span class='hs-layout'>)</span>
</pre>
should try to factor this into the standard expr parse (use a flag) so
that can left factor the 'name component . '  part and avoid the try

<pre><a name="line-990"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>starExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-991"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>starExpr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Star</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>"*"</span>
<a name="line-992"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-layout'>,</span><span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-993"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-994"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-varid'>nc</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nameComponent</span>
<a name="line-995"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-varid'>symbol</span> <span class='hs-str'>"."</span>
<a name="line-996"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-varid'>symbol</span> <span class='hs-str'>"*"</span>
<a name="line-997"></a><span class='hs-varop'>&gt;</span>                          <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>QStar</span> <span class='hs-varid'>p</span> <span class='hs-varid'>nc</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-998"></a><span class='hs-varop'>&gt;</span>
<a name="line-999"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>returning</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>SelectList</span>
<a name="line-1000"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>returning</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"returning"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>selectList</span>
<a name="line-1001"></a><span class='hs-varop'>&gt;</span>
<a name="line-1002"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>columnNameList</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>NameComponent</span><span class='hs-keyglyph'>]</span>
<a name="line-1003"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>columnNameList</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-varop'>$</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>nameComponent</span>
<a name="line-1004"></a><span class='hs-varop'>&gt;</span>
<a name="line-1005"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>typeName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>TypeName</span>
<a name="line-1006"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>typeName</span> <span class='hs-keyglyph'>=</span>
<a name="line-1007"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-1008"></a><span class='hs-varop'>&gt;</span>      <span class='hs-conid'>SetOfTypeName</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"setof"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>typeName</span><span class='hs-layout'>)</span>
<a name="line-1009"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>otherTypeName</span><span class='hs-keyglyph'>]</span>
<a name="line-1010"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-1011"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>otherTypeName</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1012"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-1013"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>s</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pTypeNameString</span>
<a name="line-1014"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-conid'>Prec2TypeName</span> <span class='hs-varid'>p</span> <span class='hs-varid'>s</span>
<a name="line-1015"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>"("</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>integer</span><span class='hs-layout'>)</span>
<a name="line-1016"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>","</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>integer</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>")"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1017"></a><span class='hs-varop'>&gt;</span>               <span class='hs-layout'>,</span><span class='hs-conid'>PrecTypeName</span> <span class='hs-varid'>p</span> <span class='hs-varid'>s</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-varid'>integer</span>
<a name="line-1018"></a><span class='hs-varop'>&gt;</span>               <span class='hs-layout'>,</span><span class='hs-varid'>arrayTypeName</span> <span class='hs-varid'>p</span> <span class='hs-varid'>s</span>
<a name="line-1019"></a><span class='hs-varop'>&gt;</span>               <span class='hs-layout'>,</span><span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>SimpleTypeName</span> <span class='hs-varid'>p</span> <span class='hs-varid'>s</span><span class='hs-keyglyph'>]</span>
<a name="line-1020"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>arrayTypeName</span> <span class='hs-varid'>p</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ArrayTypeName</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>SimpleTypeName</span> <span class='hs-varid'>p</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-1021"></a><span class='hs-varop'>&gt;</span>                         <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>"["</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>"]"</span>
<a name="line-1022"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>pTypeNameString</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Name</span>
<a name="line-1023"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>pTypeNameString</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-1024"></a><span class='hs-varop'>&gt;</span>                        <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>Nmc</span> <span class='hs-str'>"double precision"</span><span class='hs-keyglyph'>]</span>
<a name="line-1025"></a><span class='hs-varop'>&gt;</span>                                    <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"double"</span>
<a name="line-1026"></a><span class='hs-varop'>&gt;</span>                                            <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"precision"</span><span class='hs-layout'>)</span>
<a name="line-1027"></a><span class='hs-varop'>&gt;</span>                                   <span class='hs-layout'>,</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>Nmc</span> <span class='hs-str'>"character varying"</span><span class='hs-keyglyph'>]</span>
<a name="line-1028"></a><span class='hs-varop'>&gt;</span>                                    <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"character"</span>
<a name="line-1029"></a><span class='hs-varop'>&gt;</span>                                            <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"varying"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1030"></a><span class='hs-varop'>&gt;</span>                       <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>name</span>
<a name="line-1031"></a><span class='hs-varop'>&gt;</span>
<a name="line-1032"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>cascade</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Cascade</span>
<a name="line-1033"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>cascade</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>option</span> <span class='hs-conid'>Restrict</span> <span class='hs-layout'>(</span><span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-1034"></a><span class='hs-varop'>&gt;</span>                             <span class='hs-conid'>Restrict</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"restrict"</span>
<a name="line-1035"></a><span class='hs-varop'>&gt;</span>                            <span class='hs-layout'>,</span><span class='hs-conid'>Cascade</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"cascade"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-1036"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>stmtEnd</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>()</span>
<a name="line-1037"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>stmtEnd</span> <span class='hs-varid'>alwaysOptional</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1038"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>ss</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>isSqlServer</span>
<a name="line-1039"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>if</span> <span class='hs-varid'>alwaysOptional</span> <span class='hs-varop'>||</span> <span class='hs-varid'>ss</span>
<a name="line-1040"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>then</span> <span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>";"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-1041"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>else</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>";"</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
</pre>
--------------------------------------------------------------------------------

plpgsql statements
==================

<pre><a name="line-1042"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>plPgsqlStatement</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-1043"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>plPgsqlStatement</span> <span class='hs-keyglyph'>=</span>
<a name="line-1044"></a><span class='hs-varop'>&gt;</span>    <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-1045"></a><span class='hs-varop'>&gt;</span>      <span class='hs-comment'>-- modified sql statements</span>
<a name="line-1046"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-1047"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>try</span> <span class='hs-varid'>intoQueryStatement</span>
<a name="line-1048"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>insert</span>
<a name="line-1049"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>update</span>
<a name="line-1050"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>delete</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>intoSuffix</span>
<a name="line-1051"></a><span class='hs-varop'>&gt;</span>        <span class='hs-keyglyph'>]</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>stmtEnd</span> <span class='hs-conid'>False</span>
<a name="line-1052"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- regular sql statements</span>
<a name="line-1053"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>sqlStatement</span> <span class='hs-conid'>True</span>
<a name="line-1054"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- regular plpgsql statements</span>
<a name="line-1055"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-1056"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>declareStatement</span>
<a name="line-1057"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>setAssign</span>
<a name="line-1058"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>continue</span>
<a name="line-1059"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>execute</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>intoSuffix</span>
<a name="line-1060"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>caseStatement</span>
<a name="line-1061"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>assignment</span>
<a name="line-1062"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>ifStatement</span>
<a name="line-1063"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>returnSt</span>
<a name="line-1064"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>raise</span>
<a name="line-1065"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>perform</span>
<a name="line-1066"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>labelPrefixed</span>
<a name="line-1067"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>nullStatement</span>
<a name="line-1068"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>exitStatement</span><span class='hs-keyglyph'>]</span>
<a name="line-1069"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>stmtEnd</span> <span class='hs-conid'>False</span>
<a name="line-1070"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyglyph'>]</span>
<a name="line-1071"></a><span class='hs-varop'>&gt;</span>    <span class='hs-keyword'>where</span>
<a name="line-1072"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>intoSuffix</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span>
<a name="line-1073"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>option</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-1074"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varid'>i</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>into</span>
<a name="line-1075"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>i</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-1076"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>labelPrefixed</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1077"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-1078"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>l</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>label</span>
<a name="line-1079"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>block</span> <span class='hs-varid'>p</span> <span class='hs-varid'>l</span>
<a name="line-1080"></a><span class='hs-varop'>&gt;</span>               <span class='hs-layout'>,</span><span class='hs-varid'>forStatement</span> <span class='hs-varid'>p</span> <span class='hs-varid'>l</span>
<a name="line-1081"></a><span class='hs-varop'>&gt;</span>               <span class='hs-layout'>,</span><span class='hs-varid'>whileStatement</span> <span class='hs-varid'>p</span> <span class='hs-varid'>l</span>
<a name="line-1082"></a><span class='hs-varop'>&gt;</span>               <span class='hs-layout'>,</span><span class='hs-varid'>loopStatement</span> <span class='hs-varid'>p</span> <span class='hs-varid'>l</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-1083"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>label</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>String</span><span class='hs-layout'>)</span>
<a name="line-1084"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>label</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>optionMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>"&lt;&lt;"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>idString</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>"&gt;&gt;"</span><span class='hs-layout'>)</span>
<a name="line-1085"></a><span class='hs-varop'>&gt;</span>
<a name="line-1086"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>block</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Annotation</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-1087"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>block</span> <span class='hs-varid'>p</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Block</span> <span class='hs-varid'>p</span> <span class='hs-varid'>l</span>
<a name="line-1088"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>declarePart</span>
<a name="line-1089"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>statementPart</span>
<a name="line-1090"></a><span class='hs-varop'>&gt;</span>         <span class='hs-keyword'>where</span>
<a name="line-1091"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>statementPart</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"begin"</span>
<a name="line-1092"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>many</span> <span class='hs-varid'>plPgsqlStatement</span>
<a name="line-1093"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"end"</span>
<a name="line-1094"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>declarePart</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"declare"</span>
<a name="line-1095"></a><span class='hs-varop'>&gt;</span>                         <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>manyTill</span> <span class='hs-layout'>(</span><span class='hs-varid'>try</span> <span class='hs-varid'>varDef</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>lookAhead</span> <span class='hs-varop'>$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"begin"</span><span class='hs-layout'>)</span>
<a name="line-1096"></a><span class='hs-varop'>&gt;</span>
<a name="line-1097"></a><span class='hs-varop'>&gt;</span>
<a name="line-1098"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>nullStatement</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-1099"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>nullStatement</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NullStatement</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"null"</span><span class='hs-layout'>)</span>
<a name="line-1100"></a><span class='hs-varop'>&gt;</span>
<a name="line-1101"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>exitStatement</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-1102"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>exitStatement</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ExitStatement</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"exit"</span><span class='hs-layout'>)</span>
<a name="line-1103"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>optionMaybe</span> <span class='hs-varid'>idString</span>
<a name="line-1104"></a><span class='hs-varop'>&gt;</span>
<a name="line-1105"></a><span class='hs-varop'>&gt;</span>
<a name="line-1106"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>continue</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-1107"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>continue</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ContinueStatement</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"continue"</span><span class='hs-layout'>)</span>
<a name="line-1108"></a><span class='hs-varop'>&gt;</span>                              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>optionMaybe</span> <span class='hs-varid'>idString</span>
<a name="line-1109"></a><span class='hs-varop'>&gt;</span>
<a name="line-1110"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>perform</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-1111"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>perform</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Perform</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"perform"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>expr</span>
<a name="line-1112"></a><span class='hs-varop'>&gt;</span>
</pre>
<pre><a name="line-1113"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>execute</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-1114"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>execute</span> <span class='hs-keyglyph'>=</span>
<a name="line-1115"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>choice</span>
<a name="line-1116"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyglyph'>[</span><span class='hs-keyword'>do</span>
<a name="line-1117"></a><span class='hs-varop'>&gt;</span>    <span class='hs-varid'>isSqlServer</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>guard</span>
<a name="line-1118"></a><span class='hs-varop'>&gt;</span>    <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"exec"</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"execute"</span>
<a name="line-1119"></a><span class='hs-varop'>&gt;</span>    <span class='hs-conid'>ExecStatement</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-1120"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
<a name="line-1121"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>commaSep</span> <span class='hs-varid'>expr</span>
<a name="line-1122"></a><span class='hs-varop'>&gt;</span>   <span class='hs-layout'>,</span><span class='hs-conid'>Execute</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"execute"</span><span class='hs-layout'>)</span>
<a name="line-1123"></a><span class='hs-varop'>&gt;</span>            <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>expr</span><span class='hs-keyglyph'>]</span>
<a name="line-1124"></a><span class='hs-varop'>&gt;</span>
<a name="line-1125"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>assignment</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-1126"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>assignment</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Assignment</span>
<a name="line-1127"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-1128"></a><span class='hs-varop'>&gt;</span>              <span class='hs-comment'>-- put the := in the first try to attempt to get a</span>
<a name="line-1129"></a><span class='hs-varop'>&gt;</span>              <span class='hs-comment'>-- better error if the code looks like malformed</span>
<a name="line-1130"></a><span class='hs-varop'>&gt;</span>              <span class='hs-comment'>-- assignment statement</span>
<a name="line-1131"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>name</span> <span class='hs-varop'>&lt;*</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>":="</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>"="</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1132"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>expr</span>
</pre>
<pre><a name="line-1133"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>setAssign</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-1134"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>setAssign</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1135"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>isSqlServer</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>guard</span>
<a name="line-1136"></a><span class='hs-varop'>&gt;</span>   <span class='hs-conid'>Assignment</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"set"</span><span class='hs-layout'>)</span>
<a name="line-1137"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
<a name="line-1138"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>"="</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-1139"></a><span class='hs-varop'>&gt;</span>
<a name="line-1140"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>returnSt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-1141"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>returnSt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"return"</span> <span class='hs-varop'>&gt;&gt;</span>
<a name="line-1142"></a><span class='hs-varop'>&gt;</span>            <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-1143"></a><span class='hs-varop'>&gt;</span>             <span class='hs-conid'>ReturnNext</span> <span class='hs-varid'>p</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"next"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-1144"></a><span class='hs-varop'>&gt;</span>            <span class='hs-layout'>,</span><span class='hs-conid'>ReturnQuery</span> <span class='hs-varid'>p</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"query"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>pQueryExpr</span><span class='hs-layout'>)</span>
<a name="line-1145"></a><span class='hs-varop'>&gt;</span>            <span class='hs-layout'>,</span><span class='hs-conid'>Return</span> <span class='hs-varid'>p</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>tryOptionMaybe</span> <span class='hs-varid'>expr</span><span class='hs-keyglyph'>]</span>
<a name="line-1146"></a><span class='hs-varop'>&gt;</span>
<a name="line-1147"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>raise</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-1148"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>raise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"raise"</span> <span class='hs-varop'>&gt;&gt;</span>
<a name="line-1149"></a><span class='hs-varop'>&gt;</span>         <span class='hs-conid'>Raise</span> <span class='hs-varid'>p</span>
<a name="line-1150"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>raiseType</span>
<a name="line-1151"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>extrStr</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>stringLit</span><span class='hs-layout'>)</span>
<a name="line-1152"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>","</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-1153"></a><span class='hs-varop'>&gt;</span>         <span class='hs-keyword'>where</span>
<a name="line-1154"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>raiseType</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>matchAKeyword</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-str'>"notice"</span><span class='hs-layout'>,</span> <span class='hs-conid'>RNotice</span><span class='hs-layout'>)</span>
<a name="line-1155"></a><span class='hs-varop'>&gt;</span>                                      <span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-str'>"exception"</span><span class='hs-layout'>,</span> <span class='hs-conid'>RException</span><span class='hs-layout'>)</span>
<a name="line-1156"></a><span class='hs-varop'>&gt;</span>                                      <span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-str'>"error"</span><span class='hs-layout'>,</span> <span class='hs-conid'>RError</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-1157"></a><span class='hs-varop'>&gt;</span>
<a name="line-1158"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>forStatement</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Annotation</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-1159"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>forStatement</span> <span class='hs-varid'>p</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1160"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>keyword</span> <span class='hs-str'>"for"</span>
<a name="line-1161"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>start</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nameComponent</span>
<a name="line-1162"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>keyword</span> <span class='hs-str'>"in"</span>
<a name="line-1163"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ForQueryStatement</span> <span class='hs-varid'>p</span> <span class='hs-varid'>l</span> <span class='hs-varid'>start</span>
<a name="line-1164"></a><span class='hs-varop'>&gt;</span>                        <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>try</span> <span class='hs-varid'>pQueryExpr</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>theRest</span>
<a name="line-1165"></a><span class='hs-varop'>&gt;</span>                       <span class='hs-layout'>,</span><span class='hs-conid'>ForIntegerStatement</span> <span class='hs-varid'>p</span> <span class='hs-varid'>l</span> <span class='hs-varid'>start</span>
<a name="line-1166"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>expr</span>
<a name="line-1167"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>".."</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-1168"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>theRest</span><span class='hs-keyglyph'>]</span>
<a name="line-1169"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-1170"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>theRest</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"loop"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>many</span> <span class='hs-varid'>plPgsqlStatement</span>
<a name="line-1171"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"end"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"loop"</span>
<a name="line-1172"></a><span class='hs-varop'>&gt;</span>
<a name="line-1173"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>whileStatement</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Annotation</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-1174"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>whileStatement</span> <span class='hs-varid'>p</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>WhileStatement</span> <span class='hs-varid'>p</span> <span class='hs-varid'>l</span>
<a name="line-1175"></a><span class='hs-varop'>&gt;</span>                      <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"while"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>expr</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"loop"</span><span class='hs-layout'>)</span>
<a name="line-1176"></a><span class='hs-varop'>&gt;</span>                      <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>many</span> <span class='hs-varid'>plPgsqlStatement</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"end"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"loop"</span>
<a name="line-1177"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>loopStatement</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Annotation</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-1178"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>loopStatement</span> <span class='hs-varid'>p</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LoopStatement</span> <span class='hs-varid'>p</span> <span class='hs-varid'>l</span>
<a name="line-1179"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"loop"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>many</span> <span class='hs-varid'>plPgsqlStatement</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"end"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"loop"</span><span class='hs-layout'>)</span>
<a name="line-1180"></a><span class='hs-varop'>&gt;</span>
</pre>
<pre><a name="line-1181"></a><span class='hs-varop'>&gt;</span>
<a name="line-1182"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>ifStatement</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-1183"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>ifStatement</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1184"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>ss</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>isSqlServer</span>
<a name="line-1185"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>if</span> <span class='hs-varid'>ss</span>
<a name="line-1186"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- no else if in sql server</span>
<a name="line-1187"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- no end if in sql server</span>
<a name="line-1188"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>then</span> <span class='hs-conid'>If</span>
<a name="line-1189"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"if"</span><span class='hs-layout'>)</span>
<a name="line-1190"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>expr</span> <span class='hs-varop'>&lt;.&gt;</span> <span class='hs-varid'>someStatements</span> <span class='hs-varid'>ss</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1191"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>elsePart</span> <span class='hs-varid'>ss</span>
<a name="line-1192"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>else</span> <span class='hs-conid'>If</span>
<a name="line-1193"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"if"</span><span class='hs-layout'>)</span>
<a name="line-1194"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>ifPart</span> <span class='hs-varid'>ss</span> <span class='hs-varop'>&lt;:&gt;</span> <span class='hs-varid'>elseifParts</span> <span class='hs-varid'>ss</span><span class='hs-layout'>)</span>
<a name="line-1195"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>elsePart</span> <span class='hs-varid'>ss</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>endIf</span><span class='hs-layout'>)</span>
<a name="line-1196"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-1197"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>ifPart</span> <span class='hs-varid'>ss</span> <span class='hs-keyglyph'>=</span>
<a name="line-1198"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyword'>if</span> <span class='hs-varid'>ss</span>
<a name="line-1199"></a><span class='hs-varop'>&gt;</span>       <span class='hs-comment'>-- no then keyword in tsql</span>
<a name="line-1200"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyword'>then</span> <span class='hs-varid'>expr</span> <span class='hs-varop'>&lt;.&gt;</span> <span class='hs-varid'>someStatements</span> <span class='hs-varid'>ss</span>
<a name="line-1201"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyword'>else</span> <span class='hs-varid'>expr</span> <span class='hs-varop'>&lt;.&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>thn</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>someStatements</span> <span class='hs-varid'>ss</span><span class='hs-layout'>)</span>
<a name="line-1202"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>elseifParts</span> <span class='hs-varid'>ss</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>many</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>elseif</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;.&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>thn</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>someStatements</span> <span class='hs-varid'>ss</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1203"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>elsePart</span> <span class='hs-varid'>ss</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"else"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>someStatements</span> <span class='hs-varid'>ss</span><span class='hs-layout'>)</span>
<a name="line-1204"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>endIf</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"end"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"if"</span>
<a name="line-1205"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>thn</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"then"</span>
<a name="line-1206"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>elseif</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"elseif"</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"elsif"</span>
<a name="line-1207"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>(</span><span class='hs-varop'>&lt;.&gt;</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>(,)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>b</span>
<a name="line-1208"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>someStatements</span> <span class='hs-varid'>ss</span> <span class='hs-keyglyph'>=</span>
<a name="line-1209"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyword'>if</span> <span class='hs-varid'>ss</span>
<a name="line-1210"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyword'>then</span>
<a name="line-1211"></a><span class='hs-varop'>&gt;</span>           <span class='hs-comment'>-- sql server only allows multiple statements if wrapped</span>
<a name="line-1212"></a><span class='hs-varop'>&gt;</span>           <span class='hs-comment'>-- in a begin end block</span>
<a name="line-1213"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"begin"</span>
<a name="line-1214"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>many</span> <span class='hs-varid'>plPgsqlStatement</span>
<a name="line-1215"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"end"</span>
<a name="line-1216"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>plPgsqlStatement</span><span class='hs-keyglyph'>]</span>
<a name="line-1217"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyword'>else</span> <span class='hs-varid'>many</span> <span class='hs-varid'>plPgsqlStatement</span>
</pre>
<pre><a name="line-1218"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>caseStatement</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-1219"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>caseStatement</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1220"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-1221"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>keyword</span> <span class='hs-str'>"case"</span>
<a name="line-1222"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-conid'>CaseStatementSimple</span> <span class='hs-varid'>p</span>
<a name="line-1223"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>expr</span>
<a name="line-1224"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>many</span> <span class='hs-varid'>whenSt</span>
<a name="line-1225"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"else"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>many</span> <span class='hs-varid'>plPgsqlStatement</span><span class='hs-layout'>)</span>
<a name="line-1226"></a><span class='hs-varop'>&gt;</span>                         <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"end"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"case"</span><span class='hs-layout'>)</span>
<a name="line-1227"></a><span class='hs-varop'>&gt;</span>            <span class='hs-layout'>,</span><span class='hs-conid'>CaseStatement</span> <span class='hs-varid'>p</span>
<a name="line-1228"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>many</span> <span class='hs-varid'>whenSt</span>
<a name="line-1229"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"else"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>many</span> <span class='hs-varid'>plPgsqlStatement</span><span class='hs-layout'>)</span>
<a name="line-1230"></a><span class='hs-varop'>&gt;</span>                         <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"end"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"case"</span><span class='hs-keyglyph'>]</span>
<a name="line-1231"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>where</span>
<a name="line-1232"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>whenSt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"when"</span> <span class='hs-varop'>&gt;&gt;</span>
<a name="line-1233"></a><span class='hs-varop'>&gt;</span>                <span class='hs-conid'>(,)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>expr</span>
<a name="line-1234"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"then"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>many</span> <span class='hs-varid'>plPgsqlStatement</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-1235"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>declareStatement</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-1236"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>declareStatement</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1237"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>isSqlServer</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>guard</span>
<a name="line-1238"></a><span class='hs-varop'>&gt;</span>   <span class='hs-conid'>DeclareStatement</span>
<a name="line-1239"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-1240"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"declare"</span>
<a name="line-1241"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>de</span><span class='hs-layout'>)</span>
<a name="line-1242"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-1243"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>de</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>(,,)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>localVarName</span>
<a name="line-1244"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>typeName</span>
<a name="line-1245"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>optionMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>"="</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-1246"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>localVarName</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1247"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>i</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>idString</span>
<a name="line-1248"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>guard</span> <span class='hs-layout'>(</span><span class='hs-varid'>head</span> <span class='hs-varid'>i</span> <span class='hs-varop'>==</span> <span class='hs-chr'>'@'</span><span class='hs-layout'>)</span>
<a name="line-1249"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>return</span> <span class='hs-varid'>i</span>
</pre>

only limited support for tsql create index atm

<pre><a name="line-1250"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createIndex</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Statement</span>
<a name="line-1251"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>createIndex</span> <span class='hs-keyglyph'>=</span>
<a name="line-1252"></a><span class='hs-varop'>&gt;</span>   <span class='hs-conid'>CreateIndexTSQL</span>
<a name="line-1253"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>flavs</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"index"</span><span class='hs-layout'>)</span>
<a name="line-1254"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>nameComponent</span>
<a name="line-1255"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"on"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span>
<a name="line-1256"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>commaSep1</span> <span class='hs-varid'>nameComponent</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>opts</span>
<a name="line-1257"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-1258"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>flavs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1259"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>optional</span> <span class='hs-varop'>$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"unique"</span>
<a name="line-1260"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>optional</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"clustered"</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"nonclustered"</span><span class='hs-layout'>)</span>
<a name="line-1261"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-1262"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>opts</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1263"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>optional</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-1264"></a><span class='hs-varop'>&gt;</span>              <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"include"</span>
<a name="line-1265"></a><span class='hs-varop'>&gt;</span>              <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>commaSep1</span> <span class='hs-varid'>nameComponent</span><span class='hs-layout'>)</span>
<a name="line-1266"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-1267"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
</pre>
--------------------------------------------------------------------------------

expressions
===========

This is the bit that makes it the most obvious that I don't really
know haskell, parsing theory or parsec ... robbed a parsing example
from haskell-cafe and mainly just kept changing it until it seemed to
work

<pre><a name="line-1268"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>expr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1269"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>expr</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1270"></a><span class='hs-varop'>&gt;</span>   <span class='hs-conid'>ParseFlags</span> <span class='hs-layout'>{</span><span class='hs-varid'>pfDialect</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>d</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getState</span>
<a name="line-1271"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>buildExpressionParser</span> <span class='hs-layout'>(</span><span class='hs-varid'>table</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-varid'>factor</span>
<a name="line-1272"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varop'>&lt;?&gt;</span> <span class='hs-str'>"expression"</span>
</pre>
<pre><a name="line-1273"></a><span class='hs-varop'>&gt;</span>
<a name="line-1274"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>factor</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1275"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>factor</span> <span class='hs-keyglyph'>=</span>
</pre>
First job is to take care of forms which start like a vanilla
expression, and then add a suffix on

<pre><a name="line-1276"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>fct</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>tryExprSuffix</span>
<a name="line-1277"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-1278"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>tryExprSuffix</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span>
<a name="line-1279"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>option</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-varid'>choice</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>f</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-varid'>f</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- Try added because betweenSuffix may eat up "not" in betweenSuffix</span>
<a name="line-1280"></a><span class='hs-varop'>&gt;</span>                                  <span class='hs-keyglyph'>[</span><span class='hs-varid'>inPredicateSuffix</span>
<a name="line-1281"></a><span class='hs-varop'>&gt;</span>                                  <span class='hs-layout'>,</span><span class='hs-varid'>functionCallSuffix</span>
<a name="line-1282"></a><span class='hs-varop'>&gt;</span>                                  <span class='hs-layout'>,</span><span class='hs-varid'>windowFnSuffix</span>
<a name="line-1283"></a><span class='hs-varop'>&gt;</span>                                  <span class='hs-layout'>,</span><span class='hs-varid'>castSuffix</span>
<a name="line-1284"></a><span class='hs-varop'>&gt;</span>                                  <span class='hs-layout'>,</span><span class='hs-varid'>betweenSuffix</span>
<a name="line-1285"></a><span class='hs-varop'>&gt;</span>                                  <span class='hs-layout'>,</span><span class='hs-varid'>arraySubSuffix</span>
<a name="line-1286"></a><span class='hs-varop'>&gt;</span>                                  <span class='hs-layout'>,</span><span class='hs-varid'>qualIdSuffix</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1287"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>tryExprSuffix</span><span class='hs-layout'>)</span>
<a name="line-1288"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>fct</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
</pre>
order these so the ones which can be valid prefixes of others appear
further down the list (used to be a lot more important when there
wasn't a separate lexer), probably want to refactor this to use the
optionalsuffix parsers to improve speed.

start with the factors which start with parens - eliminate scalar
subqueries since they're efficient to distinguish from the others
using try, then parse an expression in parens which can either be the
start of a row constructor or just a parenthesized expression. This is
left factored because using try with the rowctor version first leads
to exponential backtracking for nested parenthesized expressions which
is very slow.

<pre><a name="line-1289"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>scalarSubQuery</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>exprInParens</span><span class='hs-layout'>)</span>
</pre>
try a few random things which can't start a different expression

<pre><a name="line-1290"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>positionalArg</span>
<a name="line-1291"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>placeholder</span>
<a name="line-1292"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>stringLit</span>
<a name="line-1293"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>numberLit</span>
</pre>
put the factors which start with keywords before the ones which start
with a function, so you don't try an parse a keyword as a function name

<pre><a name="line-1294"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>rowCtor</span>
<a name="line-1295"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>caseScalarExpr</span>
<a name="line-1296"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>exists</span>
<a name="line-1297"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>booleanLit</span>
<a name="line-1298"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>nullLit</span>
<a name="line-1299"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>arrayLit</span>
<a name="line-1300"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>castKeyword</span>
<a name="line-1301"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>try</span> <span class='hs-varid'>substring</span> <span class='hs-comment'>-- use try cos there is also a regular function called substring</span>
<a name="line-1302"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>extract</span>
<a name="line-1303"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>odbcExpr</span>
</pre>
<pre><a name="line-1304"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>try</span> <span class='hs-varid'>interval</span>
<a name="line-1305"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>try</span> <span class='hs-varid'>typedStringLit</span>
<a name="line-1306"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>antiScalarExpr</span>
<a name="line-1307"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>sqlServerConvert</span>
<a name="line-1308"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>keywordFunction</span>
<a name="line-1309"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-varid'>identifier</span>
<a name="line-1310"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>,</span><span class='hs-conid'>Identifier</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>AntiName</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>splice</span> <span class='hs-chr'>'n'</span><span class='hs-layout'>)</span>
<a name="line-1311"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyglyph'>]</span>
</pre>
operator table
--------------

proper hacky, but sort of does the job
the 'missing' notes refer to pg operators which aren't yet supported,
or supported in a different way (e.g. cast uses the type name parser
for one of it's argument, not the expression parser - I don't know if
there is a better way of doing this but there usually is in parsec)

pg's operator table is on this page:
http://www.postgresql.org/docs/8.4/interactive/sql-syntax-lexical.html#SQL-SYNTAX-OPERATORS

will probably need something more custom to handle full range of sql
syntactical novelty, in particular the precedence rules mix these
operators up with irregular syntax operators, you can create new
operators during parsing, and some operators are prefix/postfix or
binary depending on the types of their operands

The full list of operators from a standard template1 database should
be used here.

TODO: handle the completely different list of sql server operators a
bit better

TODO: this follows the old, incorrect postgresql precedence, update to
the 9.5 behaviour which is much more in line with ansi sql and other
sql dbmss.

<pre><a name="line-1312"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>tableAB</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span>
<a name="line-1313"></a><span class='hs-varop'>&gt;</span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-1314"></a><span class='hs-varop'>&gt;</span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>Operator</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Token</span><span class='hs-keyglyph'>]</span> <span class='hs-conid'>ParseState</span> <span class='hs-conid'>Identity</span> <span class='hs-conid'>ScalarExpr</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
<a name="line-1315"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>tableAB</span> <span class='hs-varid'>d</span> <span class='hs-varid'>isB</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>[</span><span class='hs-comment'>{-binary "." AssocLeft-}</span><span class='hs-keyglyph'>]</span>
<a name="line-1316"></a><span class='hs-varop'>&gt;</span>          <span class='hs-comment'>--[binary "::" (BinOpCall Cast) AssocLeft]</span>
<a name="line-1317"></a><span class='hs-varop'>&gt;</span>          <span class='hs-comment'>--missing [] for array element select</span>
<a name="line-1318"></a><span class='hs-varop'>&gt;</span>         <span class='hs-layout'>,</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>prefix</span> <span class='hs-str'>"+"</span> <span class='hs-str'>"+"</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- Unary plus - Exists in pgsql 9.4</span>
</pre>
<pre><a name="line-1319"></a><span class='hs-varop'>&gt;</span>         <span class='hs-layout'>,</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>prefix</span> <span class='hs-str'>"-"</span> <span class='hs-str'>"-"</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- Unary minus</span>
</pre>
<pre><a name="line-1320"></a><span class='hs-varop'>&gt;</span>         <span class='hs-layout'>,</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>binary</span> <span class='hs-str'>"^"</span> <span class='hs-conid'>AssocLeft</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- Exponent</span>
</pre>
<pre><a name="line-1321"></a><span class='hs-varop'>&gt;</span>         <span class='hs-layout'>,</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>binary</span> <span class='hs-str'>"*"</span> <span class='hs-conid'>AssocLeft</span>
<a name="line-1322"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>idHackBinary</span> <span class='hs-str'>"*"</span> <span class='hs-conid'>AssocLeft</span>
<a name="line-1323"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>binary</span> <span class='hs-str'>"/"</span> <span class='hs-conid'>AssocLeft</span>
<a name="line-1324"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>binary</span> <span class='hs-str'>"%"</span> <span class='hs-conid'>AssocLeft</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-1325"></a><span class='hs-varop'>&gt;</span>         <span class='hs-layout'>,</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>binary</span> <span class='hs-str'>"+"</span> <span class='hs-conid'>AssocLeft</span>
<a name="line-1326"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>binary</span> <span class='hs-str'>"-"</span> <span class='hs-conid'>AssocLeft</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-1327"></a><span class='hs-varop'>&gt;</span>          <span class='hs-comment'>------- All custom operators must go here:</span>
<a name="line-1328"></a><span class='hs-varop'>&gt;</span>          <span class='hs-comment'>--other operators all added in this list according to the pg docs:</span>
<a name="line-1329"></a><span class='hs-varop'>&gt;</span>         <span class='hs-layout'>,</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>prefix</span> <span class='hs-str'>"~"</span> <span class='hs-str'>"~"</span>
<a name="line-1330"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>binary</span> <span class='hs-str'>"|"</span> <span class='hs-conid'>AssocLeft</span>
<a name="line-1331"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>binary</span> <span class='hs-str'>"&amp;"</span> <span class='hs-conid'>AssocLeft</span>
<a name="line-1332"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>binary</span> <span class='hs-str'>"#"</span> <span class='hs-conid'>AssocLeft</span>
<a name="line-1333"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>binary</span> <span class='hs-str'>"&lt;&lt;"</span> <span class='hs-conid'>AssocLeft</span>
<a name="line-1334"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>binary</span> <span class='hs-str'>"&gt;&gt;"</span> <span class='hs-conid'>AssocLeft</span>
<a name="line-1335"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>binary</span> <span class='hs-str'>"&lt;-&gt;"</span> <span class='hs-conid'>AssocNone</span>
<a name="line-1336"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>binary</span> <span class='hs-str'>"||"</span> <span class='hs-conid'>AssocLeft</span><span class='hs-keyglyph'>]</span>
<a name="line-1337"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>prefix</span> <span class='hs-str'>"@"</span> <span class='hs-str'>"@"</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>diSyntaxFlavour</span> <span class='hs-varid'>d</span> <span class='hs-varop'>==</span> <span class='hs-conid'>Postgres</span><span class='hs-keyglyph'>]</span>
<a name="line-1338"></a><span class='hs-varop'>&gt;</span>          <span class='hs-comment'>-- Stop custom operators.</span>
<a name="line-1339"></a><span class='hs-varop'>&gt;</span>          <span class='hs-comment'>--in should be here, but is treated as a factor instead</span>
<a name="line-1340"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>--between</span>
<a name="line-1341"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>--overlaps</span>
</pre>
<pre><a name="line-1342"></a><span class='hs-varop'>&gt;</span>         <span class='hs-layout'>,</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>binaryk</span> <span class='hs-str'>"like"</span> <span class='hs-str'>"like"</span> <span class='hs-conid'>AssocNone</span>
<a name="line-1343"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>binaryk</span> <span class='hs-str'>"rlike"</span> <span class='hs-str'>"rlike"</span> <span class='hs-conid'>AssocNone</span>
<a name="line-1344"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>binaryks</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"not"</span><span class='hs-layout'>,</span><span class='hs-str'>"like"</span><span class='hs-keyglyph'>]</span> <span class='hs-str'>"notlike"</span> <span class='hs-conid'>AssocNone</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-1345"></a><span class='hs-varop'>&gt;</span>         <span class='hs-layout'>,</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>binary</span> <span class='hs-str'>"&lt;"</span> <span class='hs-conid'>AssocNone</span>
<a name="line-1346"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>binary</span> <span class='hs-str'>"&gt;"</span> <span class='hs-conid'>AssocNone</span>
<a name="line-1347"></a><span class='hs-varop'>&gt;</span>          <span class='hs-comment'>--(also ilike similar)</span>
<a name="line-1348"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>binary</span> <span class='hs-str'>"="</span> <span class='hs-conid'>AssocRight</span>
<a name="line-1349"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>binary</span> <span class='hs-str'>"&lt;="</span> <span class='hs-conid'>AssocRight</span>
<a name="line-1350"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>binary</span> <span class='hs-str'>"&gt;="</span> <span class='hs-conid'>AssocRight</span>
<a name="line-1351"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>binary</span> <span class='hs-str'>"&lt;&gt;"</span> <span class='hs-conid'>AssocRight</span>
<a name="line-1352"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>binarycust</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>"!="</span><span class='hs-layout'>)</span> <span class='hs-str'>"&lt;&gt;"</span> <span class='hs-conid'>AssocRight</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-1353"></a><span class='hs-varop'>&gt;</span>         <span class='hs-layout'>,</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>postfixks</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"is"</span><span class='hs-layout'>,</span> <span class='hs-str'>"not"</span><span class='hs-layout'>,</span> <span class='hs-str'>"null"</span><span class='hs-keyglyph'>]</span> <span class='hs-str'>"isnotnull"</span>
<a name="line-1354"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>postfixks</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"is"</span><span class='hs-layout'>,</span> <span class='hs-str'>"null"</span><span class='hs-keyglyph'>]</span> <span class='hs-str'>"isnull"</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-1355"></a><span class='hs-varop'>&gt;</span>         <span class='hs-layout'>,</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>notNot</span>
<a name="line-1356"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>prefixk</span> <span class='hs-str'>"not"</span> <span class='hs-str'>"not"</span>
<a name="line-1357"></a><span class='hs-varop'>&gt;</span>          <span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-1358"></a><span class='hs-varop'>&gt;</span>         <span class='hs-layout'>,</span><span class='hs-keyword'>if</span> <span class='hs-varid'>isB</span>
<a name="line-1359"></a><span class='hs-varop'>&gt;</span>          <span class='hs-keyword'>then</span> <span class='hs-conid'>[]</span>
<a name="line-1360"></a><span class='hs-varop'>&gt;</span>          <span class='hs-keyword'>else</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>binaryk</span> <span class='hs-str'>"and"</span> <span class='hs-str'>"and"</span> <span class='hs-conid'>AssocLeft</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-1361"></a><span class='hs-varop'>&gt;</span>         <span class='hs-layout'>,</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>binaryk</span> <span class='hs-str'>"or"</span> <span class='hs-str'>"or"</span> <span class='hs-conid'>AssocLeft</span><span class='hs-keyglyph'>]</span>
<a name="line-1362"></a><span class='hs-varop'>&gt;</span>         <span class='hs-keyglyph'>]</span>
<a name="line-1363"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>where</span>
<a name="line-1364"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>binary</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>binarycust</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1365"></a><span class='hs-varop'>&gt;</span>       <span class='hs-comment'>-- '*' is lexed as an id token rather than a symbol token, so</span>
<a name="line-1366"></a><span class='hs-varop'>&gt;</span>       <span class='hs-comment'>-- work around here</span>
<a name="line-1367"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>idHackBinary</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>binarycust</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span>
<a name="line-1368"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>binaryk</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>binarycust</span> <span class='hs-varop'>.</span> <span class='hs-varid'>keyword</span>
<a name="line-1369"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>binaryks</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>binarycust</span> <span class='hs-varop'>.</span> <span class='hs-varid'>mapM_</span> <span class='hs-varid'>keyword</span>
<a name="line-1370"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>prefix</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>prefCust</span> <span class='hs-conid'>Prefix</span> <span class='hs-varop'>.</span> <span class='hs-varid'>symbol</span>
<a name="line-1371"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>prefixk</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>prefCust</span> <span class='hs-conid'>Prefix</span> <span class='hs-varop'>.</span> <span class='hs-varid'>keyword</span>
<a name="line-1372"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>postfixks</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>postCust</span> <span class='hs-conid'>Postfix</span> <span class='hs-varop'>.</span> <span class='hs-varid'>mapM_</span> <span class='hs-varid'>keyword</span>
<a name="line-1373"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>binarycust</span> <span class='hs-varid'>opParse</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span>
<a name="line-1374"></a><span class='hs-varop'>&gt;</span>         <span class='hs-conid'>Infix</span> <span class='hs-varop'>$</span> <span class='hs-varid'>try</span> <span class='hs-varop'>$</span>
<a name="line-1375"></a><span class='hs-varop'>&gt;</span>           <span class='hs-conid'>BinaryOp</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>nm</span> <span class='hs-varid'>emptyAnnotation</span> <span class='hs-varid'>t</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>opParse</span><span class='hs-layout'>)</span>
<a name="line-1376"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>prefCust</span> <span class='hs-varid'>ctor</span> <span class='hs-varid'>opParse</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span>
<a name="line-1377"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>ctor</span> <span class='hs-varop'>$</span> <span class='hs-varid'>try</span> <span class='hs-varop'>$</span>
<a name="line-1378"></a><span class='hs-varop'>&gt;</span>           <span class='hs-conid'>PrefixOp</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>nm</span> <span class='hs-varid'>emptyAnnotation</span> <span class='hs-varid'>t</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>opParse</span><span class='hs-layout'>)</span>
<a name="line-1379"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>postCust</span> <span class='hs-varid'>ctor</span> <span class='hs-varid'>opParse</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span>
<a name="line-1380"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>ctor</span> <span class='hs-varop'>$</span> <span class='hs-varid'>try</span> <span class='hs-varop'>$</span>
<a name="line-1381"></a><span class='hs-varop'>&gt;</span>           <span class='hs-conid'>PostfixOp</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>nm</span> <span class='hs-varid'>emptyAnnotation</span> <span class='hs-varid'>t</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>opParse</span><span class='hs-layout'>)</span>
<a name="line-1382"></a><span class='hs-varop'>&gt;</span>       <span class='hs-comment'>-- hack - haven't worked out why parsec buildexpression parser won't</span>
<a name="line-1383"></a><span class='hs-varop'>&gt;</span>       <span class='hs-comment'>-- parse something like "not not EXPR" without parens so hack here</span>
<a name="line-1384"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>notNot</span> <span class='hs-keyglyph'>=</span>
<a name="line-1385"></a><span class='hs-varop'>&gt;</span>         <span class='hs-conid'>Prefix</span> <span class='hs-varop'>$</span> <span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-1386"></a><span class='hs-varop'>&gt;</span>                       <span class='hs-varid'>p1</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-1387"></a><span class='hs-varop'>&gt;</span>                       <span class='hs-varid'>keyword</span> <span class='hs-str'>"not"</span>
<a name="line-1388"></a><span class='hs-varop'>&gt;</span>                       <span class='hs-varid'>p2</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-1389"></a><span class='hs-varop'>&gt;</span>                       <span class='hs-varid'>keyword</span> <span class='hs-str'>"not"</span>
<a name="line-1390"></a><span class='hs-varop'>&gt;</span>                       <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>PrefixOp</span> <span class='hs-varid'>p1</span> <span class='hs-layout'>(</span><span class='hs-varid'>nm</span> <span class='hs-varid'>p1</span> <span class='hs-str'>"not"</span><span class='hs-layout'>)</span>
<a name="line-1391"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-varop'>.</span> <span class='hs-conid'>PrefixOp</span> <span class='hs-varid'>p2</span> <span class='hs-layout'>(</span><span class='hs-varid'>nm</span> <span class='hs-varid'>p2</span> <span class='hs-str'>"not"</span><span class='hs-layout'>)</span>
</pre>
From postgresql src/backend/parser/gram.y

~~~~~

 * We have two expression types: a_expr is the unrestricted kind, and
 * b_expr is a subset that must be used in some places to avoid shift/reduce
 * conflicts.  For example, we can't do BETWEEN as "BETWEEN a_expr AND a_expr"
 * because that use of AND conflicts with AND as a boolean operator.  So,
 * b_expr is used in BETWEEN and we remove boolean keywords from b_expr.
 *
 * Note that '(' a_expr ')' is a b_expr, so an unrestricted expression can
 * always be used by surrounding it with parens.

~~~~~

<pre><a name="line-1392"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>table</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>Operator</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Token</span><span class='hs-keyglyph'>]</span> <span class='hs-conid'>ParseState</span> <span class='hs-conid'>Identity</span> <span class='hs-conid'>ScalarExpr</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
<a name="line-1393"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>table</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tableAB</span> <span class='hs-varid'>d</span> <span class='hs-conid'>False</span>
</pre>
<pre><a name="line-1394"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>tableB</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>Operator</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Token</span><span class='hs-keyglyph'>]</span> <span class='hs-conid'>ParseState</span> <span class='hs-conid'>Identity</span> <span class='hs-conid'>ScalarExpr</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
<a name="line-1395"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>tableB</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tableAB</span> <span class='hs-varid'>d</span> <span class='hs-conid'>True</span>
</pre>
use the same factors

<pre><a name="line-1396"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>b_expr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1397"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>b_expr</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1398"></a><span class='hs-varop'>&gt;</span>          <span class='hs-conid'>ParseFlags</span> <span class='hs-layout'>{</span><span class='hs-varid'>pfDialect</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>d</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getState</span>
<a name="line-1399"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varid'>buildExpressionParser</span> <span class='hs-layout'>(</span><span class='hs-varid'>tableB</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-varid'>factor</span>
<a name="line-1400"></a><span class='hs-varop'>&gt;</span>          <span class='hs-varop'>&lt;?&gt;</span> <span class='hs-str'>"expression"</span>
<a name="line-1401"></a><span class='hs-varop'>&gt;</span>
</pre>
factor parsers
--------------

I think the lookahead is used in an attempt to help the error messages.

<pre><a name="line-1402"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>scalarSubQuery</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1403"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>scalarSubQuery</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ScalarSubQuery</span>
<a name="line-1404"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-1405"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>pQueryExpr</span>
</pre>
in predicate - an identifier or row constructor followed by 'in'
then a list of expressions or a subselect

<pre><a name="line-1406"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>inPredicateSuffix</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ScalarExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1407"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>inPredicateSuffix</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>try</span> <span class='hs-varop'>$</span>
<a name="line-1408"></a><span class='hs-varop'>&gt;</span>   <span class='hs-conid'>InPredicate</span>
<a name="line-1409"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-1410"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>return</span> <span class='hs-varid'>e</span>
<a name="line-1411"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-conid'>True</span> <span class='hs-layout'>(</span><span class='hs-conid'>False</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"not"</span><span class='hs-layout'>)</span>
<a name="line-1412"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"in"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>InQueryExpr</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>pQueryExpr</span><span class='hs-layout'>)</span>
<a name="line-1413"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-varop'>&lt;|&gt;</span>
<a name="line-1414"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-layout'>(</span><span class='hs-conid'>InList</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
</pre>
row ctor: one of

* row ()
* row (expr)
* row (expr, expr1, ...)
* (expr, expr2,...) [implicit (no row keyword) version, at least two elements
                   must be present]

(expr) parses to just expr rather than row(expr)
and () is a syntax error.

the rowCtor parses a ctor with the row keyword exprInParens parses
either a rowCtor without the row keyword (there must be more than one
comma separated expression, or it parses a parens expr).

<pre><a name="line-1415"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>rowCtor</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1416"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>rowCtor</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SpecialOp</span>
<a name="line-1417"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-1418"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>nm</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>return</span> <span class='hs-str'>"rowctor"</span><span class='hs-layout'>)</span>
<a name="line-1419"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"row"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>commaSep</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
</pre>
question: is a parenthesized expression different to a single element
row?

<pre><a name="line-1420"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>exprInParens</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1421"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>exprInParens</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1422"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-1423"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>e1</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>expr</span>
<a name="line-1424"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-keyword'>do</span>
<a name="line-1425"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>void</span> <span class='hs-varop'>$</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>","</span>
<a name="line-1426"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>es</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>expr</span>
<a name="line-1427"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>SpecialOp</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-varid'>nm</span> <span class='hs-varid'>p</span> <span class='hs-str'>"rowctor"</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>e1</span><span class='hs-conop'>:</span><span class='hs-varid'>es</span><span class='hs-layout'>)</span>
<a name="line-1428"></a><span class='hs-varop'>&gt;</span>            <span class='hs-layout'>,</span><span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Parens</span> <span class='hs-varid'>p</span> <span class='hs-varid'>e1</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-1429"></a><span class='hs-varop'>&gt;</span>
<a name="line-1430"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>numberLit</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1431"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>numberLit</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NumberLit</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>numString</span>
<a name="line-1432"></a><span class='hs-varop'>&gt;</span>
</pre>
<pre><a name="line-1433"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>integer</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Integer</span>
<a name="line-1434"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>integer</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1435"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>l</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>numString</span>
<a name="line-1436"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>guard</span> <span class='hs-layout'>(</span><span class='hs-varid'>all</span> <span class='hs-layout'>(</span><span class='hs-varop'>`elem`</span> <span class='hs-varid'>digChars</span><span class='hs-layout'>)</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>
<a name="line-1437"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>read</span> <span class='hs-varid'>l</span>
<a name="line-1438"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-1439"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>digChars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concatMap</span> <span class='hs-varid'>show</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-num'>0</span><span class='hs-keyglyph'>::</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>..</span><span class='hs-num'>9</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-1440"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>signedInteger</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Integer</span>
<a name="line-1441"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>signedInteger</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-varid'>negate</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>"-"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>integer</span><span class='hs-layout'>)</span>
<a name="line-1442"></a><span class='hs-varop'>&gt;</span>                        <span class='hs-layout'>,</span><span class='hs-varid'>integer</span><span class='hs-keyglyph'>]</span>
</pre>

<pre><a name="line-1443"></a><span class='hs-varop'>&gt;</span>
<a name="line-1444"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>caseScalarExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1445"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>caseScalarExpr</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1446"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-1447"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>keyword</span> <span class='hs-str'>"case"</span>
<a name="line-1448"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-1449"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-conid'>CaseSimple</span> <span class='hs-varid'>p</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>expr</span>
<a name="line-1450"></a><span class='hs-varop'>&gt;</span>                                 <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>many</span> <span class='hs-varid'>whenParse</span>
<a name="line-1451"></a><span class='hs-varop'>&gt;</span>                                 <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>tryOptionMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"else"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-1452"></a><span class='hs-varop'>&gt;</span>                                         <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"end"</span>
<a name="line-1453"></a><span class='hs-varop'>&gt;</span>             <span class='hs-layout'>,</span><span class='hs-conid'>Case</span> <span class='hs-varid'>p</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>many</span> <span class='hs-varid'>whenParse</span>
<a name="line-1454"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>tryOptionMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"else"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-1455"></a><span class='hs-varop'>&gt;</span>                             <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"end"</span><span class='hs-keyglyph'>]</span>
<a name="line-1456"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-1457"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>whenParse</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>(,)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"when"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-1458"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"then"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-1459"></a><span class='hs-varop'>&gt;</span>
<a name="line-1460"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>exists</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1461"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>exists</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Exists</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"exists"</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-varid'>pQueryExpr</span>
<a name="line-1462"></a><span class='hs-varop'>&gt;</span>
</pre>
<pre><a name="line-1463"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>booleanLit</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1464"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>booleanLit</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BooleanLit</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>True</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"true"</span>
<a name="line-1465"></a><span class='hs-varop'>&gt;</span>                                      <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-conid'>False</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"false"</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-1466"></a><span class='hs-varop'>&gt;</span>
<a name="line-1467"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>nullLit</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1468"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>nullLit</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>NullLit</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"null"</span>
<a name="line-1469"></a><span class='hs-varop'>&gt;</span>
<a name="line-1470"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>arrayLit</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1471"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>arrayLit</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SpecialOp</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"array"</span>
<a name="line-1472"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>nm</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>return</span> <span class='hs-str'>"arrayctor"</span><span class='hs-layout'>)</span>
<a name="line-1473"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>squares</span> <span class='hs-layout'>(</span><span class='hs-varid'>commaSep</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-1474"></a><span class='hs-varop'>&gt;</span>
<a name="line-1475"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>arraySubSuffix</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ScalarExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1476"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>arraySubSuffix</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SpecialOp</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-1477"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>nm</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>return</span> <span class='hs-str'>"arraysub"</span><span class='hs-layout'>)</span>
<a name="line-1478"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>squares</span> <span class='hs-layout'>(</span><span class='hs-varid'>commaSep1</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1479"></a><span class='hs-varop'>&gt;</span>
<a name="line-1480"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>windowFnSuffix</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ScalarExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1481"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>windowFnSuffix</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>WindowApp</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>return</span> <span class='hs-varid'>e</span>
<a name="line-1482"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"over"</span>
<a name="line-1483"></a><span class='hs-varop'>&gt;</span>                         <span class='hs-varop'>*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>"("</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>partitionBy</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1484"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>orderBy</span>
<a name="line-1485"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>frm</span>
<a name="line-1486"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>")"</span>
<a name="line-1487"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-1488"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>partitionBy</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"partition"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"by"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>commaSep1</span> <span class='hs-varid'>expr</span>
<a name="line-1489"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>frm</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>optionMaybe</span> <span class='hs-varop'>$</span> <span class='hs-varid'>choice</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>ks</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span>
<a name="line-1490"></a><span class='hs-varop'>&gt;</span>            <span class='hs-layout'>(</span><span class='hs-conid'>FrameUnboundedPreceding</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"range"</span><span class='hs-layout'>,</span><span class='hs-str'>"unbounded"</span><span class='hs-layout'>,</span><span class='hs-str'>"preceding"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1491"></a><span class='hs-varop'>&gt;</span>           <span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-conid'>FrameUnboundedPreceding</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"range"</span>
<a name="line-1492"></a><span class='hs-varop'>&gt;</span>                                      <span class='hs-layout'>,</span><span class='hs-str'>"between"</span>
<a name="line-1493"></a><span class='hs-varop'>&gt;</span>                                      <span class='hs-layout'>,</span><span class='hs-str'>"unbounded"</span>
<a name="line-1494"></a><span class='hs-varop'>&gt;</span>                                      <span class='hs-layout'>,</span><span class='hs-str'>"preceding"</span>
<a name="line-1495"></a><span class='hs-varop'>&gt;</span>                                      <span class='hs-layout'>,</span><span class='hs-str'>"and"</span>
<a name="line-1496"></a><span class='hs-varop'>&gt;</span>                                      <span class='hs-layout'>,</span><span class='hs-str'>"current"</span>
<a name="line-1497"></a><span class='hs-varop'>&gt;</span>                                      <span class='hs-layout'>,</span><span class='hs-str'>"row"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1498"></a><span class='hs-varop'>&gt;</span>           <span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-conid'>FrameUnboundedFull</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"range"</span>
<a name="line-1499"></a><span class='hs-varop'>&gt;</span>                                 <span class='hs-layout'>,</span><span class='hs-str'>"between"</span>
<a name="line-1500"></a><span class='hs-varop'>&gt;</span>                                 <span class='hs-layout'>,</span><span class='hs-str'>"unbounded"</span>
<a name="line-1501"></a><span class='hs-varop'>&gt;</span>                                 <span class='hs-layout'>,</span><span class='hs-str'>"preceding"</span>
<a name="line-1502"></a><span class='hs-varop'>&gt;</span>                                 <span class='hs-layout'>,</span><span class='hs-str'>"and"</span>
<a name="line-1503"></a><span class='hs-varop'>&gt;</span>                                 <span class='hs-layout'>,</span><span class='hs-str'>"unbounded"</span>
<a name="line-1504"></a><span class='hs-varop'>&gt;</span>                                 <span class='hs-layout'>,</span><span class='hs-str'>"following"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1505"></a><span class='hs-varop'>&gt;</span>           <span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-conid'>FrameUnboundedFull</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"rows"</span>
<a name="line-1506"></a><span class='hs-varop'>&gt;</span>                                 <span class='hs-layout'>,</span><span class='hs-str'>"between"</span>
<a name="line-1507"></a><span class='hs-varop'>&gt;</span>                                 <span class='hs-layout'>,</span><span class='hs-str'>"unbounded"</span>
<a name="line-1508"></a><span class='hs-varop'>&gt;</span>                                 <span class='hs-layout'>,</span><span class='hs-str'>"preceding"</span>
<a name="line-1509"></a><span class='hs-varop'>&gt;</span>                                 <span class='hs-layout'>,</span><span class='hs-str'>"and"</span>
<a name="line-1510"></a><span class='hs-varop'>&gt;</span>                                 <span class='hs-layout'>,</span><span class='hs-str'>"unbounded"</span>
<a name="line-1511"></a><span class='hs-varop'>&gt;</span>                                 <span class='hs-layout'>,</span><span class='hs-str'>"following"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1512"></a><span class='hs-varop'>&gt;</span>           <span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-conid'>FrameRowsUnboundedPreceding</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"rows"</span><span class='hs-layout'>,</span><span class='hs-str'>"unbounded"</span><span class='hs-layout'>,</span><span class='hs-str'>"preceding"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1513"></a><span class='hs-varop'>&gt;</span>           <span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-conid'>FrameRowsUnboundedPreceding</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"rows"</span>
<a name="line-1514"></a><span class='hs-varop'>&gt;</span>                                          <span class='hs-layout'>,</span><span class='hs-str'>"between"</span>
<a name="line-1515"></a><span class='hs-varop'>&gt;</span>                                          <span class='hs-layout'>,</span><span class='hs-str'>"unbounded"</span>
<a name="line-1516"></a><span class='hs-varop'>&gt;</span>                                          <span class='hs-layout'>,</span><span class='hs-str'>"preceding"</span>
<a name="line-1517"></a><span class='hs-varop'>&gt;</span>                                          <span class='hs-layout'>,</span><span class='hs-str'>"and"</span>
<a name="line-1518"></a><span class='hs-varop'>&gt;</span>                                          <span class='hs-layout'>,</span><span class='hs-str'>"current"</span>
<a name="line-1519"></a><span class='hs-varop'>&gt;</span>                                          <span class='hs-layout'>,</span><span class='hs-str'>"row"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-1520"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>ks</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapM</span> <span class='hs-varid'>keyword</span>
<a name="line-1521"></a><span class='hs-varop'>&gt;</span>
<a name="line-1522"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>betweenSuffix</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ScalarExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1523"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>betweenSuffix</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-1524"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-1525"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>opname</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>option</span> <span class='hs-str'>"between"</span> <span class='hs-layout'>(</span><span class='hs-str'>"notbetween"</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"not"</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- Discern between `between` and `not between`</span>
<a name="line-1526"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>keyword</span> <span class='hs-str'>"between"</span>
<a name="line-1527"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>b</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>b_expr</span>
<a name="line-1528"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>keyword</span> <span class='hs-str'>"and"</span>
<a name="line-1529"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>c</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>b_expr</span>
<a name="line-1530"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>SpecialOp</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-varid'>nm</span> <span class='hs-varid'>p</span> <span class='hs-varid'>opname</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-keyglyph'>]</span>
</pre>
handles aggregate business as well

can use a * in aggregate calls and in window functions.  This
represents a call to an aggregate which has no parameters, so count(*)
actually means count():

select count() from pg_attrdef;
ERROR:  count(*) must be used to call a parameterless aggregate function
LINE 1: select count() from pg_attrdef;

But you can't write it as count() ... ?

You cannot use * together with either distinct or order by, and it
cannot be qualified.

This parser is used as the prefix of the window function parser so
both are handled here. This will parse non aggregate calls containing
a single * argument without error - this will have to be caught during
typechecking. It also parses the aggregate extras (distinct and order
by) for non aggregate calls without error, so this also will need to
be caught during typechecking. The typechecker doesn't really do much
checking with aggregates at the moment so should fix it all together.

<pre><a name="line-1531"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>functionCallSuffix</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ScalarExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1532"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>functionCallSuffix</span> <span class='hs-varid'>ex</span> <span class='hs-keyglyph'>=</span>
<a name="line-1533"></a><span class='hs-varop'>&gt;</span>  <span class='hs-comment'>-- bit hacky, if exp is a identifier or qualified, then</span>
<a name="line-1534"></a><span class='hs-varop'>&gt;</span>  <span class='hs-comment'>-- convert to function, also support antiquote for function name</span>
<a name="line-1535"></a><span class='hs-varop'>&gt;</span>    <span class='hs-keyword'>case</span> <span class='hs-varid'>ex</span> <span class='hs-keyword'>of</span>
<a name="line-1536"></a><span class='hs-varop'>&gt;</span>      <span class='hs-conid'>Identifier</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>nm'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fn</span> <span class='hs-varid'>nm'</span>
<a name="line-1537"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fail</span> <span class='hs-varop'>$</span> <span class='hs-str'>"cannot make functioncall from "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>s</span>
<a name="line-1538"></a><span class='hs-varop'>&gt;</span>    <span class='hs-keyword'>where</span>
<a name="line-1539"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>fn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1540"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>fn</span> <span class='hs-varid'>fnName</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1541"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-1542"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>(</span><span class='hs-varid'>di</span><span class='hs-layout'>,</span><span class='hs-keyword'>as</span><span class='hs-layout'>,</span><span class='hs-varid'>ob</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>parens</span>
<a name="line-1543"></a><span class='hs-varop'>&gt;</span>                      <span class='hs-varop'>$</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span> <span class='hs-comment'>-- handle a single *</span>
<a name="line-1544"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-layout'>,</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Star</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>"*"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1545"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-layout'>,</span><span class='hs-conid'>(,,)</span>
<a name="line-1546"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>optionMaybe</span>
<a name="line-1547"></a><span class='hs-varop'>&gt;</span>                                     <span class='hs-layout'>(</span><span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Distinct</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>distinctKeyword</span>
<a name="line-1548"></a><span class='hs-varop'>&gt;</span>                                             <span class='hs-layout'>,</span><span class='hs-conid'>All</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"all"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1549"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>commaSep</span> <span class='hs-varid'>expr</span>
<a name="line-1550"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>orderBy</span><span class='hs-keyglyph'>]</span>
<a name="line-1551"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>di</span><span class='hs-layout'>,</span><span class='hs-varid'>ob</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-1552"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>App</span> <span class='hs-varid'>p</span> <span class='hs-varid'>fnName</span> <span class='hs-keyword'>as</span>
<a name="line-1553"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>(</span><span class='hs-varid'>d</span><span class='hs-layout'>,</span><span class='hs-varid'>o</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>AggregateApp</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromMaybe</span> <span class='hs-conid'>All</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>App</span> <span class='hs-varid'>p</span> <span class='hs-varid'>fnName</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span> <span class='hs-varid'>o</span>
</pre>
these won't parse as normal functions because they use keywords so do
a special case for them

<pre><a name="line-1554"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>keywordFunction</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1555"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>keywordFunction</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-1556"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-1557"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>i</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nameComponentAllows</span> <span class='hs-varid'>kfs</span>
<a name="line-1558"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>guard</span> <span class='hs-layout'>(</span><span class='hs-varid'>iskfs</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-1559"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>functionCallSuffix</span> <span class='hs-layout'>(</span><span class='hs-conid'>Identifier</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>i</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1560"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-1561"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>kfs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"any"</span><span class='hs-layout'>,</span><span class='hs-str'>"all"</span><span class='hs-layout'>,</span><span class='hs-str'>"isnull"</span><span class='hs-layout'>,</span><span class='hs-str'>"left"</span><span class='hs-layout'>,</span><span class='hs-str'>"right"</span><span class='hs-layout'>,</span><span class='hs-str'>"convert"</span><span class='hs-keyglyph'>]</span>
<a name="line-1562"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>iskfs</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nmc</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>map</span> <span class='hs-varid'>toLower</span> <span class='hs-varid'>n</span> <span class='hs-varop'>`elem`</span> <span class='hs-varid'>kfs</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-1563"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>iskfs</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
</pre>
<pre><a name="line-1564"></a><span class='hs-varop'>&gt;</span>
<a name="line-1565"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>castKeyword</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1566"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>castKeyword</span> <span class='hs-keyglyph'>=</span>
<a name="line-1567"></a><span class='hs-varop'>&gt;</span>     <span class='hs-conid'>Cast</span>
<a name="line-1568"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"cast"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>"("</span>
<a name="line-1569"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>expr</span>
<a name="line-1570"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"as"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>typeName</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>")"</span><span class='hs-layout'>)</span>
</pre>
parse both odbc style convert:
      convert(expr, type name) -- type name is an identifier
      and sql server
      convert(type name, expr [,style]) -- the type name is a normal sql type name

the style is ignored
the first form is represented as a function called convert (App ctor)
the second form is represented as Cast ctor for now

it needs fixing: at least add a specific ctor for the second form
plus review use of try

<pre><a name="line-1571"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>sqlServerConvert</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1572"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>sqlServerConvert</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-1573"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>isSqlServer</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>guard</span>
<a name="line-1574"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-1575"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"convert"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>"("</span>
<a name="line-1576"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-1577"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>ex</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>expr</span>
<a name="line-1578"></a><span class='hs-varop'>&gt;</span>             <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>","</span>
<a name="line-1579"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>ex1</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>expr</span>
<a name="line-1580"></a><span class='hs-varop'>&gt;</span>             <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>")"</span>
<a name="line-1581"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>App</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Nmc</span> <span class='hs-str'>"convert"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ex</span><span class='hs-layout'>,</span> <span class='hs-varid'>ex1</span><span class='hs-keyglyph'>]</span>
<a name="line-1582"></a><span class='hs-varop'>&gt;</span>            <span class='hs-layout'>,</span><span class='hs-keyword'>do</span>
<a name="line-1583"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>tn</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>typeName</span>
<a name="line-1584"></a><span class='hs-varop'>&gt;</span>             <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>","</span>
<a name="line-1585"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>e</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>expr</span>
<a name="line-1586"></a><span class='hs-varop'>&gt;</span>             <span class='hs-comment'>-- ignores the style</span>
<a name="line-1587"></a><span class='hs-varop'>&gt;</span>             <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>optional</span> <span class='hs-varop'>$</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>","</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>integer</span>
<a name="line-1588"></a><span class='hs-varop'>&gt;</span>             <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>")"</span>
<a name="line-1589"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Cast</span> <span class='hs-varid'>p</span> <span class='hs-varid'>e</span> <span class='hs-varid'>tn</span>
<a name="line-1590"></a><span class='hs-varop'>&gt;</span>            <span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-1591"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>castSuffix</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ScalarExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1592"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>castSuffix</span> <span class='hs-varid'>ex</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Cast</span> <span class='hs-varid'>p</span> <span class='hs-varid'>ex</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>"::"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>typeName</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-1593"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>typedStringLit</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1594"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>typedStringLit</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TypedStringLit</span>
<a name="line-1595"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-1596"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>typeName</span>
<a name="line-1597"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>extrStr</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>stringLit</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-1598"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>extract</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1599"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>extract</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-1600"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-1601"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"extract"</span>
<a name="line-1602"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>"("</span>
<a name="line-1603"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>f</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>extractField</span>
<a name="line-1604"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"from"</span>
<a name="line-1605"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>e</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>expr</span>
<a name="line-1606"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>")"</span>
<a name="line-1607"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Extract</span> <span class='hs-varid'>p</span> <span class='hs-varid'>f</span> <span class='hs-varid'>e</span>
<a name="line-1608"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-1609"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>extractField</span> <span class='hs-keyglyph'>=</span>
<a name="line-1610"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ExtractCentury</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"century"</span>
<a name="line-1611"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractDay</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"day"</span>
<a name="line-1612"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractDecade</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"decade"</span>
<a name="line-1613"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractDow</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"dow"</span>
<a name="line-1614"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractDoy</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"doy"</span>
<a name="line-1615"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractEpoch</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"epoch"</span>
<a name="line-1616"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractHour</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"hour"</span>
<a name="line-1617"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractIsodow</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"isodow"</span>
<a name="line-1618"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractIsoyear</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"isoyear"</span>
<a name="line-1619"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractMicroseconds</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"microseconds"</span>
<a name="line-1620"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractMillennium</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"millennium"</span>
<a name="line-1621"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractMilliseconds</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"milliseconds"</span>
<a name="line-1622"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractMinute</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"minute"</span>
<a name="line-1623"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractMonth</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"month"</span>
<a name="line-1624"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractQuarter</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"quarter"</span>
<a name="line-1625"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractSecond</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"second"</span>
<a name="line-1626"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractTimezone</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"timezone"</span>
<a name="line-1627"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractTimezoneHour</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"timezone_hour"</span>
<a name="line-1628"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractTimezoneMinute</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"timezone_minute"</span>
<a name="line-1629"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractWeek</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"week"</span>
<a name="line-1630"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-conid'>ExtractYear</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"year"</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-1631"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>interval</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1632"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>interval</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Interval</span>
<a name="line-1633"></a><span class='hs-varop'>&gt;</span>            <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-1634"></a><span class='hs-varop'>&gt;</span>            <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"interval"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>extrStr</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>stringLit</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1635"></a><span class='hs-varop'>&gt;</span>            <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>intervalField</span>
<a name="line-1636"></a><span class='hs-varop'>&gt;</span>            <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>tryOptionMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromInteger</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>integer</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1637"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-1638"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>intervalField</span> <span class='hs-keyglyph'>=</span>
<a name="line-1639"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>IntervalYear</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"year"</span>
<a name="line-1640"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-conid'>IntervalMonth</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"month"</span>
<a name="line-1641"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-conid'>IntervalDay</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"day"</span>
<a name="line-1642"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-conid'>IntervalHour</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"hour"</span>
<a name="line-1643"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-conid'>IntervalMinute</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"minute"</span>
<a name="line-1644"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-conid'>IntervalSecond</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"second"</span>
<a name="line-1645"></a><span class='hs-varop'>&gt;</span>                <span class='hs-comment'>{-,IntervalYearToMonth &lt;$ keyword "day"
<a name="line-1646"></a>&gt;                ,IntervalDayToHour &lt;$ keyword "day"
<a name="line-1647"></a>&gt;                ,IntervalDayToMinute &lt;$ keyword "day"
<a name="line-1648"></a>&gt;                ,IntervalDayToSecond &lt;$ keyword "day"
<a name="line-1649"></a>&gt;                ,IntervalHourToMinute &lt;$ keyword "day"
<a name="line-1650"></a>&gt;                ,IntervalHourToSecond &lt;$ keyword "day"
<a name="line-1651"></a>&gt;                ,IntervalMinuteToSecond &lt;$ keyword "day"-}</span><span class='hs-keyglyph'>]</span>
<a name="line-1652"></a><span class='hs-varop'>&gt;</span>
<a name="line-1653"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>substring</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1654"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>substring</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1655"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-1656"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>keyword</span> <span class='hs-str'>"substring"</span>
<a name="line-1657"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>symbol</span> <span class='hs-str'>"("</span>
<a name="line-1658"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>a</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>expr</span>
<a name="line-1659"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>keyword</span> <span class='hs-str'>"from"</span>
<a name="line-1660"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>b</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>expr</span>
<a name="line-1661"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>keyword</span> <span class='hs-str'>"for"</span>
<a name="line-1662"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>c</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>expr</span>
<a name="line-1663"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>symbol</span> <span class='hs-str'>")"</span>
<a name="line-1664"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>SpecialOp</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-varid'>nm</span> <span class='hs-varid'>p</span> <span class='hs-str'>"substring"</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-keyglyph'>]</span>
<a name="line-1665"></a><span class='hs-varop'>&gt;</span>
</pre>
odbc

date, time, and timestamp literals, and scalar function calls

<pre><a name="line-1666"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>odbcExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1667"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>odbcExpr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>between</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>"{"</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>"}"</span><span class='hs-layout'>)</span>
<a name="line-1668"></a><span class='hs-varop'>&gt;</span>            <span class='hs-layout'>(</span><span class='hs-varid'>odbcTimeLit</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>odbcFunc</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>odbcInterval</span><span class='hs-layout'>)</span>
<a name="line-1669"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-1670"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>odbcTimeLit</span> <span class='hs-keyglyph'>=</span>
<a name="line-1671"></a><span class='hs-varop'>&gt;</span>         <span class='hs-conid'>OdbcLiteral</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-1672"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>OLDate</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"d"</span>
<a name="line-1673"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-layout'>,</span><span class='hs-conid'>OLTime</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"t"</span>
<a name="line-1674"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-layout'>,</span><span class='hs-conid'>OLTimestamp</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-str'>"ts"</span><span class='hs-keyglyph'>]</span>
<a name="line-1675"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>stringN</span>
<a name="line-1676"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>odbcFunc</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>OdbcFunc</span>
<a name="line-1677"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span>
<a name="line-1678"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>keyword</span> <span class='hs-str'>"fn"</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- TODO: should limit this to function call or extract</span>
<a name="line-1679"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>odbcInterval</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>interval</span>
</pre>


------------------------------------------------------------

identifier parsing, quite a few variations ...

parse x.y, x.y.z, etc.

<pre><a name="line-1680"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>qualIdSuffix</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ScalarExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1681"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>qualIdSuffix</span> <span class='hs-layout'>(</span><span class='hs-conid'>Identifier</span> <span class='hs-sel'>_p</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>is</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-1682"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>qualIdX</span> <span class='hs-varid'>is</span>
</pre>
<pre><a name="line-1683"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>qualIdSuffix</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1684"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-1685"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>i1</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>"."</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>nameComponent</span>
<a name="line-1686"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>BinaryOp</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-varid'>nm</span> <span class='hs-varid'>p</span> <span class='hs-str'>"."</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-conid'>Identifier</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>i1</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-1687"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>qualIdX</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>NameComponent</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1688"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>qualIdX</span> <span class='hs-varid'>is</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1689"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>ss</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>isSqlServer</span>
<a name="line-1690"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>if</span> <span class='hs-varid'>ss</span>
<a name="line-1691"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>then</span> <span class='hs-varid'>sqls</span>
<a name="line-1692"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>else</span> <span class='hs-varid'>regular</span>
<a name="line-1693"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-1694"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>regular</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1695"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-1696"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varid'>i1</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>"."</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>nameComponent</span>
<a name="line-1697"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Identifier</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-varid'>is</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>i1</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1698"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>sqls</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1699"></a><span class='hs-varop'>&gt;</span>            <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-1700"></a><span class='hs-varop'>&gt;</span>            <span class='hs-varid'>numDots</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>readNDots</span>
<a name="line-1701"></a><span class='hs-varop'>&gt;</span>            <span class='hs-keyword'>let</span> <span class='hs-varid'>eis</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>replicate</span> <span class='hs-layout'>(</span><span class='hs-varid'>numDots</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nmc</span> <span class='hs-str'>""</span><span class='hs-layout'>)</span>
<a name="line-1702"></a><span class='hs-varop'>&gt;</span>            <span class='hs-varid'>i1</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nameComponent</span>
<a name="line-1703"></a><span class='hs-varop'>&gt;</span>            <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Identifier</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>Name</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-varid'>is</span> <span class='hs-varop'>++</span> <span class='hs-varid'>eis</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>i1</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
</pre>
the cranky lexer lexes lots of dots ......
as mixtures of symbol "." and symbol ".."
we just want to know how many dots in a row there are

<pre><a name="line-1704"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>readNDots</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Int</span>
<a name="line-1705"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>readNDots</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sum</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>many1</span> <span class='hs-layout'>(</span><span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-num'>1</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>"."</span>
<a name="line-1706"></a><span class='hs-varop'>&gt;</span>                                   <span class='hs-layout'>,</span><span class='hs-num'>2</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>".."</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
</pre>


<pre><a name="line-1707"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>identifier</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-1708"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>identifier</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Identifier</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>name</span>
</pre>
see sql-keywords appendix in pg manual

doesn't deal with non-reserved, and reserved with qualifications yet
(e.g. the may be function or type catagory), and other categories

I think the categories should be:
reserved
reserved but can be function or type
not reserved but cannot be function or type

these categories affect the parser and typechecker differently

(the parser has to parse some reserved and 'not reserved but cannot be
function or type' keywords as function names, maybe there are others)

<pre><a name="line-1709"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>reservedWords</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>String</span><span class='hs-keyglyph'>]</span>
<a name="line-1710"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>reservedWords</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1711"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>ss</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>isSqlServer</span>
<a name="line-1712"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>if</span> <span class='hs-varid'>not</span> <span class='hs-varid'>ss</span>
<a name="line-1713"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>then</span> <span class='hs-varid'>return</span>
<a name="line-1714"></a><span class='hs-varop'>&gt;</span>        <span class='hs-keyglyph'>[</span><span class='hs-str'>"all"</span>
<a name="line-1715"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"analyse"</span>
<a name="line-1716"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"analyze"</span>
<a name="line-1717"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"and"</span>
<a name="line-1718"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"any"</span>
<a name="line-1719"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"array"</span>
<a name="line-1720"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"as"</span>
<a name="line-1721"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"asc"</span>
<a name="line-1722"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"symmetric"</span>
<a name="line-1723"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"authorization"</span>
<a name="line-1724"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"binary"</span>
<a name="line-1725"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"both"</span>
<a name="line-1726"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"case"</span>
<a name="line-1727"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"cast"</span>
<a name="line-1728"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"check"</span>
<a name="line-1729"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"collate"</span>
<a name="line-1730"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"column"</span>
<a name="line-1731"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"concurrently"</span>
<a name="line-1732"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"constraint"</span>
<a name="line-1733"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"create"</span>
<a name="line-1734"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"cross"</span>
<a name="line-1735"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"current_catalog"</span>
<a name="line-1736"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"current_role"</span>
<a name="line-1737"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"current_time"</span>
<a name="line-1738"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"current_user"</span>
<a name="line-1739"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"default"</span>
<a name="line-1740"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"deferrable"</span>
<a name="line-1741"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"desc"</span>
<a name="line-1742"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"distinct"</span>
<a name="line-1743"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"do"</span>
<a name="line-1744"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"else"</span>
<a name="line-1745"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"end"</span>
<a name="line-1746"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"except"</span>
<a name="line-1747"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"false"</span>
<a name="line-1748"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"fetch"</span>
<a name="line-1749"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"for"</span>
<a name="line-1750"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"freeze"</span>
<a name="line-1751"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"from"</span>
<a name="line-1752"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"full"</span>
<a name="line-1753"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"grant"</span>
<a name="line-1754"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"group"</span>
<a name="line-1755"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"having"</span>
<a name="line-1756"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"ilike"</span>
<a name="line-1757"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"in"</span>
<a name="line-1758"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"initially"</span>
<a name="line-1759"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"inner"</span>
<a name="line-1760"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"intersect"</span>
<a name="line-1761"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"into"</span>
<a name="line-1762"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"is"</span>
<a name="line-1763"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"isnull"</span>
<a name="line-1764"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"join"</span>
<a name="line-1765"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"leading"</span>
<a name="line-1766"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"left"</span>
<a name="line-1767"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"like"</span>
<a name="line-1768"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"limit"</span>
<a name="line-1769"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"localtime"</span>
<a name="line-1770"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"localtimestamp"</span>
<a name="line-1771"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"natural"</span>
<a name="line-1772"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"not"</span>
<a name="line-1773"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"notnull"</span>
<a name="line-1774"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"null"</span>
<a name="line-1775"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"offset"</span>
<a name="line-1776"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"on"</span>
<a name="line-1777"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"only"</span>
<a name="line-1778"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"option"</span>
<a name="line-1779"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"or"</span>
<a name="line-1780"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"order"</span>
<a name="line-1781"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"outer"</span>
<a name="line-1782"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"over"</span>
<a name="line-1783"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"overlaps"</span>
<a name="line-1784"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"placing"</span>
<a name="line-1785"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"primary"</span>
<a name="line-1786"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"references"</span>
<a name="line-1787"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"returning"</span>
<a name="line-1788"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"right"</span>
<a name="line-1789"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"rlike"</span>
<a name="line-1790"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"select"</span>
<a name="line-1791"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"session_user"</span>
<a name="line-1792"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"similar"</span>
<a name="line-1793"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"some"</span>
<a name="line-1794"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"symmetric"</span>
<a name="line-1795"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"table"</span>
<a name="line-1796"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"then"</span>
<a name="line-1797"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"to"</span>
<a name="line-1798"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"trailing"</span>
<a name="line-1799"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"true"</span>
<a name="line-1800"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"union"</span>
<a name="line-1801"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"unique"</span>
<a name="line-1802"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"user"</span>
<a name="line-1803"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"using"</span>
<a name="line-1804"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"variadic"</span>
<a name="line-1805"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"verbose"</span>
<a name="line-1806"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"when"</span>
<a name="line-1807"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"where"</span>
<a name="line-1808"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"window"</span>
<a name="line-1809"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"with"</span>
<a name="line-1810"></a><span class='hs-varop'>&gt;</span>        <span class='hs-comment'>--extras for hssqlppp: Todo: fix this</span>
<a name="line-1811"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"loop"</span><span class='hs-layout'>,</span><span class='hs-str'>"merge"</span><span class='hs-layout'>,</span><span class='hs-str'>"hash"</span><span class='hs-keyglyph'>]</span>
</pre>
sql server keywords from this page:
http://msdn.microsoft.com/en-us/library/ms189822.aspx
(this is the list for 2008 R2)

<pre><a name="line-1812"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>else</span> <span class='hs-varid'>return</span>
<a name="line-1813"></a><span class='hs-varop'>&gt;</span>        <span class='hs-keyglyph'>[</span><span class='hs-str'>"add"</span>
<a name="line-1814"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"all"</span>
<a name="line-1815"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"alter"</span>
<a name="line-1816"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"and"</span>
<a name="line-1817"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"any"</span>
<a name="line-1818"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"as"</span>
<a name="line-1819"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"asc"</span>
<a name="line-1820"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"authorization"</span>
<a name="line-1821"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"backup"</span>
<a name="line-1822"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"begin"</span>
<a name="line-1823"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"between"</span>
<a name="line-1824"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"break"</span>
<a name="line-1825"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"browse"</span>
<a name="line-1826"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"bulk"</span>
<a name="line-1827"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"by"</span>
<a name="line-1828"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"cascade"</span>
<a name="line-1829"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"case"</span>
<a name="line-1830"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"check"</span>
<a name="line-1831"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"checkpoint"</span>
<a name="line-1832"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"close"</span>
<a name="line-1833"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"clustered"</span>
<a name="line-1834"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varop'>--,"coalesce"</span>
<a name="line-1835"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"collate"</span>
<a name="line-1836"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"column"</span>
<a name="line-1837"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"commit"</span>
<a name="line-1838"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"compute"</span>
<a name="line-1839"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"constraint"</span>
<a name="line-1840"></a><span class='hs-varop'>&gt;</span>        <span class='hs-comment'>-- ,"contains" todo: fix properly, oracle has function called contains</span>
<a name="line-1841"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"containstable"</span>
<a name="line-1842"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"continue"</span>
<a name="line-1843"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"convert"</span>
<a name="line-1844"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"create"</span>
<a name="line-1845"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"cross"</span>
<a name="line-1846"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"current"</span>
<a name="line-1847"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"current_time"</span>
<a name="line-1848"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"current_user"</span>
<a name="line-1849"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"cursor"</span>
<a name="line-1850"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"database"</span>
<a name="line-1851"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"dbcc"</span>
<a name="line-1852"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"deallocate"</span>
<a name="line-1853"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"declare"</span>
<a name="line-1854"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"default"</span>
<a name="line-1855"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"delete"</span>
<a name="line-1856"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"deny"</span>
<a name="line-1857"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"desc"</span>
<a name="line-1858"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"disk"</span>
<a name="line-1859"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"distinct"</span>
<a name="line-1860"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"distributed"</span>
<a name="line-1861"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varop'>--,"double"</span>
<a name="line-1862"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"drop"</span>
<a name="line-1863"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"dump"</span>
<a name="line-1864"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"else"</span>
<a name="line-1865"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"end"</span>
<a name="line-1866"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"errlvl"</span>
<a name="line-1867"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"escape"</span>
<a name="line-1868"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"except"</span>
<a name="line-1869"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"exec"</span>
<a name="line-1870"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"execute"</span>
<a name="line-1871"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"exists"</span>
<a name="line-1872"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"exit"</span>
<a name="line-1873"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"external"</span>
<a name="line-1874"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"fetch"</span>
<a name="line-1875"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"file"</span>
<a name="line-1876"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"fillfactor"</span>
<a name="line-1877"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"for"</span>
<a name="line-1878"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"foreign"</span>
<a name="line-1879"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"freetext"</span>
<a name="line-1880"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"freetexttable"</span>
<a name="line-1881"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"from"</span>
<a name="line-1882"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"full"</span>
<a name="line-1883"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"function"</span>
<a name="line-1884"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"goto"</span>
<a name="line-1885"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"grant"</span>
<a name="line-1886"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"group"</span>
<a name="line-1887"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"hash"</span>
<a name="line-1888"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"having"</span>
<a name="line-1889"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"holdlock"</span>
<a name="line-1890"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"identity"</span>
<a name="line-1891"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"identity_insert"</span>
<a name="line-1892"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"identitycol"</span>
<a name="line-1893"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"if"</span>
<a name="line-1894"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"in"</span>
<a name="line-1895"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"index"</span>
<a name="line-1896"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"inner"</span>
<a name="line-1897"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"insert"</span>
<a name="line-1898"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"intersect"</span>
<a name="line-1899"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"into"</span>
<a name="line-1900"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"is"</span>
<a name="line-1901"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"join"</span>
<a name="line-1902"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"key"</span>
<a name="line-1903"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"kill"</span>
<a name="line-1904"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"left"</span>
<a name="line-1905"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"like"</span>
<a name="line-1906"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"lineno"</span>
<a name="line-1907"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"load"</span>
<a name="line-1908"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"loop"</span>
<a name="line-1909"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"merge"</span>
<a name="line-1910"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"national"</span>
<a name="line-1911"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"natural"</span>
<a name="line-1912"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"nocheck"</span>
<a name="line-1913"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"nonclustered"</span>
<a name="line-1914"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"not"</span>
<a name="line-1915"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"null"</span>
<a name="line-1916"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"nullif"</span>
<a name="line-1917"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"of"</span>
<a name="line-1918"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"off"</span>
<a name="line-1919"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"offsets"</span>
<a name="line-1920"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"on"</span>
<a name="line-1921"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"open"</span>
<a name="line-1922"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"opendatasource"</span>
<a name="line-1923"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"openquery"</span>
<a name="line-1924"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"openrowset"</span>
<a name="line-1925"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"openxml"</span>
<a name="line-1926"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"option"</span>
<a name="line-1927"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"or"</span>
<a name="line-1928"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"order"</span>
<a name="line-1929"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"outer"</span>
<a name="line-1930"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"over"</span>
<a name="line-1931"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"percent"</span>
<a name="line-1932"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"pivot"</span>
<a name="line-1933"></a><span class='hs-varop'>&gt;</span>        <span class='hs-comment'>-- ,"plan" -- temporarily unkeyword this</span>
<a name="line-1934"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"precision"</span>
<a name="line-1935"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"primary"</span>
<a name="line-1936"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"print"</span>
<a name="line-1937"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"proc"</span>
<a name="line-1938"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"procedure"</span>
<a name="line-1939"></a><span class='hs-varop'>&gt;</span>        <span class='hs-comment'>-- ,"public"</span>
<a name="line-1940"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"raiserror"</span>
<a name="line-1941"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"read"</span>
<a name="line-1942"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"readtext"</span>
<a name="line-1943"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"reconfigure"</span>
<a name="line-1944"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"references"</span>
<a name="line-1945"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"replication"</span>
<a name="line-1946"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"restore"</span>
<a name="line-1947"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"restrict"</span>
<a name="line-1948"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"return"</span>
<a name="line-1949"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"revert"</span>
<a name="line-1950"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"revoke"</span>
<a name="line-1951"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"right"</span>
<a name="line-1952"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"rollback"</span>
<a name="line-1953"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"rowcount"</span>
<a name="line-1954"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"rowguidcol"</span>
<a name="line-1955"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"rule"</span>
<a name="line-1956"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"save"</span>
<a name="line-1957"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"schema"</span>
<a name="line-1958"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"securityaudit"</span>
<a name="line-1959"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"select"</span>
<a name="line-1960"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"session_user"</span>
<a name="line-1961"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"set"</span>
<a name="line-1962"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"setuser"</span>
<a name="line-1963"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"shutdown"</span>
<a name="line-1964"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"some"</span>
<a name="line-1965"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"statistics"</span>
<a name="line-1966"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"system_user"</span>
<a name="line-1967"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"table"</span>
<a name="line-1968"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"tablesample"</span>
<a name="line-1969"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"textsize"</span>
<a name="line-1970"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"then"</span>
<a name="line-1971"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"to"</span>
<a name="line-1972"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"top"</span>
<a name="line-1973"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"tran"</span>
<a name="line-1974"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"transaction"</span>
<a name="line-1975"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"trigger"</span>
<a name="line-1976"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"truncate"</span>
<a name="line-1977"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"tsequal"</span>
<a name="line-1978"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"union"</span>
<a name="line-1979"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"unique"</span>
<a name="line-1980"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"unpivot"</span>
<a name="line-1981"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"update"</span>
<a name="line-1982"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"updatetext"</span>
<a name="line-1983"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"use"</span>
<a name="line-1984"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"user"</span>
<a name="line-1985"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"values"</span>
<a name="line-1986"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"varying"</span>
<a name="line-1987"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"view"</span>
<a name="line-1988"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"waitfor"</span>
<a name="line-1989"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"when"</span>
<a name="line-1990"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"where"</span>
<a name="line-1991"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"while"</span>
<a name="line-1992"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"with"</span>
<a name="line-1993"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-str'>"writetext"</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-1994"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>ncs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>NameComponent</span><span class='hs-keyglyph'>]</span>
<a name="line-1995"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>ncs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-1996"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>ss</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>isSqlServer</span>
<a name="line-1997"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>if</span> <span class='hs-varid'>ss</span>
<a name="line-1998"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>then</span> <span class='hs-keyword'>do</span>
<a name="line-1999"></a><span class='hs-varop'>&gt;</span>       <span class='hs-comment'>-- what a mess</span>
<a name="line-2000"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyword'>let</span> <span class='hs-varid'>another</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-2001"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>numDots</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>readNDots</span>
<a name="line-2002"></a><span class='hs-varop'>&gt;</span>             <span class='hs-keyword'>let</span> <span class='hs-varid'>empties</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>replicate</span> <span class='hs-layout'>(</span><span class='hs-varid'>numDots</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nmc</span> <span class='hs-str'>""</span><span class='hs-layout'>)</span>
<a name="line-2003"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>nc</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nameComponent</span>
<a name="line-2004"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>suf</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>another</span>
<a name="line-2005"></a><span class='hs-varop'>&gt;</span>                           <span class='hs-layout'>,</span><span class='hs-varid'>return</span> <span class='hs-conid'>[]</span><span class='hs-keyglyph'>]</span>
<a name="line-2006"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>empties</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>nc</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>++</span> <span class='hs-varid'>suf</span>
<a name="line-2007"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>i</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>nameComponent</span>
<a name="line-2008"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>suf</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>another</span>
<a name="line-2009"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-layout'>,</span><span class='hs-varid'>return</span> <span class='hs-conid'>[]</span><span class='hs-keyglyph'>]</span>
<a name="line-2010"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span><span class='hs-conop'>:</span><span class='hs-varid'>suf</span><span class='hs-layout'>)</span>
<a name="line-2011"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>else</span>
<a name="line-2012"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>sepBy1</span> <span class='hs-varid'>nameComponent</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>"."</span><span class='hs-layout'>)</span>
</pre>
parse a complete name

<pre><a name="line-2013"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>name</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Name</span>
<a name="line-2014"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>AntiName</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>splice</span> <span class='hs-chr'>'n'</span>
<a name="line-2015"></a><span class='hs-varop'>&gt;</span>               <span class='hs-layout'>,</span><span class='hs-conid'>Name</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>ncs</span>
<a name="line-2016"></a><span class='hs-varop'>&gt;</span>               <span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-2017"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>nameComponent</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>NameComponent</span>
<a name="line-2018"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>nameComponent</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>nameComponentAllows</span> <span class='hs-conid'>[]</span>
</pre>
parser for a name component where you supply the exceptions to the
reserved identifier list to say you want these to parse successfully
instead of failing with a no keyword error

<pre><a name="line-2019"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>nameComponentAllows</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>String</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>NameComponent</span>
<a name="line-2020"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>nameComponentAllows</span> <span class='hs-varid'>allows</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-2021"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>p</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>pos</span>
<a name="line-2022"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>x</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>unrestrictedNameComponent</span>
<a name="line-2023"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>rw</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>reservedWords</span>
<a name="line-2024"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>case</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>of</span>
<a name="line-2025"></a><span class='hs-varop'>&gt;</span>     <span class='hs-conid'>Nmc</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>map</span> <span class='hs-varid'>toLower</span> <span class='hs-varid'>n</span> <span class='hs-varop'>`elem`</span> <span class='hs-varid'>allows</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-varid'>x</span>
<a name="line-2026"></a><span class='hs-varop'>&gt;</span>           <span class='hs-keyglyph'>|</span> <span class='hs-varid'>map</span> <span class='hs-varid'>toLower</span> <span class='hs-varid'>n</span> <span class='hs-varop'>`elem`</span> <span class='hs-varid'>rw</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-2027"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varid'>fail</span> <span class='hs-varop'>$</span> <span class='hs-str'>"no keywords "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>p</span> <span class='hs-varop'>++</span> <span class='hs-str'>" "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>n</span>
<a name="line-2028"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-varid'>x</span>
</pre>
ignore reserved keywords completely

<pre><a name="line-2029"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>unrestrictedNameComponent</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>NameComponent</span>
<a name="line-2030"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>unrestrictedNameComponent</span> <span class='hs-keyglyph'>=</span>
<a name="line-2031"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Nmc</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>idString</span>
<a name="line-2032"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-conid'>QNmc</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>qidString</span>
<a name="line-2033"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-conid'>AntiNameComponent</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>splice</span> <span class='hs-chr'>'m'</span><span class='hs-keyglyph'>]</span>
</pre>
quick hack to support identifiers like this: 'test' for sql server

not sure how to do this properly, you must not be able to write
strings in sql server using single quotes.

<pre><a name="line-2034"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>asAlias</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>NameComponent</span>
<a name="line-2035"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>asAlias</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-2036"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>ss</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>isSqlServer</span>
<a name="line-2037"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>if</span> <span class='hs-varid'>ss</span>
<a name="line-2038"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>then</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>nameComponent</span>
<a name="line-2039"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-layout'>,</span><span class='hs-keyword'>do</span>
<a name="line-2040"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varid'>s</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>stringN</span>
<a name="line-2041"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>QNmc</span> <span class='hs-varid'>s</span><span class='hs-keyglyph'>]</span>
<a name="line-2042"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>else</span> <span class='hs-varid'>nameComponent</span>
</pre>
--------------------------------------------------------------------------------

Utility parsers
===============

<pre><a name="line-2043"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>keyword</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>()</span>
<a name="line-2044"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>keyword</span> <span class='hs-varid'>k</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mytoken</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>tok</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>tok</span> <span class='hs-keyword'>of</span>
<a name="line-2045"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-conid'>Lex</span><span class='hs-varop'>.</span><span class='hs-conid'>Identifier</span> <span class='hs-conid'>Nothing</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>lcase</span> <span class='hs-layout'>(</span><span class='hs-conid'>T</span><span class='hs-varop'>.</span><span class='hs-varid'>unpack</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-varop'>==</span> <span class='hs-varid'>lcase</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>()</span>
<a name="line-2046"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-2047"></a><span class='hs-varop'>&gt;</span>                       <span class='hs-keyword'>where</span>
<a name="line-2048"></a><span class='hs-varop'>&gt;</span>                         <span class='hs-varid'>lcase</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>toLower</span>
</pre>
<pre><a name="line-2049"></a><span class='hs-varop'>&gt;</span>
<a name="line-2050"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>idString</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>String</span>
<a name="line-2051"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>idString</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mytoken</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>tok</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>tok</span> <span class='hs-keyword'>of</span>
<a name="line-2052"></a><span class='hs-varop'>&gt;</span>                                      <span class='hs-conid'>Lex</span><span class='hs-varop'>.</span><span class='hs-conid'>Identifier</span> <span class='hs-conid'>Nothing</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span>  <span class='hs-varid'>i</span>
<a name="line-2053"></a><span class='hs-varop'>&gt;</span>                                      <span class='hs-conid'>Lex</span><span class='hs-varop'>.</span><span class='hs-conid'>PrefixedVariable</span> <span class='hs-varid'>c</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span> <span class='hs-conop'>:</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>
<a name="line-2054"></a><span class='hs-varop'>&gt;</span>                                      <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-2055"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>qidString</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>String</span>
<a name="line-2056"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>qidString</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mytoken</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>tok</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>tok</span> <span class='hs-keyword'>of</span>
<a name="line-2057"></a><span class='hs-varop'>&gt;</span>                                      <span class='hs-conid'>Lex</span><span class='hs-varop'>.</span><span class='hs-conid'>Identifier</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>i</span>
<a name="line-2058"></a><span class='hs-varop'>&gt;</span>                                      <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-2059"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>splice</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>String</span>
<a name="line-2060"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>splice</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mytoken</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>tok</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>tok</span> <span class='hs-keyword'>of</span>
<a name="line-2061"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-conid'>Lex</span><span class='hs-varop'>.</span><span class='hs-conid'>Splice</span> <span class='hs-varid'>c'</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>c</span> <span class='hs-varop'>==</span> <span class='hs-varid'>c'</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>i</span>
<a name="line-2062"></a><span class='hs-varop'>&gt;</span>                                <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-2063"></a><span class='hs-varop'>&gt;</span>
<a name="line-2064"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>symbol</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>()</span>
<a name="line-2065"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>symbol</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mytoken</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>tok</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>tok</span> <span class='hs-keyword'>of</span>
<a name="line-2066"></a><span class='hs-varop'>&gt;</span>                                    <span class='hs-conid'>Lex</span><span class='hs-varop'>.</span><span class='hs-conid'>Symbol</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>T</span><span class='hs-varop'>.</span><span class='hs-varid'>unpack</span> <span class='hs-varid'>c</span><span class='hs-varop'>==</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>()</span>
<a name="line-2067"></a><span class='hs-varop'>&gt;</span>                                    <span class='hs-keyword'>_</span>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-2068"></a><span class='hs-varop'>&gt;</span>
<a name="line-2069"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>liftPositionalArgTok</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Integer</span>
<a name="line-2070"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>liftPositionalArgTok</span> <span class='hs-keyglyph'>=</span>
<a name="line-2071"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>mytoken</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>tok</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>tok</span> <span class='hs-keyword'>of</span>
<a name="line-2072"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-conid'>Lex</span><span class='hs-varop'>.</span><span class='hs-conid'>PositionalArg</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fromIntegral</span> <span class='hs-varid'>n</span>
<a name="line-2073"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-2074"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>positionalArg</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-2075"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>positionalArg</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PositionalArg</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>liftPositionalArgTok</span>
<a name="line-2076"></a><span class='hs-varop'>&gt;</span>
<a name="line-2077"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>antiScalarExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-2078"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>antiScalarExpr</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AntiScalarExpr</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>splice</span> <span class='hs-chr'>'e'</span>
<a name="line-2079"></a><span class='hs-varop'>&gt;</span>
<a name="line-2080"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>placeholder</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-2081"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>placeholder</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>Placeholder</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>symbol</span> <span class='hs-str'>"?"</span>
<a name="line-2082"></a><span class='hs-varop'>&gt;</span>
<a name="line-2083"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>numString</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>String</span>
<a name="line-2084"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>numString</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mytoken</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>tok</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>tok</span> <span class='hs-keyword'>of</span>
<a name="line-2085"></a><span class='hs-varop'>&gt;</span>                                     <span class='hs-conid'>Lex</span><span class='hs-varop'>.</span><span class='hs-conid'>SqlNumber</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>n</span>
<a name="line-2086"></a><span class='hs-varop'>&gt;</span>                                     <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-2087"></a><span class='hs-varop'>&gt;</span>
<a name="line-2088"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>liftStringTok</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>String</span>
<a name="line-2089"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>liftStringTok</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mytoken</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>tok</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-2090"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-keyword'>case</span> <span class='hs-varid'>tok</span> <span class='hs-keyword'>of</span>
<a name="line-2091"></a><span class='hs-varop'>&gt;</span>                            <span class='hs-conid'>Lex</span><span class='hs-varop'>.</span><span class='hs-conid'>SqlString</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-2092"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-comment'>-- bit hacky, the lexer doesn't process quotes</span>
<a name="line-2093"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-comment'>-- but the parser expects them to have been replaced</span>
<a name="line-2094"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-conid'>T</span><span class='hs-varop'>.</span><span class='hs-varid'>unpack</span> <span class='hs-varop'>$</span> <span class='hs-conid'>T</span><span class='hs-varop'>.</span><span class='hs-varid'>replace</span> <span class='hs-str'>"''"</span> <span class='hs-str'>"'"</span> <span class='hs-varop'>$</span> <span class='hs-conid'>T</span><span class='hs-varop'>.</span><span class='hs-varid'>replace</span> <span class='hs-str'>"\'"</span> <span class='hs-str'>"'"</span> <span class='hs-varop'>$</span> <span class='hs-conid'>T</span><span class='hs-varop'>.</span><span class='hs-varid'>pack</span> <span class='hs-varid'>s</span>
<a name="line-2095"></a><span class='hs-varop'>&gt;</span>                            <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-2096"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>stringLit</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>ScalarExpr</span>
<a name="line-2097"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>stringLit</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span>
<a name="line-2098"></a><span class='hs-varop'>&gt;</span>             <span class='hs-keyglyph'>[</span><span class='hs-conid'>StringLit</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>liftStringTok</span>
<a name="line-2099"></a><span class='hs-varop'>&gt;</span>              <span class='hs-comment'>-- bit crap at the moment, not sure how to fix without</span>
<a name="line-2100"></a><span class='hs-varop'>&gt;</span>              <span class='hs-comment'>-- mangling the ast types</span>
<a name="line-2101"></a><span class='hs-varop'>&gt;</span>             <span class='hs-layout'>,</span><span class='hs-conid'>StringLit</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>pos</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>concat</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"$s("</span><span class='hs-layout'>,</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span><span class='hs-str'>")"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>splice</span> <span class='hs-chr'>'s'</span><span class='hs-layout'>)</span>
<a name="line-2102"></a><span class='hs-varop'>&gt;</span>             <span class='hs-keyglyph'>]</span>
<a name="line-2103"></a><span class='hs-varop'>&gt;</span>
<a name="line-2104"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>stringN</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>String</span>
<a name="line-2105"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>stringN</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mytoken</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>tok</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-2106"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-keyword'>case</span> <span class='hs-varid'>tok</span> <span class='hs-keyword'>of</span>
<a name="line-2107"></a><span class='hs-varop'>&gt;</span>                            <span class='hs-conid'>Lex</span><span class='hs-varop'>.</span><span class='hs-conid'>SqlString</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>s</span>
<a name="line-2108"></a><span class='hs-varop'>&gt;</span>                            <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-2109"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>extrStr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ScalarExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-2110"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>extrStr</span> <span class='hs-layout'>(</span><span class='hs-conid'>StringLit</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>s</span>
<a name="line-2111"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>extrStr</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span>
<a name="line-2112"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>error</span> <span class='hs-varop'>$</span> <span class='hs-str'>"internal error: extrStr not supported for this type "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>x</span>
</pre>
== combinatory things

<pre><a name="line-2113"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parens</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-varid'>a</span>
<a name="line-2114"></a><span class='hs-varop'>&gt;</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-varid'>a</span>
<a name="line-2115"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>parens</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>between</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>"("</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>")"</span><span class='hs-layout'>)</span>
<a name="line-2116"></a><span class='hs-varop'>&gt;</span>
<a name="line-2117"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>squares</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-varid'>a</span>
<a name="line-2118"></a><span class='hs-varop'>&gt;</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-varid'>a</span>
<a name="line-2119"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>squares</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>between</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>"["</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>"]"</span><span class='hs-layout'>)</span>
<a name="line-2120"></a><span class='hs-varop'>&gt;</span>
<a name="line-2121"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>tryOptionMaybe</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Stream</span> <span class='hs-varid'>s</span> <span class='hs-varid'>m</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span>
<a name="line-2122"></a><span class='hs-varop'>&gt;</span>              <span class='hs-conid'>ParsecT</span> <span class='hs-varid'>s</span> <span class='hs-varid'>u</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ParsecT</span> <span class='hs-varid'>s</span> <span class='hs-varid'>u</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-2123"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>tryOptionMaybe</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>optionMaybe</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>Nothing</span>
<a name="line-2124"></a><span class='hs-varop'>&gt;</span>
<a name="line-2125"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>{-commaSep2 :: SParser a
<a name="line-2126"></a>&gt;           -&gt; SParser [a]
<a name="line-2127"></a>&gt; commaSep2 p = sepBy2 p (symbol ",")
<a name="line-2128"></a>&gt;
<a name="line-2129"></a>&gt; sepBy2 :: (Stream s m t) =&gt;
<a name="line-2130"></a>&gt;           ParsecT s u m a -&gt; ParsecT s u m b -&gt; ParsecT s u m [a]
<a name="line-2131"></a>&gt; sepBy2 p sep = (p &lt;* sep) &lt;:&gt; sepBy1 p sep-}</span>
<a name="line-2132"></a><span class='hs-varop'>&gt;</span>
<a name="line-2133"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>commaSep</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-varid'>a</span>
<a name="line-2134"></a><span class='hs-varop'>&gt;</span>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-2135"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>commaSep</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sepBy</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>","</span><span class='hs-layout'>)</span>
<a name="line-2136"></a><span class='hs-varop'>&gt;</span>
<a name="line-2137"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>commaSep1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-varid'>a</span>
<a name="line-2138"></a><span class='hs-varop'>&gt;</span>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-2139"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>commaSep1</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sepBy1</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-varid'>symbol</span> <span class='hs-str'>","</span><span class='hs-layout'>)</span>
</pre>
pass a list of pairs of strings and values
try each pair k,v in turn,
if keyword k matches then return v
doesn't really add a lot of value

<pre><a name="line-2140"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>matchAKeyword</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Text</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-varid'>a</span>
<a name="line-2141"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>matchAKeyword</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fail</span> <span class='hs-str'>"no matches"</span>
<a name="line-2142"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>matchAKeyword</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>k</span><span class='hs-layout'>,</span><span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-conop'>:</span><span class='hs-varid'>kvs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>v</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>keyword</span> <span class='hs-varid'>k</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>matchAKeyword</span> <span class='hs-varid'>kvs</span>
</pre>
optionalSuffix

parse the start of something -> parseResultA,
then parse an optional suffix -> parseResultB
if this second parser succeeds, return fn2 parseResultA parseResultB
else return fn1 parseResultA

e.g.
parsing an identifier in a select list can be
fieldName
or
fieldName as alias
so you can pass
* IdentifierCtor
* identifier (returns aval)
* AliasedIdentifierCtor
* parser for (as b) (returns bval)
as the args, which I like to ident like:
parseOptionalSuffix
  IdentifierCtor identifierParser
  AliasedIdentifierCtor () asAliasParser
and you get either
* IdentifierCtor identifierValue
or
* AliasedIdentifierCtor identifierValue aliasValue
as the result depending on whether the asAliasParser
succeeds or not.

there must be a standard way of writing this

<pre><a name="line-2143"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>optionalSuffix</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Stream</span> <span class='hs-varid'>s</span> <span class='hs-varid'>m</span> <span class='hs-varid'>t2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span>
<a name="line-2144"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-layout'>(</span><span class='hs-varid'>t1</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-2145"></a><span class='hs-varop'>&gt;</span>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ParsecT</span> <span class='hs-varid'>s</span> <span class='hs-varid'>u</span> <span class='hs-varid'>m</span> <span class='hs-varid'>t1</span>
<a name="line-2146"></a><span class='hs-varop'>&gt;</span>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>t1</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-2147"></a><span class='hs-varop'>&gt;</span>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ParsecT</span> <span class='hs-varid'>s</span> <span class='hs-varid'>u</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-2148"></a><span class='hs-varop'>&gt;</span>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ParsecT</span> <span class='hs-varid'>s</span> <span class='hs-varid'>u</span> <span class='hs-varid'>m</span> <span class='hs-varid'>b</span>
<a name="line-2149"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>optionalSuffix</span> <span class='hs-varid'>c1</span> <span class='hs-varid'>p1</span> <span class='hs-varid'>c2</span> <span class='hs-varid'>p2</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-2150"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>x</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>p1</span>
<a name="line-2151"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>option</span> <span class='hs-layout'>(</span><span class='hs-varid'>c1</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>c2</span> <span class='hs-varid'>x</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>try</span> <span class='hs-varid'>p2</span><span class='hs-layout'>)</span>
</pre>

couldn't work how to to perms so just did this hack instead
e.g.
a1,a2,b1,b2,a2,b3,b4 parses to ([a1,a2,a3],[b1,b2,b3,b4])

<pre><a name="line-2152"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>multiPerm</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Stream</span> <span class='hs-varid'>s</span> <span class='hs-varid'>m</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span>
<a name="line-2153"></a><span class='hs-varop'>&gt;</span>                <span class='hs-conid'>ParsecT</span> <span class='hs-varid'>s</span> <span class='hs-varid'>u</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a1</span>
<a name="line-2154"></a><span class='hs-varop'>&gt;</span>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ParsecT</span> <span class='hs-varid'>s</span> <span class='hs-varid'>u</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-2155"></a><span class='hs-varop'>&gt;</span>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ParsecT</span> <span class='hs-varid'>s</span> <span class='hs-varid'>u</span> <span class='hs-varid'>m</span> <span class='hs-varid'>sep</span>
<a name="line-2156"></a><span class='hs-varop'>&gt;</span>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ParsecT</span> <span class='hs-varid'>s</span> <span class='hs-varid'>u</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>a1</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-2157"></a><span class='hs-varop'>&gt;</span>
<a name="line-2158"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>multiPerm</span> <span class='hs-varid'>p1</span> <span class='hs-varid'>p2</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-2159"></a><span class='hs-varop'>&gt;</span>   <span class='hs-layout'>(</span><span class='hs-varid'>r1</span><span class='hs-layout'>,</span> <span class='hs-varid'>r2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>unzip</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>sepBy1</span> <span class='hs-varid'>parseAorB</span> <span class='hs-varid'>sep</span>
<a name="line-2160"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>catMaybes</span> <span class='hs-varid'>r1</span><span class='hs-layout'>,</span> <span class='hs-varid'>catMaybes</span> <span class='hs-varid'>r2</span><span class='hs-layout'>)</span>
<a name="line-2161"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-2162"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>parseAorB</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span>
<a name="line-2163"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>p1</span>
<a name="line-2164"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>y</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Nothing</span><span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>p2</span><span class='hs-keyglyph'>]</span>
</pre>
== position stuff

wrapper for parsec source positions, probably not really useful

<pre><a name="line-2165"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>MySourcePos</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>String</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span>
<a name="line-2166"></a><span class='hs-varop'>&gt;</span>
<a name="line-2167"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>toMySp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SourcePos</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>MySourcePos</span>
<a name="line-2168"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>toMySp</span> <span class='hs-varid'>sp</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>sourceName</span> <span class='hs-varid'>sp</span><span class='hs-layout'>,</span><span class='hs-varid'>sourceLine</span> <span class='hs-varid'>sp</span><span class='hs-layout'>,</span><span class='hs-varid'>sourceColumn</span> <span class='hs-varid'>sp</span><span class='hs-layout'>)</span>
</pre>
parser combinator to return the current position as an ast annotation

<pre><a name="line-2169"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>pos</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SParser</span> <span class='hs-conid'>Annotation</span>
<a name="line-2170"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>pos</span> <span class='hs-keyglyph'>=</span>
<a name="line-2171"></a><span class='hs-varop'>&gt;</span>   <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>emptyAnnotation</span> <span class='hs-layout'>{</span><span class='hs-varid'>anSrc</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>a</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>toMySp</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>getPosition</span>
</pre>
== lexer stuff

<pre><a name="line-2172"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>mytoken</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Lex</span><span class='hs-varop'>.</span><span class='hs-conid'>Token</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SParser</span> <span class='hs-varid'>a</span>
<a name="line-2173"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>mytoken</span> <span class='hs-varid'>test</span>
<a name="line-2174"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>token</span> <span class='hs-varid'>showToken</span> <span class='hs-varid'>posToken</span> <span class='hs-varid'>testToken</span>
<a name="line-2175"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-2176"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>showToken</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-varid'>tok</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varid'>tok</span>
<a name="line-2177"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>posToken</span>  <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>newPos</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span>
<a name="line-2178"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>testToken</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-varid'>tok</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>test</span> <span class='hs-varid'>tok</span>
</pre>
--------------------------------------------------------------------------------

= fixup tree

this is where some generics code is used to transform the parse trees
to alter the nodes used where it's too difficult to do whilst
parsing. The only item at the moment that needs this treatment is the
any/some/all construct which looks like this:
expr operator [any|some|all] (expr)

This gets parsed as
binop operator [expr1,app [any|some|all] [expr2,...]]

and we want to transform it to
liftoperator operator any|some|all [expr1, expr2,...]
not doing anything if the funcall name isn't any,some,all
any other checks are left to the type checking stage
(e.g. there can only be one expression in the expr2 part, and it must
be an array or subselect, etc)

<pre><a name="line-2179"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>fixupTree</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Data</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span>
<a name="line-2180"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>fixupTree</span> <span class='hs-keyglyph'>=</span>
<a name="line-2181"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>transformBi</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-2182"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyword'>case</span> <span class='hs-varid'>x</span> <span class='hs-keyword'>of</span>
<a name="line-2183"></a><span class='hs-varop'>&gt;</span>              <span class='hs-conid'>BinaryOp</span> <span class='hs-varid'>an</span> <span class='hs-varid'>op</span> <span class='hs-varid'>expr1</span> <span class='hs-layout'>(</span><span class='hs-conid'>App</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>fn</span> <span class='hs-layout'>(</span><span class='hs-varid'>expr2s</span><span class='hs-conop'>:</span><span class='hs-varid'>expr3s</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-2184"></a><span class='hs-varop'>&gt;</span>                <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Name</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Nmc</span> <span class='hs-varid'>fnm</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>fn</span>
<a name="line-2185"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>flav</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>map</span> <span class='hs-varid'>toLower</span> <span class='hs-varid'>fnm</span> <span class='hs-keyword'>of</span>
<a name="line-2186"></a><span class='hs-varop'>&gt;</span>                                  <span class='hs-str'>"any"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>LiftAny</span>
<a name="line-2187"></a><span class='hs-varop'>&gt;</span>                                  <span class='hs-str'>"some"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>LiftAny</span>
<a name="line-2188"></a><span class='hs-varop'>&gt;</span>                                  <span class='hs-str'>"all"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>LiftAll</span>
<a name="line-2189"></a><span class='hs-varop'>&gt;</span>                                  <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<a name="line-2190"></a><span class='hs-varop'>&gt;</span>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LiftApp</span> <span class='hs-varid'>an</span> <span class='hs-varid'>op</span> <span class='hs-varid'>flav</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>expr1</span><span class='hs-layout'>,</span><span class='hs-varid'>expr2s</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>++</span> <span class='hs-varid'>expr3s</span><span class='hs-layout'>)</span>
<a name="line-2191"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varid'>x1</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>x1</span>
</pre></body>
</html>
