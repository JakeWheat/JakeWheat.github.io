<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Database/HsSqlPpp/Internals/LexInternal.lhs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>

<pre><a name="line-1"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>{-# LANGUAGE TupleSections,OverloadedStrings #-}</span>
<a name="line-2"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>module</span> <span class='hs-conid'>Database</span><span class='hs-varop'>.</span><span class='hs-conid'>HsSqlPpp</span><span class='hs-varop'>.</span><span class='hs-conid'>Internals</span><span class='hs-varop'>.</span><span class='hs-conid'>LexInternal</span>
<a name="line-3"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>(</span><span class='hs-conid'>Token</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-4"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>prettyToken</span>
<a name="line-5"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>lexToken</span>
<a name="line-6"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>lexTokens</span>
<a name="line-7"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
</pre>
<pre><a name="line-8"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>--import qualified Data.Text as T</span>
<a name="line-9"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>Lazy</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>LT</span>
<a name="line-10"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>Parsec</span>
<a name="line-11"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>--Cimport Text.Parsec.String hdi</span>
<a name="line-12"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>Parsec</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>Lazy</span>
<a name="line-13"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Applicative</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>&lt;|&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>many</span><span class='hs-layout'>)</span>
<a name="line-14"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Char</span>
<a name="line-15"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Database</span><span class='hs-varop'>.</span><span class='hs-conid'>HsSqlPpp</span><span class='hs-varop'>.</span><span class='hs-conid'>Internals</span><span class='hs-varop'>.</span><span class='hs-conid'>Dialect</span>
<a name="line-16"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span>
<a name="line-17"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Prelude</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>takeWhile</span><span class='hs-layout'>)</span>
<a name="line-18"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Maybe</span>
</pre>
<pre><a name="line-19"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>-- | Represents a lexed token</span>
<a name="line-20"></a><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>data</span> <span class='hs-conid'>Token</span>
<a name="line-21"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- | a symbol in postgresql dialect is one of the following:</span>
<a name="line-22"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>--</span>
<a name="line-23"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- * one of the characters (),;[]{}  (the {} is for odbc)</span>
<a name="line-24"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>--</span>
<a name="line-25"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- * \'..\' or \':=\' or \'.\' or \':\'</span>
<a name="line-26"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>--</span>
<a name="line-27"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- * a compound symbol, which starts with one of \'*\/\&lt;&gt;=~!\@#%^&amp;|\`?+-' and follows with 0 or more of '*\/&lt;&gt;=~!\@#%^&amp;|\`?'</span>
<a name="line-28"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>--</span>
<a name="line-29"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- things that are not lexed as symbols:</span>
<a name="line-30"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>--</span>
<a name="line-31"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- * [] used in quoted identifiers, prefix \@,#,: used in identifiers</span>
<a name="line-32"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>--</span>
<a name="line-33"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- * $n positional arg</span>
<a name="line-34"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>--</span>
<a name="line-35"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Symbol</span> <span class='hs-conid'>String</span>
<a name="line-36"></a><span class='hs-varop'>&gt;</span>
<a name="line-37"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- | This is an identifier or keyword.</span>
<a name="line-38"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>--</span>
<a name="line-39"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- The 'Maybe (Char,Char)' selects the quoted style - 'Nothing' means the</span>
<a name="line-40"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- identifier was unquoted</span>
<a name="line-41"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- otherwise the two characters are the start and end quote.</span>
<a name="line-42"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>--</span>
<a name="line-43"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- \'\"\' is used to quote identifiers in standard sql, sql server also uses [brackets]</span>
<a name="line-44"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- to quote identifiers.</span>
<a name="line-45"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>--</span>
<a name="line-46"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- The identifier also includes the \'variable marker prefix\'</span>
<a name="line-47"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- used in sql server (e.g. \@identifier, #identifier), and oracle</span>
<a name="line-48"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- (e.g. :identifier)</span>
<a name="line-49"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Identifier</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>String</span><span class='hs-layout'>,</span><span class='hs-conid'>String</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-conid'>String</span>
<a name="line-50"></a><span class='hs-varop'>&gt;</span>
<a name="line-51"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>--  | This is a prefixed variable symbol, such as :var, @var or #var</span>
<a name="line-52"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- (only :var is used in ansi dialect)</span>
<a name="line-53"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PrefixedVariable</span> <span class='hs-conid'>Char</span> <span class='hs-conid'>String</span>
<a name="line-54"></a><span class='hs-varop'>&gt;</span>
<a name="line-55"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- | a postgresql positional arg, e.g. $1</span>
<a name="line-56"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PositionalArg</span> <span class='hs-conid'>Int</span>
<a name="line-57"></a><span class='hs-varop'>&gt;</span>
<a name="line-58"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- | This is a string literal.</span>
<a name="line-59"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>--</span>
<a name="line-60"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- The first field is the quotes used: single quote (\')</span>
<a name="line-61"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- for normal strings, E' for escape supporting strings,</span>
<a name="line-62"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- and $$ delimiter for postgresql dollar quoted strings.</span>
<a name="line-63"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>--</span>
<a name="line-64"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- The lexer doesn't process the escapes in strings, but passes</span>
<a name="line-65"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- on the literal source e.g. E\'\\n\' parses to SqlString \"E\'\" \"\\n\"</span>
<a name="line-66"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- with the literal characters \'\\\' and \'n\' in the string, not a newline character.</span>
<a name="line-67"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- quotes within a string (\'\') or escaped string (\'\' or \\\') are passed through unchanged</span>
<a name="line-68"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SqlString</span> <span class='hs-conid'>String</span> <span class='hs-conid'>String</span> <span class='hs-conid'>String</span>
<a name="line-69"></a><span class='hs-varop'>&gt;</span>
<a name="line-70"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- | a number literal (integral or otherwise), stored in original format</span>
<a name="line-71"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- unchanged</span>
<a name="line-72"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SqlNumber</span> <span class='hs-conid'>String</span>
<a name="line-73"></a><span class='hs-varop'>&gt;</span>
<a name="line-74"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- | non-significant whitespace (space, tab, newline) (strictly speaking,</span>
<a name="line-75"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- it is up to the client to decide whether the whitespace is significant</span>
<a name="line-76"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- or not)</span>
<a name="line-77"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Whitespace</span> <span class='hs-conid'>String</span>
<a name="line-78"></a><span class='hs-varop'>&gt;</span>
<a name="line-79"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- | a commented line using --, contains every character starting with the</span>
<a name="line-80"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- \'--\' and including the terminating newline character if there is one</span>
<a name="line-81"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- - this will be missing if the last line in the source is a line comment</span>
<a name="line-82"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- with no trailing newline</span>
<a name="line-83"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LineComment</span> <span class='hs-conid'>String</span>
<a name="line-84"></a><span class='hs-varop'>&gt;</span>
<a name="line-85"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- | a block comment, \/* stuff *\/, includes the comment delimiters</span>
<a name="line-86"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyglyph'>|</span> <span class='hs-conid'>BlockComment</span> <span class='hs-conid'>String</span>
<a name="line-87"></a><span class='hs-varop'>&gt;</span>
<a name="line-88"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- | an antiquotation splice, e.g. $x(stuff)</span>
<a name="line-89"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Splice</span> <span class='hs-conid'>Char</span> <span class='hs-conid'>String</span>
<a name="line-90"></a><span class='hs-varop'>&gt;</span>
<a name="line-91"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- | the copy data in a copy from stdin</span>
<a name="line-92"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CopyPayload</span> <span class='hs-conid'>String</span>
<a name="line-93"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span><span class='hs-conid'>Show</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-94"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>-- | Accurate pretty printing, if you lex a bunch of tokens,</span>
<a name="line-95"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>-- then pretty print them, should should get back exactly the</span>
<a name="line-96"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>-- same string</span>
<a name="line-97"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>prettyToken</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Token</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-98"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>prettyToken</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Symbol</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>s</span>
<a name="line-99"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>prettyToken</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Identifier</span> <span class='hs-conid'>Nothing</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>t</span>
<a name="line-100"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>prettyToken</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Identifier</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span><span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span> <span class='hs-varop'>++</span> <span class='hs-varid'>t</span> <span class='hs-varop'>++</span> <span class='hs-varid'>b</span>
<a name="line-101"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>prettyToken</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>PrefixedVariable</span> <span class='hs-varid'>c</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span><span class='hs-conop'>:</span><span class='hs-varid'>s</span>
<a name="line-102"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>prettyToken</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>SqlString</span> <span class='hs-varid'>q</span> <span class='hs-varid'>r</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>q</span> <span class='hs-varop'>++</span> <span class='hs-varid'>t</span> <span class='hs-varop'>++</span> <span class='hs-varid'>r</span>
<a name="line-103"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>prettyToken</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>SqlNumber</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>r</span>
<a name="line-104"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>prettyToken</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Whitespace</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>t</span>
<a name="line-105"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>prettyToken</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>PositionalArg</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-chr'>'$'</span><span class='hs-conop'>:</span><span class='hs-varid'>show</span> <span class='hs-varid'>n</span>
<a name="line-106"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>prettyToken</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>LineComment</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>l</span>
<a name="line-107"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>prettyToken</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>BlockComment</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span>
<a name="line-108"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>prettyToken</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Splice</span> <span class='hs-varid'>c</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-chr'>'$'</span><span class='hs-conop'>:</span><span class='hs-varid'>c</span><span class='hs-conop'>:</span><span class='hs-chr'>'('</span><span class='hs-conop'>:</span><span class='hs-varid'>t</span> <span class='hs-varop'>++</span> <span class='hs-str'>")"</span>
<a name="line-109"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>prettyToken</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>CopyPayload</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>s</span> <span class='hs-varop'>++</span> <span class='hs-str'>"\\.\n"</span>
</pre>

not sure how to get the position information in the parse errors

TODO: try to make all parsers applicative only
investigate what is missing for postgresql
investigate differences for sql server, oracle, maybe db2 and mysql
  also

<pre><a name="line-110"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>lexTokens</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LT</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Either</span> <span class='hs-conid'>ParseError</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>FilePath</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span><span class='hs-conid'>Token</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-111"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>lexTokens</span> <span class='hs-varid'>dialect</span> <span class='hs-varid'>fn'</span> <span class='hs-varid'>mp</span> <span class='hs-varid'>txt</span> <span class='hs-keyglyph'>=</span>
<a name="line-112"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>l'</span><span class='hs-layout'>,</span><span class='hs-varid'>c'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromMaybe</span> <span class='hs-layout'>(</span><span class='hs-num'>1</span><span class='hs-layout'>,</span><span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varid'>mp</span>
<a name="line-113"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>in</span> <span class='hs-varid'>runParser</span> <span class='hs-layout'>(</span><span class='hs-varid'>setPos</span> <span class='hs-layout'>(</span><span class='hs-varid'>fn'</span><span class='hs-layout'>,</span><span class='hs-varid'>l'</span><span class='hs-layout'>,</span><span class='hs-varid'>c'</span><span class='hs-layout'>)</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>many_p</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>eof</span><span class='hs-layout'>)</span> <span class='hs-conid'>()</span> <span class='hs-str'>""</span> <span class='hs-varid'>txt</span>
<a name="line-114"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
</pre>
pretty hacky, want to switch to a different lexer for copy from stdin
statements

if we see 'from stdin;' then try to lex a copy payload

<pre><a name="line-115"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>many_p</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>some_p</span> <span class='hs-varop'>`mplus`</span> <span class='hs-varid'>return</span> <span class='hs-conid'>[]</span>
<a name="line-116"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>some_p</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-117"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>tok</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexToken</span> <span class='hs-varid'>dialect</span>
<a name="line-118"></a><span class='hs-varop'>&gt;</span>        <span class='hs-keyword'>case</span> <span class='hs-varid'>tok</span> <span class='hs-keyword'>of</span>
<a name="line-119"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>Identifier</span> <span class='hs-conid'>Nothing</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>map</span> <span class='hs-varid'>toLower</span> <span class='hs-varid'>t</span> <span class='hs-varop'>==</span> <span class='hs-str'>"from"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>tok</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>seeStdin</span>
<a name="line-120"></a><span class='hs-varop'>&gt;</span>          <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>tok</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>many_p</span>
<a name="line-121"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>seeStdin</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-122"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>tok</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexToken</span> <span class='hs-varid'>dialect</span>
<a name="line-123"></a><span class='hs-varop'>&gt;</span>        <span class='hs-keyword'>case</span> <span class='hs-varid'>tok</span> <span class='hs-keyword'>of</span>
<a name="line-124"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-conid'>Identifier</span> <span class='hs-conid'>Nothing</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>map</span> <span class='hs-varid'>toLower</span> <span class='hs-varid'>t</span> <span class='hs-varop'>==</span> <span class='hs-str'>"stdin"</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>tok</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>seeColon</span>
<a name="line-125"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isWs</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>tok</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>seeStdin</span>
<a name="line-126"></a><span class='hs-varop'>&gt;</span>          <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>tok</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>many_p</span>
<a name="line-127"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>seeColon</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-128"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>tok</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lexToken</span> <span class='hs-varid'>dialect</span>
<a name="line-129"></a><span class='hs-varop'>&gt;</span>        <span class='hs-keyword'>case</span> <span class='hs-varid'>tok</span> <span class='hs-keyword'>of</span>
<a name="line-130"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-conid'>Symbol</span> <span class='hs-str'>";"</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>tok</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>copyPayload</span>
<a name="line-131"></a><span class='hs-varop'>&gt;</span>          <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>tok</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>many_p</span>
<a name="line-132"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>copyPayload</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-133"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>p'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getPosition</span>
<a name="line-134"></a><span class='hs-varop'>&gt;</span>        <span class='hs-keyword'>let</span> <span class='hs-varid'>pos</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>sourceName</span> <span class='hs-varid'>p'</span><span class='hs-layout'>,</span><span class='hs-varid'>sourceLine</span> <span class='hs-varid'>p'</span><span class='hs-layout'>,</span> <span class='hs-varid'>sourceColumn</span> <span class='hs-varid'>p'</span><span class='hs-layout'>)</span>
<a name="line-135"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>tok</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'\n'</span> <span class='hs-varop'>*&gt;</span>
<a name="line-136"></a><span class='hs-varop'>&gt;</span>             <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pos</span><span class='hs-layout'>,</span> <span class='hs-conid'>CopyPayload</span> <span class='hs-varop'>$</span> <span class='hs-varid'>x</span> <span class='hs-varop'>++</span> <span class='hs-str'>"\n"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-137"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>manyTill</span> <span class='hs-varid'>anyChar</span> <span class='hs-layout'>(</span><span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-varid'>string</span> <span class='hs-str'>"\n\\.\n"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-138"></a><span class='hs-varop'>&gt;</span>        <span class='hs-comment'>--let (_,CopyPayload t) = tok</span>
<a name="line-139"></a><span class='hs-varop'>&gt;</span>        <span class='hs-comment'>--trace ("payload is '" ++ T.unpack t ++ "'") $ return ()</span>
<a name="line-140"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>(</span><span class='hs-varid'>tok</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>many_p</span>
<a name="line-141"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>setPos</span> <span class='hs-layout'>(</span><span class='hs-varid'>fn</span><span class='hs-layout'>,</span><span class='hs-varid'>l</span><span class='hs-layout'>,</span><span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-142"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>flip</span> <span class='hs-varid'>setSourceName</span> <span class='hs-varid'>fn</span>
<a name="line-143"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>.</span> <span class='hs-varid'>flip</span> <span class='hs-varid'>setSourceLine</span> <span class='hs-varid'>l</span>
<a name="line-144"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>.</span> <span class='hs-varid'>flip</span> <span class='hs-varid'>setSourceColumn</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-varid'>getPosition</span>
<a name="line-145"></a><span class='hs-varop'>&gt;</span>           <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>setPosition</span>
<a name="line-146"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>isWs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Token</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-147"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>isWs</span> <span class='hs-layout'>(</span><span class='hs-conid'>Whitespace</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-148"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>isWs</span> <span class='hs-layout'>(</span><span class='hs-conid'>BlockComment</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-149"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>isWs</span> <span class='hs-layout'>(</span><span class='hs-conid'>LineComment</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-150"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>isWs</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
</pre>
<pre><a name="line-151"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>-- | parser for a sql token</span>
<a name="line-152"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>lexToken</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>FilePath</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span><span class='hs-conid'>Token</span><span class='hs-layout'>)</span>
<a name="line-153"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>lexToken</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-154"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>p'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getPosition</span>
<a name="line-155"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyword'>let</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>sourceName</span> <span class='hs-varid'>p'</span><span class='hs-layout'>,</span><span class='hs-varid'>sourceLine</span> <span class='hs-varid'>p'</span><span class='hs-layout'>,</span> <span class='hs-varid'>sourceColumn</span> <span class='hs-varid'>p'</span><span class='hs-layout'>)</span>
<a name="line-156"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>(</span><span class='hs-varid'>p</span><span class='hs-layout'>,</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>sqlString</span> <span class='hs-varid'>d</span>
<a name="line-157"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-layout'>,</span><span class='hs-varid'>identifier</span> <span class='hs-varid'>d</span>
<a name="line-158"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-layout'>,</span><span class='hs-varid'>lineComment</span> <span class='hs-varid'>d</span>
<a name="line-159"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-layout'>,</span><span class='hs-varid'>blockComment</span> <span class='hs-varid'>d</span>
<a name="line-160"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-layout'>,</span><span class='hs-varid'>sqlNumber</span> <span class='hs-varid'>d</span>
<a name="line-161"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-layout'>,</span><span class='hs-varid'>positionalArg</span> <span class='hs-varid'>d</span>
<a name="line-162"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-layout'>,</span><span class='hs-varid'>dontParseEndBlockComment</span> <span class='hs-varid'>d</span>
<a name="line-163"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-layout'>,</span><span class='hs-varid'>prefixedVariable</span> <span class='hs-varid'>d</span>
<a name="line-164"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-layout'>,</span><span class='hs-varid'>symbol</span> <span class='hs-varid'>d</span>
<a name="line-165"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-layout'>,</span><span class='hs-varid'>sqlWhitespace</span> <span class='hs-varid'>d</span>
<a name="line-166"></a><span class='hs-varop'>&gt;</span>                     <span class='hs-layout'>,</span><span class='hs-varid'>splice</span> <span class='hs-varid'>d</span><span class='hs-keyglyph'>]</span>
</pre>
Parses identifiers:

simple_identifier_23
u&"unicode quoted identifier"
"quoted identifier"
"quoted identifier "" with double quote char"
`mysql quoted identifier`

<pre><a name="line-167"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>identifier</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>Token</span>
<a name="line-168"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>identifier</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>=</span>
<a name="line-169"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>choice</span>
<a name="line-170"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyglyph'>[</span><span class='hs-conid'>Identifier</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-str'>"\""</span><span class='hs-layout'>,</span><span class='hs-str'>"\""</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>qiden</span>
<a name="line-171"></a><span class='hs-varop'>&gt;</span>      <span class='hs-comment'>-- try is used here to avoid a conflict with identifiers</span>
<a name="line-172"></a><span class='hs-varop'>&gt;</span>      <span class='hs-comment'>-- and quoted strings which also start with a 'u'</span>
<a name="line-173"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-conid'>Identifier</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-str'>"u&amp;\""</span><span class='hs-layout'>,</span><span class='hs-str'>"\""</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-str'>"u&amp;"</span><span class='hs-layout'>)</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>qiden</span><span class='hs-layout'>)</span>
<a name="line-174"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-conid'>Identifier</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-str'>"U&amp;\""</span><span class='hs-layout'>,</span><span class='hs-str'>"\""</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-str'>"U&amp;"</span><span class='hs-layout'>)</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>qiden</span><span class='hs-layout'>)</span>
<a name="line-175"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-conid'>Identifier</span> <span class='hs-conid'>Nothing</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>identifierString</span>
<a name="line-176"></a><span class='hs-varop'>&gt;</span>      <span class='hs-comment'>-- todo: dialect protection</span>
<a name="line-177"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- Identifier (Just ("`","`"))</span>
<a name="line-178"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- &lt;$&gt; (char '`' *&gt; takeWhile1 (/='`') &lt;* char '`')</span>
<a name="line-179"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>guard</span> <span class='hs-layout'>(</span><span class='hs-varid'>diSyntaxFlavour</span> <span class='hs-varid'>d</span> <span class='hs-varop'>==</span> <span class='hs-conid'>SqlServer</span><span class='hs-layout'>)</span> <span class='hs-varop'>&gt;&gt;</span>
<a name="line-180"></a><span class='hs-varop'>&gt;</span>      <span class='hs-conid'>Identifier</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-str'>"["</span><span class='hs-layout'>,</span><span class='hs-str'>"]"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-181"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'['</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>takeWhile1</span> <span class='hs-layout'>(</span><span class='hs-varop'>`notElem`</span> <span class='hs-layout'>(</span><span class='hs-str'>"[]"</span><span class='hs-keyglyph'>::</span><span class='hs-conid'>String</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>char</span> <span class='hs-chr'>']'</span><span class='hs-layout'>)</span>
<a name="line-182"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyglyph'>]</span>
<a name="line-183"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-184"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>qiden</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'"'</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>qidenSuffix</span> <span class='hs-str'>""</span>
<a name="line-185"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>qidenSuffix</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-186"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>s</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>takeTill</span> <span class='hs-layout'>(</span><span class='hs-varop'>==</span><span class='hs-chr'>'"'</span><span class='hs-layout'>)</span>
<a name="line-187"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>void</span> <span class='hs-varop'>$</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'"'</span>
<a name="line-188"></a><span class='hs-varop'>&gt;</span>         <span class='hs-comment'>-- deal with "" as literal double quote character</span>
<a name="line-189"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-keyword'>do</span>
<a name="line-190"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varid'>void</span> <span class='hs-varop'>$</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'"'</span>
<a name="line-191"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varid'>qidenSuffix</span> <span class='hs-varop'>$</span> <span class='hs-varid'>concat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-layout'>,</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span><span class='hs-str'>"\"\""</span><span class='hs-keyglyph'>]</span>
<a name="line-192"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>concat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-layout'>,</span><span class='hs-varid'>s</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
</pre>

This parses a valid identifier without quotes.

<pre><a name="line-193"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>identifierString</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>String</span>
<a name="line-194"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>identifierString</span> <span class='hs-keyglyph'>=</span>
<a name="line-195"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>startsWith</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span> <span class='hs-varop'>==</span> <span class='hs-chr'>'_'</span> <span class='hs-varop'>||</span> <span class='hs-varid'>isAlpha</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-varid'>isIdentifierChar</span>
</pre>
this can be moved to the dialect at some point

<pre><a name="line-196"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>isIdentifierChar</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-197"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>isIdentifierChar</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-varop'>==</span> <span class='hs-chr'>'_'</span> <span class='hs-varop'>||</span> <span class='hs-varid'>isAlphaNum</span> <span class='hs-varid'>c</span>
</pre>
<pre><a name="line-198"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>prefixedVariable</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>Token</span>
<a name="line-199"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>prefixedVariable</span>  <span class='hs-varid'>d</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-varid'>choice</span>
<a name="line-200"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyglyph'>[</span><span class='hs-conid'>PrefixedVariable</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>':'</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>identifierString</span>
<a name="line-201"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>guard</span> <span class='hs-layout'>(</span><span class='hs-varid'>diSyntaxFlavour</span> <span class='hs-varid'>d</span> <span class='hs-varop'>==</span> <span class='hs-conid'>SqlServer</span><span class='hs-layout'>)</span> <span class='hs-varop'>&gt;&gt;</span>
<a name="line-202"></a><span class='hs-varop'>&gt;</span>      <span class='hs-conid'>PrefixedVariable</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'@'</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>identifierString</span>
<a name="line-203"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>,</span><span class='hs-varid'>guard</span> <span class='hs-layout'>(</span><span class='hs-varid'>diSyntaxFlavour</span> <span class='hs-varid'>d</span> <span class='hs-varop'>`elem`</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Oracle</span><span class='hs-layout'>,</span><span class='hs-conid'>SqlServer</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varop'>&gt;&gt;</span>
<a name="line-204"></a><span class='hs-varop'>&gt;</span>      <span class='hs-conid'>PrefixedVariable</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'#'</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>identifierString</span>
<a name="line-205"></a><span class='hs-varop'>&gt;</span>     <span class='hs-keyglyph'>]</span>
</pre>

<pre><a name="line-206"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>positionalArg</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>Token</span>
<a name="line-207"></a><span class='hs-varop'>&gt;</span> <span class='hs-comment'>-- uses try so we don't get confused with $splices</span>
<a name="line-208"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>positionalArg</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>=</span>
<a name="line-209"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>guard</span> <span class='hs-layout'>(</span><span class='hs-varid'>diSyntaxFlavour</span> <span class='hs-varid'>d</span> <span class='hs-varop'>==</span> <span class='hs-conid'>Postgres</span><span class='hs-layout'>)</span> <span class='hs-varop'>&gt;&gt;</span>
<a name="line-210"></a><span class='hs-varop'>&gt;</span>     <span class='hs-conid'>PositionalArg</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'$'</span> <span class='hs-varop'>*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>read</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>many1</span> <span class='hs-varid'>digit</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
</pre>

Strings in sql:
postgresql dialect:
strings delimited with single quotes
a literal quote is written ''
the lexer leaves the double quote in the string in the ast
strings can also be written like this:
E'string with quotes in \n \t'
the \n and \t are escape sequences. The lexer passes these through unchanged.
an 'E' escaped string can also contain \' for a literal single quote.
this are also passed into the ast unchanged
strings can be dollar quoted:
$$string$$
the dollar quote can contain an optional tag:
$tag$string$tag$
which allows nesting of dollar quoted strings with different tags

Not sure what behaviour in sql server and oracle, pretty sure they
don't have dollar quoting, but I think they have the other two
variants.

<pre><a name="line-211"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>sqlString</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>Token</span>
<a name="line-212"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>sqlString</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dollarString</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>csString</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>normalString</span>
<a name="line-213"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-214"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>dollarString</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-215"></a><span class='hs-varop'>&gt;</span>         <span class='hs-comment'>-- need a solution for the dialect for quasi quotes</span>
<a name="line-216"></a><span class='hs-varop'>&gt;</span>         <span class='hs-comment'>--guard $ diSyntaxFlavour d == Postgres</span>
<a name="line-217"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>delim</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>concat</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"$"</span><span class='hs-layout'>,</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-str'>"$"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-218"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'$'</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-str'>""</span> <span class='hs-varid'>identifierString</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'$'</span><span class='hs-layout'>)</span>
<a name="line-219"></a><span class='hs-varop'>&gt;</span>         <span class='hs-conid'>SqlString</span> <span class='hs-varid'>delim</span> <span class='hs-varid'>delim</span>  <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>manyTill</span> <span class='hs-varid'>anyChar</span> <span class='hs-layout'>(</span><span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-varid'>string</span> <span class='hs-varid'>delim</span><span class='hs-layout'>)</span>
<a name="line-220"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>normalString</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SqlString</span> <span class='hs-str'>"'"</span> <span class='hs-str'>"'"</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'\''</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>normalStringSuffix</span> <span class='hs-conid'>False</span> <span class='hs-str'>""</span><span class='hs-layout'>)</span>
<a name="line-221"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>normalStringSuffix</span> <span class='hs-varid'>allowBackslash</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-222"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>s</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>takeTill</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>allowBackslash</span>
<a name="line-223"></a><span class='hs-varop'>&gt;</span>                         <span class='hs-keyword'>then</span> <span class='hs-layout'>(</span><span class='hs-varop'>`elem`</span> <span class='hs-layout'>(</span><span class='hs-str'>"'\\"</span><span class='hs-keyglyph'>::</span><span class='hs-conid'>String</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-224"></a><span class='hs-varop'>&gt;</span>                         <span class='hs-keyword'>else</span> <span class='hs-layout'>(</span><span class='hs-varop'>==</span> <span class='hs-chr'>'\''</span><span class='hs-layout'>)</span>
<a name="line-225"></a><span class='hs-varop'>&gt;</span>         <span class='hs-comment'>-- deal with '' or \' as literal quote character</span>
<a name="line-226"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-keyword'>do</span>
<a name="line-227"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varid'>ctu</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"''"</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-str'>"''"</span><span class='hs-layout'>)</span>
<a name="line-228"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-layout'>,</span><span class='hs-str'>"\\'"</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-str'>"\\'"</span><span class='hs-layout'>)</span>
<a name="line-229"></a><span class='hs-varop'>&gt;</span>                               <span class='hs-layout'>,</span><span class='hs-str'>"\\"</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'\\'</span><span class='hs-keyglyph'>]</span>
<a name="line-230"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varid'>normalStringSuffix</span> <span class='hs-varid'>allowBackslash</span> <span class='hs-varop'>$</span> <span class='hs-varid'>concat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-layout'>,</span><span class='hs-varid'>s</span><span class='hs-layout'>,</span><span class='hs-varid'>ctu</span><span class='hs-keyglyph'>]</span>
<a name="line-231"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>concat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-layout'>,</span><span class='hs-varid'>s</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'\''</span><span class='hs-keyglyph'>]</span>
<a name="line-232"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- try is used to to avoid conflicts with</span>
<a name="line-233"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- identifiers which can start with n,b,x,u</span>
<a name="line-234"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- once we read the quote type and the starting '</span>
<a name="line-235"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- then we commit to a string</span>
<a name="line-236"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- it's possible that this will reject some valid syntax</span>
<a name="line-237"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- but only pathalogical stuff, and I think the improved</span>
<a name="line-238"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- error messages and user predictability make it a good</span>
<a name="line-239"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- pragmatic choice</span>
<a name="line-240"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>csString</span>
<a name="line-241"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyglyph'>|</span> <span class='hs-varid'>diSyntaxFlavour</span> <span class='hs-varid'>d</span> <span class='hs-varop'>==</span> <span class='hs-conid'>Postgres</span> <span class='hs-keyglyph'>=</span>
<a name="line-242"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SqlString</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-str'>"e'"</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>string</span> <span class='hs-str'>"E'"</span><span class='hs-layout'>)</span>
<a name="line-243"></a><span class='hs-varop'>&gt;</span>                           <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>return</span> <span class='hs-str'>"'"</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>normalStringSuffix</span> <span class='hs-conid'>True</span> <span class='hs-str'>""</span>
<a name="line-244"></a><span class='hs-varop'>&gt;</span>                <span class='hs-layout'>,</span><span class='hs-varid'>csString'</span><span class='hs-keyglyph'>]</span>
<a name="line-245"></a><span class='hs-varop'>&gt;</span>       <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>csString'</span>
<a name="line-246"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>csString'</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SqlString</span>
<a name="line-247"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>try</span> <span class='hs-varid'>cs</span>
<a name="line-248"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>return</span> <span class='hs-str'>"'"</span>
<a name="line-249"></a><span class='hs-varop'>&gt;</span>                 <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>normalStringSuffix</span> <span class='hs-conid'>False</span> <span class='hs-str'>""</span>
<a name="line-250"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>csPrefixes</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"nNbBxX"</span>
<a name="line-251"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>cs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span> <span class='hs-varop'>$</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>string</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>++</span> <span class='hs-str'>"'"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>csPrefixes</span><span class='hs-layout'>)</span>
<a name="line-252"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>string</span> <span class='hs-str'>"u&amp;'"</span>
<a name="line-253"></a><span class='hs-varop'>&gt;</span>                      <span class='hs-layout'>,</span><span class='hs-varid'>string</span> <span class='hs-str'>"U&amp;'"</span><span class='hs-keyglyph'>]</span>
</pre>
postgresql number parsing

digits
digits.[digits][e[+-]digits]
[digits].digits[e[+-]digits]
digitse[+-]digits
where digits is one or more decimal digits (0 through 9). At least one digit must be before or after the decimal point, if one is used. At least one digit must follow the exponent marker (e), if one is present. There cannot be any spaces or other characters embedded in the constant. Note that any leading plus or minus sign is not actually considered part of the constant; it is an operator applied to the constant.

<pre><a name="line-254"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>sqlNumber</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>Token</span>
<a name="line-255"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>sqlNumber</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span>
<a name="line-256"></a><span class='hs-varop'>&gt;</span>     <span class='hs-conid'>SqlNumber</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>completeNumber</span>
<a name="line-257"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- this is for definitely avoiding possibly ambiguous source</span>
<a name="line-258"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- with a special exception for a .. operator</span>
<a name="line-259"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>choice</span>
<a name="line-260"></a><span class='hs-varop'>&gt;</span>        <span class='hs-keyglyph'>[</span><span class='hs-varid'>void</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lookAhead</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-str'>".."</span><span class='hs-layout'>)</span>
<a name="line-261"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-varid'>void</span> <span class='hs-varop'>$</span> <span class='hs-varid'>notFollowedBy</span> <span class='hs-layout'>(</span><span class='hs-varid'>oneOf</span> <span class='hs-str'>"eE."</span><span class='hs-layout'>)</span>
<a name="line-262"></a><span class='hs-varop'>&gt;</span>        <span class='hs-keyglyph'>]</span>
<a name="line-263"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-264"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>completeNumber</span> <span class='hs-keyglyph'>=</span>
<a name="line-265"></a><span class='hs-varop'>&gt;</span>       <span class='hs-layout'>(</span><span class='hs-varid'>int</span> <span class='hs-varop'>&lt;??&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pp</span> <span class='hs-varid'>dot</span> <span class='hs-varop'>&lt;??.&gt;</span> <span class='hs-varid'>pp</span> <span class='hs-varid'>int</span><span class='hs-layout'>)</span>
<a name="line-266"></a><span class='hs-varop'>&gt;</span>       <span class='hs-comment'>-- try is used in case we read a dot</span>
<a name="line-267"></a><span class='hs-varop'>&gt;</span>       <span class='hs-comment'>-- and it isn't part of a number</span>
<a name="line-268"></a><span class='hs-varop'>&gt;</span>       <span class='hs-comment'>-- if there are any following digits, then we commit</span>
<a name="line-269"></a><span class='hs-varop'>&gt;</span>       <span class='hs-comment'>-- to it being a number and not something else</span>
<a name="line-270"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>++</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>dot</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>int</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-271"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varop'>&lt;??&gt;</span> <span class='hs-varid'>pp</span> <span class='hs-varid'>expon</span>
</pre>
<pre><a name="line-272"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>int</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>many1</span> <span class='hs-varid'>digit</span>
<a name="line-273"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- if we see two dots together, leave them</span>
<a name="line-274"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- so we can parse things like 1..2 (used in postgres)</span>
<a name="line-275"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>dot</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-str'>"."</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>notFollowedBy</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'.'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-276"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>expon</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>oneOf</span> <span class='hs-str'>"eE"</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>sInt</span>
<a name="line-277"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>sInt</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varop'>++</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>option</span> <span class='hs-str'>""</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-str'>"+"</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>string</span> <span class='hs-str'>"-"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>int</span>
<a name="line-278"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>pp</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;$$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varop'>++</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-279"></a><span class='hs-varop'>&gt;</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;??&gt;</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Parser</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-varid'>a</span>
<a name="line-280"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>p</span> <span class='hs-varop'>&lt;??&gt;</span> <span class='hs-varid'>q</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>p</span> <span class='hs-varop'>&lt;**&gt;</span> <span class='hs-varid'>option</span> <span class='hs-varid'>id</span> <span class='hs-varid'>q</span>
</pre>
<pre><a name="line-281"></a><span class='hs-varop'>&gt;</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;??.&gt;</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Parser</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-282"></a><span class='hs-varop'>&gt;</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;??.&gt;</span><span class='hs-layout'>)</span> <span class='hs-varid'>pa</span> <span class='hs-varid'>pb</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varop'>.</span><span class='hs-layout'>)</span> <span class='hs-varop'>`c`</span> <span class='hs-varid'>pa</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-varid'>id</span> <span class='hs-varid'>pb</span>
<a name="line-283"></a><span class='hs-varop'>&gt;</span>   <span class='hs-comment'>-- todo: fix this mess</span>
<a name="line-284"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;$&gt;</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>flip</span>
</pre>
<pre><a name="line-285"></a><span class='hs-varop'>&gt;</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;$$&gt;</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Applicative</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=&gt;</span>
<a name="line-286"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>f</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-287"></a><span class='hs-varop'>&gt;</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;$$&gt;</span><span class='hs-layout'>)</span> <span class='hs-varid'>pa</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pa</span> <span class='hs-varop'>&lt;**&gt;</span> <span class='hs-varid'>pure</span> <span class='hs-layout'>(</span><span class='hs-varid'>flip</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
</pre>
A symbol is one of the two character symbols, or one of the single
character symbols in the two lists below.

<pre><a name="line-288"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>symbol</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>Token</span>
<a name="line-289"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>symbol</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>diSyntaxFlavour</span> <span class='hs-varid'>d</span> <span class='hs-varop'>==</span> <span class='hs-conid'>Postgres</span> <span class='hs-keyglyph'>=</span>
<a name="line-290"></a><span class='hs-varop'>&gt;</span>     <span class='hs-conid'>Symbol</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>choice</span> <span class='hs-layout'>(</span><span class='hs-varid'>otherSymbol</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>singlePlusMinus</span><span class='hs-layout'>,</span><span class='hs-varid'>opMoreChars</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
</pre>
rules

An operator name is a sequence of up to NAMEDATALEN-1 (63 by default) characters from the following list:

+ - * / < > = ~ ! @ # % ^ & | ` ?

There are a few restrictions on operator names, however:
-- and /* cannot appear anywhere in an operator name, since they will be taken as the start of a comment.

A multiple-character operator name cannot end in + or -, unless the name also contains at least one of these characters:

~ ! @ # % ^ & | ` ?

<pre><a name="line-291"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-292"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- other symbols are all the tokens which parse as symbols in</span>
<a name="line-293"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- this lexer which aren't considered operators in postgresql</span>
<a name="line-294"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- a single ? is parsed as a operator here instead of an other</span>
<a name="line-295"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- symbol because this is the least complex way to do it</span>
<a name="line-296"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>otherSymbol</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>many1</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'.'</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span>
<a name="line-297"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-str'>":="</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span>
<a name="line-298"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-comment'>-- parse :: and : and avoid allowing ::: or more</span>
<a name="line-299"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-str'>"::"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>notFollowedBy</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>':'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span>
<a name="line-300"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-str'>":"</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>notFollowedBy</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>':'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span>
<a name="line-301"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"[],;()"</span>
<a name="line-302"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varop'>++</span> <span class='hs-keyword'>if</span> <span class='hs-conid'>True</span> <span class='hs-comment'>-- allowOdbc d</span>
<a name="line-303"></a><span class='hs-varop'>&gt;</span>                       <span class='hs-keyword'>then</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>string</span> <span class='hs-str'>"{"</span><span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"}"</span><span class='hs-keyglyph'>]</span>
<a name="line-304"></a><span class='hs-varop'>&gt;</span>                       <span class='hs-keyword'>else</span> <span class='hs-conid'>[]</span>
<a name="line-305"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-layout'>)</span>
</pre>
exception char is one of:
~ ! @ # % ^ & | ` ?
which allows the last character of a multi character symbol to be + or
-

<pre><a name="line-306"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>allOpSymbols</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"+-*/&lt;&gt;=~!@#%^&amp;|`?"</span>
<a name="line-307"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- these are the symbols when if part of a multi character</span>
<a name="line-308"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- operator permit the operator to end with a + or - symbol</span>
<a name="line-309"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>exceptionOpSymbols</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"~!@#%^&amp;|`?"</span>
</pre>
<pre><a name="line-310"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- special case for parsing a single + or - symbol</span>
<a name="line-311"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>singlePlusMinus</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>try</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-312"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>c</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>oneOf</span> <span class='hs-str'>"+-"</span>
<a name="line-313"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>notFollowedBy</span> <span class='hs-varop'>$</span> <span class='hs-varid'>oneOf</span> <span class='hs-varid'>allOpSymbols</span>
<a name="line-314"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>return</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>c</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-315"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- this is used when we are parsing a potentially multi symbol</span>
<a name="line-316"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- operator and we have alread seen one of the 'exception chars'</span>
<a name="line-317"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- and so we can end with a + or -</span>
<a name="line-318"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>moreOpCharsException</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-319"></a><span class='hs-varop'>&gt;</span>        <span class='hs-varid'>c</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>oneOf</span> <span class='hs-layout'>(</span><span class='hs-varid'>filter</span> <span class='hs-layout'>(</span><span class='hs-varop'>`notElem`</span> <span class='hs-layout'>(</span><span class='hs-str'>"-/*"</span><span class='hs-keyglyph'>::</span><span class='hs-conid'>String</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>allOpSymbols</span><span class='hs-layout'>)</span>
<a name="line-320"></a><span class='hs-varop'>&gt;</span>             <span class='hs-comment'>-- make sure we don't parse a comment starting token</span>
<a name="line-321"></a><span class='hs-varop'>&gt;</span>             <span class='hs-comment'>-- as part of an operator</span>
<a name="line-322"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'/'</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>notFollowedBy</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'*'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-323"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'-'</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>notFollowedBy</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'-'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-324"></a><span class='hs-varop'>&gt;</span>             <span class='hs-comment'>-- and make sure we don't parse a block comment end</span>
<a name="line-325"></a><span class='hs-varop'>&gt;</span>             <span class='hs-comment'>-- as part of another symbol</span>
<a name="line-326"></a><span class='hs-varop'>&gt;</span>             <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'*'</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>notFollowedBy</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'/'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-327"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>moreOpCharsException</span>
</pre>
<pre><a name="line-328"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>opMoreChars</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>choice</span>
<a name="line-329"></a><span class='hs-varop'>&gt;</span>        <span class='hs-keyglyph'>[</span><span class='hs-comment'>-- parse an exception char, now we can finish with a + -</span>
<a name="line-330"></a><span class='hs-varop'>&gt;</span>         <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span>
<a name="line-331"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>oneOf</span> <span class='hs-varid'>exceptionOpSymbols</span>
<a name="line-332"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>moreOpCharsException</span>
<a name="line-333"></a><span class='hs-varop'>&gt;</span>        <span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span>
<a name="line-334"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-comment'>-- parse +, make sure it isn't the last symbol</span>
<a name="line-335"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'+'</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>lookAhead</span> <span class='hs-layout'>(</span><span class='hs-varid'>oneOf</span> <span class='hs-varid'>allOpSymbols</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-336"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-comment'>-- parse -, make sure it isn't the last symbol</span>
<a name="line-337"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-comment'>-- or the start of a -- comment</span>
<a name="line-338"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'-'</span>
<a name="line-339"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>notFollowedBy</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'-'</span><span class='hs-layout'>)</span>
<a name="line-340"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>lookAhead</span> <span class='hs-layout'>(</span><span class='hs-varid'>oneOf</span> <span class='hs-varid'>allOpSymbols</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-341"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-comment'>-- parse / check it isn't the start of a /* comment</span>
<a name="line-342"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'/'</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>notFollowedBy</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'*'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-343"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-comment'>-- make sure we don't parse */ as part of a symbol</span>
<a name="line-344"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'*'</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>notFollowedBy</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'/'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-345"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-comment'>-- any other ansi operator symbol</span>
<a name="line-346"></a><span class='hs-varop'>&gt;</span>              <span class='hs-varid'>oneOf</span> <span class='hs-str'>"&lt;&gt;="</span><span class='hs-layout'>)</span>
<a name="line-347"></a><span class='hs-varop'>&gt;</span>         <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>option</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>opMoreChars</span>
<a name="line-348"></a><span class='hs-varop'>&gt;</span>        <span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-349"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>symbol</span> <span class='hs-varid'>d</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>diSyntaxFlavour</span> <span class='hs-varid'>d</span> <span class='hs-varop'>==</span> <span class='hs-conid'>SqlServer</span> <span class='hs-keyglyph'>=</span>
<a name="line-350"></a><span class='hs-varop'>&gt;</span>    <span class='hs-conid'>Symbol</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>choice</span> <span class='hs-layout'>(</span><span class='hs-varid'>otherSymbol</span> <span class='hs-varop'>++</span> <span class='hs-varid'>regularOp</span><span class='hs-layout'>)</span>
<a name="line-351"></a><span class='hs-varop'>&gt;</span>  <span class='hs-keyword'>where</span>
<a name="line-352"></a><span class='hs-varop'>&gt;</span>    <span class='hs-varid'>otherSymbol</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>string</span> <span class='hs-str'>"."</span> <span class='hs-conop'>:</span>
<a name="line-353"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>",;():?"</span>
<a name="line-354"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-varop'>++</span> <span class='hs-keyword'>if</span> <span class='hs-conid'>True</span> <span class='hs-comment'>-- allowOdbc d</span>
<a name="line-355"></a><span class='hs-varop'>&gt;</span>                      <span class='hs-keyword'>then</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>string</span> <span class='hs-str'>"{"</span><span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"}"</span><span class='hs-keyglyph'>]</span>
<a name="line-356"></a><span class='hs-varop'>&gt;</span>                      <span class='hs-keyword'>else</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
</pre>
try is used because most of the first characters of the two character
symbols can also be part of a single character symbol

<pre><a name="line-357"></a><span class='hs-varop'>&gt;</span>    <span class='hs-varid'>regularOp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>try</span> <span class='hs-varop'>.</span> <span class='hs-varid'>string</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"&gt;="</span><span class='hs-layout'>,</span><span class='hs-str'>"&lt;="</span><span class='hs-layout'>,</span><span class='hs-str'>"!="</span><span class='hs-layout'>,</span><span class='hs-str'>"&lt;&gt;"</span><span class='hs-keyglyph'>]</span>
<a name="line-358"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>++</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"+-^*/%~&amp;&lt;&gt;="</span>
<a name="line-359"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>char</span> <span class='hs-chr'>'|'</span> <span class='hs-varop'>*&gt;</span>
<a name="line-360"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"||"</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'|'</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>notFollowedBy</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'|'</span><span class='hs-layout'>)</span>
<a name="line-361"></a><span class='hs-varop'>&gt;</span>                           <span class='hs-layout'>,</span><span class='hs-varid'>return</span> <span class='hs-str'>"|"</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-362"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>symbol</span> <span class='hs-sel'>_d</span> <span class='hs-keyglyph'>=</span>
<a name="line-363"></a><span class='hs-varop'>&gt;</span>    <span class='hs-conid'>Symbol</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>choice</span> <span class='hs-layout'>(</span><span class='hs-varid'>otherSymbol</span> <span class='hs-varop'>++</span> <span class='hs-varid'>regularOp</span><span class='hs-layout'>)</span>
<a name="line-364"></a><span class='hs-varop'>&gt;</span>  <span class='hs-keyword'>where</span>
<a name="line-365"></a><span class='hs-varop'>&gt;</span>    <span class='hs-varid'>otherSymbol</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>many1</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'.'</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span>
<a name="line-366"></a><span class='hs-varop'>&gt;</span>                  <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"[],;():?"</span>
<a name="line-367"></a><span class='hs-varop'>&gt;</span>                   <span class='hs-varop'>++</span> <span class='hs-keyword'>if</span> <span class='hs-conid'>True</span> <span class='hs-comment'>-- allowOdbc d</span>
<a name="line-368"></a><span class='hs-varop'>&gt;</span>                      <span class='hs-keyword'>then</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>string</span> <span class='hs-str'>"{"</span><span class='hs-layout'>,</span> <span class='hs-varid'>string</span> <span class='hs-str'>"}"</span><span class='hs-keyglyph'>]</span>
<a name="line-369"></a><span class='hs-varop'>&gt;</span>                      <span class='hs-keyword'>else</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
</pre>
try is used because most of the first characters of the two character
symbols can also be part of a single character symbol

<pre><a name="line-370"></a><span class='hs-varop'>&gt;</span>    <span class='hs-varid'>regularOp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>try</span> <span class='hs-varop'>.</span> <span class='hs-varid'>string</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"&gt;="</span><span class='hs-layout'>,</span><span class='hs-str'>"&lt;="</span><span class='hs-layout'>,</span><span class='hs-str'>"!="</span><span class='hs-layout'>,</span><span class='hs-str'>"&lt;&gt;"</span><span class='hs-keyglyph'>]</span>
<a name="line-371"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>++</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-str'>"+-^*/%~&amp;&lt;&gt;=[]"</span>
<a name="line-372"></a><span class='hs-varop'>&gt;</span>                <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>char</span> <span class='hs-chr'>'|'</span> <span class='hs-varop'>*&gt;</span>
<a name="line-373"></a><span class='hs-varop'>&gt;</span>                    <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"||"</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'|'</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>notFollowedBy</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'|'</span><span class='hs-layout'>)</span>
<a name="line-374"></a><span class='hs-varop'>&gt;</span>                           <span class='hs-layout'>,</span><span class='hs-varid'>return</span> <span class='hs-str'>"|"</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
</pre>

<pre><a name="line-375"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>sqlWhitespace</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>Token</span>
<a name="line-376"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>sqlWhitespace</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Whitespace</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>many1</span> <span class='hs-layout'>(</span><span class='hs-varid'>satisfy</span> <span class='hs-varid'>isSpace</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-377"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>lineComment</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>Token</span>
<a name="line-378"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>lineComment</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span>
<a name="line-379"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LineComment</span> <span class='hs-varop'>$</span> <span class='hs-varid'>concat</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"--"</span><span class='hs-layout'>,</span><span class='hs-varid'>s</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-380"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- try is used here in case we see a - symbol</span>
<a name="line-381"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- once we read two -- then we commit to the comment token</span>
<a name="line-382"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>(</span><span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-str'>"--"</span><span class='hs-layout'>)</span> <span class='hs-varop'>*&gt;</span> <span class='hs-layout'>(</span>
<a name="line-383"></a><span class='hs-varop'>&gt;</span>      <span class='hs-varid'>conc</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>manyTill</span> <span class='hs-varid'>anyChar</span> <span class='hs-layout'>(</span><span class='hs-varid'>lookAhead</span> <span class='hs-varid'>lineCommentEnd</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>lineCommentEnd</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-384"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-385"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>conc</span> <span class='hs-varid'>a</span> <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span>
<a name="line-386"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>conc</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span> <span class='hs-varop'>++</span> <span class='hs-varid'>b</span>
<a name="line-387"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>lineCommentEnd</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-str'>"\n"</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'\n'</span> <span class='hs-varop'>&lt;|&gt;</span> <span class='hs-conid'>Nothing</span> <span class='hs-varop'>&lt;$</span> <span class='hs-varid'>eof</span>
</pre>
<pre><a name="line-388"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>blockComment</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>Token</span>
<a name="line-389"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>blockComment</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span>
<a name="line-390"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>BlockComment</span> <span class='hs-varop'>$</span> <span class='hs-varid'>concat</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"/*"</span><span class='hs-layout'>,</span><span class='hs-varid'>s</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span>
<a name="line-391"></a><span class='hs-varop'>&gt;</span>     <span class='hs-layout'>(</span><span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-str'>"/*"</span><span class='hs-layout'>)</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>commentSuffix</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span>
<a name="line-392"></a><span class='hs-varop'>&gt;</span>   <span class='hs-keyword'>where</span>
<a name="line-393"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>commentSuffix</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>String</span>
<a name="line-394"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>commentSuffix</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-395"></a><span class='hs-varop'>&gt;</span>       <span class='hs-comment'>-- read until a possible end comment or nested comment</span>
<a name="line-396"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>x</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>takeWhile</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>e</span> <span class='hs-varop'>/=</span> <span class='hs-chr'>'/'</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>e</span> <span class='hs-varop'>/=</span> <span class='hs-chr'>'*'</span><span class='hs-layout'>)</span>
<a name="line-397"></a><span class='hs-varop'>&gt;</span>       <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-comment'>-- close comment: if the nesting is 0, done</span>
<a name="line-398"></a><span class='hs-varop'>&gt;</span>               <span class='hs-comment'>-- otherwise recurse on commentSuffix</span>
<a name="line-399"></a><span class='hs-varop'>&gt;</span>               <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-str'>"*/"</span><span class='hs-layout'>)</span> <span class='hs-varop'>*&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-str'>"*/"</span><span class='hs-keyglyph'>]</span>
<a name="line-400"></a><span class='hs-varop'>&gt;</span>                                    <span class='hs-keyword'>in</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>n</span> <span class='hs-varop'>==</span> <span class='hs-num'>0</span>
<a name="line-401"></a><span class='hs-varop'>&gt;</span>                                       <span class='hs-keyword'>then</span> <span class='hs-varid'>return</span> <span class='hs-varid'>t</span>
<a name="line-402"></a><span class='hs-varop'>&gt;</span>                                       <span class='hs-keyword'>else</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>concat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>t</span><span class='hs-layout'>,</span><span class='hs-varid'>s</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>commentSuffix</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span>
<a name="line-403"></a><span class='hs-varop'>&gt;</span>               <span class='hs-comment'>-- nested comment, recurse</span>
<a name="line-404"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-str'>"/*"</span><span class='hs-layout'>)</span> <span class='hs-varop'>*&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>concat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span><span class='hs-str'>"/*"</span><span class='hs-layout'>,</span><span class='hs-varid'>s</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>commentSuffix</span> <span class='hs-layout'>(</span><span class='hs-varid'>n</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-405"></a><span class='hs-varop'>&gt;</span>               <span class='hs-comment'>-- not an end comment or nested comment, continue</span>
<a name="line-406"></a><span class='hs-varop'>&gt;</span>              <span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>c</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>concat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>c</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-varid'>s</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>anyChar</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>commentSuffix</span> <span class='hs-varid'>n</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-407"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>dontParseEndBlockComment</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>Token</span>
<a name="line-408"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>dontParseEndBlockComment</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span>
<a name="line-409"></a><span class='hs-varop'>&gt;</span>     <span class='hs-comment'>-- don't use try, then it should commit to the error</span>
<a name="line-410"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>try</span> <span class='hs-layout'>(</span><span class='hs-varid'>string</span> <span class='hs-str'>"*/"</span><span class='hs-layout'>)</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>fail</span> <span class='hs-str'>"comment end without comment start"</span>
</pre>
<pre><a name="line-411"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>splice</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dialect</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>Token</span>
<a name="line-412"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>splice</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-413"></a><span class='hs-varop'>&gt;</span>   <span class='hs-conid'>Splice</span>
<a name="line-414"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'$'</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>letter</span><span class='hs-layout'>)</span>
<a name="line-415"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'('</span> <span class='hs-varop'>*&gt;</span> <span class='hs-varid'>identifierString</span> <span class='hs-varop'>&lt;*</span> <span class='hs-varid'>char</span> <span class='hs-chr'>')'</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-416"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>startsWith</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>String</span>
<a name="line-417"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>startsWith</span> <span class='hs-varid'>p</span> <span class='hs-varid'>ps</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-418"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>c</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>satisfy</span> <span class='hs-varid'>p</span>
<a name="line-419"></a><span class='hs-varop'>&gt;</span>   <span class='hs-varid'>choice</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>takeWhile1</span> <span class='hs-varid'>ps</span><span class='hs-layout'>)</span>
<a name="line-420"></a><span class='hs-varop'>&gt;</span>          <span class='hs-layout'>,</span><span class='hs-varid'>return</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>c</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
</pre>
<pre><a name="line-421"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>takeWhile1</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>String</span>
<a name="line-422"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>takeWhile1</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>many1</span> <span class='hs-layout'>(</span><span class='hs-varid'>satisfy</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-423"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>takeWhile</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>String</span>
<a name="line-424"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>takeWhile</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>many</span> <span class='hs-layout'>(</span><span class='hs-varid'>satisfy</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-425"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>takeTill</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>String</span>
<a name="line-426"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>takeTill</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span>
<a name="line-427"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>manyTill</span> <span class='hs-varid'>anyChar</span> <span class='hs-layout'>(</span><span class='hs-varid'>peekSatisfy</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
</pre>
<pre><a name="line-428"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>peekSatisfy</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Parser</span> <span class='hs-conid'>()</span>
<a name="line-429"></a><span class='hs-varop'>&gt;</span> <span class='hs-definition'>peekSatisfy</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-430"></a><span class='hs-varop'>&gt;</span>     <span class='hs-varid'>void</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lookAhead</span> <span class='hs-layout'>(</span><span class='hs-varid'>satisfy</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
</pre></body>
</html>
